'use strict';(window.dullscriptWebpackJsonp=window.dullscriptWebpackJsonp||[]).push([[5],{1070:function(D,P,b){b.d(P,"a",function(){return n});D=b(0);var f=b(74),c=b(30);class n{static Gsa(m){const w={};for(let z of m)m=0,z in w&&(m=w[z]),w[z]=m+1;return c.c(w)}static TGg(m){let w=0;for(let z of m)z&&(m=parseInt(z),!isNaN(m)&&isFinite(m)&&(w+=m));return c.c(w)}static Avh(m){const w=new f.a;for(var z of m)z&&(m=parseFloat(z),!isNaN(m)&&isFinite(m)&&w.add(m));z={};z.C=w.count;if(0<w.count){m=0;for(var v of w)m+=
v;v=m/w.count;z.M=v.toFixed(2);m=0;for(let t of w)m+=(t-v)*(t-v);m/=w.count;z.SD=Math.sqrt(m).toFixed(2)}return c.c(z)}}Object(D.a)(n,"CommonActivityAggregationMethods",null,[])},1131:function(D,P,b){b.r(P);b.d(P,"RtcUtils",function(){return m});D=b(0);var f=b(10),c=b(1180),n=b(30);class m{static B4d(w,z=c.RealtimeChannel.Rne){let v;try{v=n.c(w)}catch(t){throw w=String.format("Failed to JSON-serialize payload : {0}",t),f.ULS.sendTraceTag(18637072,500,10,w),Error.argument("payload",w);}if(v.length>
z)throw w=String.format("Payload exceeds maximum length: {0} > {1}.",v.length,z),f.ULS.sendTraceTag(18637074,500,10,w),Error.argument("payload",w);return v}static deserialize(w,z,v,t,A=c.RealtimeChannel.Rne){if(!w)return null;if(Object.getType(w)!==String){let B;if(t)try{B=m.B4d(w,A)}catch(S){B=String.format("Failed to JSON serialize the object with exception [{0}]",S)}else B="not allowed to log the object";w=String.format("Failed to deserialize [{0}] - object is not of type [String] and is instead of type [{1}]. ExtraInfo: [{2}]. Object: [{3}].",
z,Object.getType(w).getName(),v,B);f.ULS.sendTraceTag(18637075,500,10,w);return null}A=null;try{A=n.a(w)}catch(B){w=String.format("Failed to deserialize [{0}]. Exception deserializing the object : [{1}]. ExtraInfo: [{2}]. Object: [{3}]",z,B,v,t?w:"not allowed to log the object"),f.ULS.sendTraceTag(18637077,500,10,w)}return A}static QAb(w){if(!w)return"";if("string"===typeof w)return w.toString();try{return n.c(w)}catch(z){return w.toString()}}static EDk(w){let z,v,t;z=0;t=v=null;if(!w)return{Lbi:z,
Mbi:v,exception:t};try{const A=w.source;A&&Object.getType(A)===String&&(t=A);const B=w.context;B&&(w=B,z=w.status?w.status:0,v=w.statusText?w.statusText:null)}catch(A){}return{Lbi:z,Mbi:v,exception:t}}}Object(D.a)(m,"RtcUtils",null,[])},1172:function(D,P,b){b.r(P);D=b(0);var f=b(10),c=b(42),n=b(65),m;(function(t){t[t.SendNotification=0]="SendNotification";t[t.SendPersistentState=1]="SendPersistentState";t[t.FindSession=2]="FindSession";t[t.Last=3]="Last"})(m||(m={}));Object(D.b)("ApiType",m);var w;
(function(t){t[t.AttemptCount=0]="AttemptCount";t[t.SuccessCount=1]="SuccessCount";t[t.DropCount=2]="DropCount";t[t.FailedCount=3]="FailedCount";t[t.LatencyOverThresholdCount=4]="LatencyOverThresholdCount";t[t.LatencyUnderThresholdCount=5]="LatencyUnderThresholdCount";t[t.ThrottledCount=6]="ThrottledCount";t[t.Last=7]="Last"})(w||(w={}));Object(D.b)("EventCountType",w);var z=b(1295);b.d(P,"FrequentLoggingMetrics",function(){return v});class v{constructor(t){this.cFh=this.jTh=null;this.eui=this.nVh=
0;this.gv=null;this.E8g=this.M_e=0;this.Re=t;this.Jkl();this.SQe=this.d0g=this.s0e=!1;this.DVc=0}get dDk(){return this.SQe}XKm(t){this.E8g=t;window.setInterval(Object(c.a)(this,this.f7f,"logMetricsBatchAndReset"),t);this.M_e=(new Date).getTime()}SQ(t,A){this.RCm(t)&&!this.d0g||this.dDk||!window.navigator.onLine||this.Re.L1b||(this.gv[t][A]++,this.s0e=!0)}Jkl(){this.gv=Array(3);for(let t=0;3>t;t++){this.gv[t]=Array(7);for(let A=0;7>A;A++)this.gv[t][A]=0}}i5j(){const t={};for(let A=0;3>A;A++)for(let B=
0;7>B;B++)this.Nzl(A,B)&&(t[m[A]+w[B]]=this.gv[A][B]);t.FSDomain=this.jTh;t.ConnectionDomain=this.cFh;t.FSRetryInterval=this.nVh;t.MaxPayloadSize=this.eui;t.LogNumber=this.DVc;1===this.DVc&&(t.FSLatencies=z.a.instance.rUk(),t.ConLatencies=z.a.instance.vQk());return t}Nzl(t,A){return 2===t&&3!==A&&A?!1:!0}RCm(t){return 2===t?!1:!0}f7f(){if(this.s0e){this.DVc++;if((new Date).getTime()-this.M_e<5E3+this.E8g){var t=n.a.toJSON(this.i5j());f.ULS.sendTraceTag(50644352,500,15,t)}this.M_e=(new Date).getTime();
for(t=0;3>t;t++)for(let A=0;7>A;A++)this.gv[t][A]=0;this.s0e=!1}}iJl(){this.d0g=!0}static get instance(){return v.ra}static create(t){v.instance||(v.ra=new v(t));return v.instance}}v.ra=null;Object(D.a)(v,"FrequentLoggingMetrics",null,[1001])},1180:function(D,P,b){b.r(P);D=b(0);var f=b(10),c=b(42),n=b(364),m=b(1395),w=b(58),z=b(2);class v{constructor(qa,Oa){this.status=qa;this.nxc=Oa}}Object(D.a)(v,"UserStatusInfo",null,[]);var t=b(44),A=b(1295);class B{constructor(qa,Oa){this.data=qa;this.timeStamp=
Oa}}Object(D.a)(B,"PresenceData",null,[]);class S{constructor(qa){this.OIa=!1;this.DPb=0;this.XMe=!1;this.setTimeout=S.xxf;this.clearTimeout=S.qxf;this.nHl=Object(c.a)(this,this.LGl,"logRtcConnectingUsageStatement");this.xw=qa}KSl(){this.OIa||(this.DPb=this.setTimeout(()=>{this.OIa=!1;this.asi()},8E3),this.OIa=!0,this.XMe=!1)}wTl(){this.l2()}QYl(){this.asi()}asi(){this.l2();this.XMe||(this.XMe=!0,this.nHl())}LGl(){f.ULS.sendTraceTag(4539720,500,50,"Usage statement for the Rtc_ConnectedEver KPI for [{0}]",
this.xw)}l2(){this.OIa&&this.clearTimeout(this.DPb);this.DPb=0;this.OIa=!1}static xxf(qa,Oa){return window.setTimeout(qa,Oa)}static qxf(qa){window.clearTimeout(qa)}}Object(D.a)(S,"ConnectedUsageKpiLogger",null,[1018]);class C{constructor(){this.jLi=this.Rog;this.mLi=this.Uog;this.lLi=this.Tog;this.rLi=this.$og;this.qLi=this.Zog;this.ipg=this.jpg;this.fpg=this.gpg;this.U8b=this.dpg;this.wyd=this.epg;this.kLi=this.Sog;this.PCa=this.Nbg;this.g_a=this.Obg}Rog(){}Uog(){}Tog(){}$og(){}Zog(){}gpg(){}epg(){}dpg(){}jpg(){}Sog(){}Nbg(){}Obg(){}}
Object(D.a)(C,"NoopRealtimeChannelMetrics",null,[1008,179]);class H{}H.cId="presenceUpdated";H.updateNotification="updateNotification";H.vGi="persistentStateCleared";H.updatePersistentState="persistentStateUpdated";Object(D.a)(H,"RtcClientMethodNames",null,[]);class J{}J.mhl="realtimeChannelHub";J.cId="UpdatePresence";J.GR="SendUpdateNotification";J.XIf="GetCompletePersistentStateWithMetadata";J.updatePersistentState="UpdatePersistentState";J.edc="UpdateClientInfo";Object(D.a)(J,"RtcHubMethodNames",
null,[]);class M{constructor(qa){this.Rv=qa}Wgm(qa){this.Rv.on(H.cId,qa)}shm(qa){this.Rv.on(H.updateNotification,qa)}Vgm(qa){this.Rv.on(H.updatePersistentState,qa)}Ugm(qa){this.Rv.on(H.vGi,qa)}rVm(qa){this.Rv.off(H.cId,qa)}vVm(qa){this.Rv.off(H.updateNotification,qa)}qVm(qa){this.Rv.off(H.updatePersistentState,qa)}pVm(qa){this.Rv.off(H.vGi,qa)}cId(qa){return this.Rv.invoke(J.cId,qa)}edc(qa){return this.Rv.invoke(J.edc,qa)}GR(qa,Oa){return this.Rv.invoke(J.GR,qa,Oa)}XIf(qa){return this.Rv.invoke(J.XIf,
qa)}updatePersistentState(qa,Oa){return this.Rv.invoke(J.updatePersistentState,qa,Oa)}}Object(D.a)(M,"RealtimeChannelProxy",null,[1013,1014,1015]);class G{constructor(){this.qKe=this.PTg=!1;this.oKe=0;this.kMe=this.U8e=this.T8e=this.D_e=this.yJe=!1;this.zRe=0;this.Qfh=!1;this.Pfh=this.Ofh=0;this.r7e=!1;this.v7e=this.u7e=this.x7e=this.s7e=0}get v1j(){return this.qKe}get u1j(){return this.oKe}get kXj(){return this.yJe}get lHl(){return this.D_e}get WDm(){return this.T8e}get XDm(){return this.U8e}get edk(){return this.kMe}get Cae(){return this.zRe}get Spm(){return this.Qfh}get kSi(){return this.Ofh}get Rpm(){return this.Pfh}get Opm(){return this.r7e}get Ppm(){return this.s7e}get pSi(){return this.x7e}get lSi(){return this.u7e}get mSi(){return this.v7e}static createInstance(qa){const {RealtimeChannel:Oa}=
b(1180);return qa?Object.assign(new G,{PTg:qa.$("AwayStatusManagerIsEnabled"),qKe:qa.$("AwayStatusOneMinuteTimeoutIsEnabled"),oKe:qa.vb("AwayCoauthorThresholdMs",9E5),yJe:qa.$("RtcAllowCrossDomainAccessEnabled"),D_e:qa.$("RTCLogUpdateNotificationHintOnDeserializationFailure"),T8e:qa.$("ShouldLogOnContentNotification"),U8e:qa.$("ShouldLogOnHostSubscriptionNotification"),kMe:qa.$("RtcClientMetricsEnabled"),zRe:qa.vb("RtcFindSessionRequestTimeoutInMS",6E4),Qfh:qa.$("RtcJsClientFrequentlyLogsMetrics"),
Ofh:qa.vb("RtcJsClientFrequentMetricsLatencyThresholdInMS",1E3),Pfh:qa.vb("RtcJsClientFrequentMetricsLogIntervalInMS",3E5),r7e:qa.$("RtcClientMessageTelemetryEnabled"),s7e:qa.vb("RtcClientMessageTelemetrySampleSize",5),x7e:qa.vb("RtcSendTelemetryMessageIntervalInMS",3E5),u7e:qa.vb("RtcLogClientMessageMetricsTimeOutInMs",2E4),v7e:qa.vb("RtcMaxPayloadSizeInCharactersOverride",Oa.Rne)}):Object.assign(new G,{PTg:!1,qKe:!1,oKe:9E5,yJe:!1,D_e:!0,T8e:!1,U8e:!0,kMe:!1,zRe:9E4,r7e:!1,s7e:5,x7e:3E5,u7e:2E4,
v7e:Oa.Rne})}}Object(D.a)(G,"RealtimeChannelSettings",null,[1012]);class R extends Sys.EventArgs{constructor(qa,Oa){super();this.newState=qa;this.oldState=Oa}}Object(D.a)(R,"ChangedConnectionStateEventArgs",Sys.EventArgs,[]);class O extends Sys.EventArgs{constructor(qa,Oa){super();this.ddk=qa;this.okb=Oa}}Object(D.a)(O,"ClientInfoEventArgs",Sys.EventArgs,[]);class I extends Sys.EventArgs{constructor(qa){super();this.presence=qa}}Object(D.a)(I,"MyPresenceUpdatedEventArgs",Sys.EventArgs,[]);var K=b(1549),
Y=b(1548),W=b(1546);class Z extends Sys.EventArgs{constructor(qa,Oa=null){super();this.fj=qa;this.cNj=Oa}get type(){return this.fj}get z9(){return this.cNj}}Object(D.a)(Z,"UpdateNotificationEventArgs",Sys.EventArgs,[]);class U extends Sys.EventArgs{constructor(){super()}}Object(D.a)(U,"GotCompletePersistentStateWithMetadataEventArgs",Sys.EventArgs,[]);class X extends Sys.EventArgs{constructor(qa,Oa,Ha,ab,Ra,Pa){super();this.KHc=qa;this.rrf=Oa;this.Mgk=Ha;this.BRh=Ra;this.Sof=ab;this.Ev=Pa}}Object(D.a)(X,
"RefreshAllPersistentStateEventArgs",Sys.EventArgs,[]);class fa extends Sys.EventArgs{constructor(qa){super();this.hubConnection=qa}}Object(D.a)(fa,"RefreshProxyEventArgs",Sys.EventArgs,[]);class ma extends Sys.EventArgs{constructor(qa,Oa){super();this.pta=qa;this.errorMessage=Oa}}Object(D.a)(ma,"RtcConnectFailedEventArgs",Sys.EventArgs,[]);class ka extends Sys.EventArgs{constructor(qa,Oa,Ha){super();this.type=qa;this.presence=Oa;this.okb=Ha}}Object(D.a)(ka,"SendPersistentStateEventArgs",Sys.EventArgs,
[]);class oa extends Sys.EventArgs{constructor(qa,Oa,Ha,ab){super();this.type=qa;this.z9=Oa;this.ytk=Ha;this.okb=ab}}Object(D.a)(oa,"SendUpdateNotificationEventArgs",Sys.EventArgs,[]);class za extends Sys.EventArgs{constructor(){super()}}Object(D.a)(za,"SessionPropertiesChangedEventArgs",Sys.EventArgs,[]);class Ja extends Sys.EventArgs{constructor(qa){super();this.e5d=qa}}Object(D.a)(Ja,"UpdatePersistentStateClearedRequestEventArgs",Sys.EventArgs,[]);class pa extends Sys.EventArgs{constructor(qa,
Oa){super();this.type=qa;this.O_m=Oa}}Object(D.a)(pa,"UpdatePersistentStateRequestEventArgs",Sys.EventArgs,[]);var Na=b(59);class Da{constructor(){this.la=new Na.a}jam(qa,Oa){this.la.raiseEvent("CSC",new R(qa,Oa))}Uam(qa){this.la.raiseEvent("RP",new fa(qa))}nve(qa){this.la.raiseEvent("RC",qa)}Yam(){this.la.raiseEvent("RMID")}Tam(qa,Oa,Ha,ab,Ra,Pa){this.la.raiseEvent("RPS",new X(qa,Oa,Ha,ab,Ra,Pa))}wKi(qa,Oa){this.la.raiseEvent("UPSR",new pa(qa,Oa))}hKi(qa,Oa){this.la.raiseEvent("PU",new W.a(qa,Oa))}Cam(qa){this.la.raiseEvent("MPU",
new I(qa))}nog(qa,Oa,Ha,ab){this.la.raiseEvent("SUN",new oa(qa,Oa,Ha,ab))}jbm(qa,Oa){this.la.raiseEvent("UNR",new Z(qa,Oa))}pKi(qa,Oa,Ha){this.la.raiseEvent("SP",new ka(qa,Oa,Ha))}Qam(qa,Oa){this.la.raiseEvent("PSU",new Y.a(qa,Oa))}Pam(qa){this.la.raiseEvent("PSC",new K.a(qa))}wam(qa){this.la.raiseEvent("IPSC",new K.a(qa))}kbm(qa){this.la.raiseEvent("UPSC",new Ja(qa))}Zam(qa,Oa){this.la.raiseEvent("SPC",new za(qa,Oa))}mKi(qa,Oa){this.la.raiseEvent("RCF",new ma(qa,Oa))}tam(qa){this.la.raiseEvent("CPSWM",
new U(qa))}ibm(qa,Oa){this.la.raiseEvent("UCI",new O(qa,Oa))}Zza(qa){this.la.addHandler("CSC",qa)}Fzd(qa){this.la.removeHandler("CSC",qa)}CVj(qa){this.la.addHandler("RP",qa)}BVj(qa){this.la.addHandler("RC",qa)}GVj(qa){this.la.addHandler("RMID",qa)}AVj(qa){this.la.addHandler("RPS",qa)}VVj(qa){this.la.addHandler("UPSR",qa)}FVa(qa){this.la.addHandler("PU",qa)}E9b(qa){this.la.removeHandler("PU",qa)}ZTj(qa){this.la.addHandler("IPU",qa)}TVj(qa){this.la.addHandler("UCI",qa)}IVj(qa){this.la.addHandler("SUN",
qa)}$Tj(qa){this.la.addHandler("IUNR",qa)}n6(qa){this.la.addHandler("UNR",qa)}kCc(qa){this.la.removeHandler("UNR",qa)}p1d(qa){this.la.addHandler("PSU",qa)}Awe(qa){this.la.removeHandler("PSU",qa)}YTj(qa){this.la.addHandler("IPSU",qa)}o1d(qa){this.la.addHandler("PSC",qa)}zwe(qa){this.la.removeHandler("PSC",qa)}XTj(qa){this.la.addHandler("IPSC",qa)}UVj(qa){this.la.addHandler("UPSC",qa)}HVj(qa){this.la.addHandler("SP",qa)}JVj(qa){this.la.addHandler("SPC",qa)}static getInstance(){return Da.ra||(Da.ra=
new Da)}}Da.ra=null;Object(D.a)(Da,"RtcEventHub",null,[1011]);var Aa=b(108);class Ma{constructor(qa){this.I1c=null;this.R0a=0;this.AWb=!1;this.gm=qa;this.gm.Zza(Object(c.a)(this,this.sna,"onConnectionStateChanged"))}sna(qa,Oa){this.R0a=Oa.newState}yZl(){f.ULS.sendTraceTag(18637070,500,15,"Too many undelivered messages. Restarting RTC connection.");this.gm.nve()}Ajl(qa){this.I1c.init(qa)}}Object(D.a)(Ma,"ARtcMessageHandler",null,[]);class ba{constructor(){this.Presence=null;this.TimeStamp=0}}Object(D.a)(ba,
"PresenceDataEntryForClients",null,[]);var L=b(65);class V{constructor(qa,Oa=""){this.BIj=qa;this.m6a=Oa}send(){return this.BIj()}get messageId(){return this.m6a}}Object(D.a)(V,"MessageHandler",null,[1023]);var ha=b(1323);class la extends Sys.EventArgs{constructor(qa,Oa,Ha,ab){super();this.ptg=qa;this.reconnectDelay=Oa;this.reason=Ha;this.pxg=ab}}Object(D.a)(la,"RefreshConnectionReconnectArgs",Sys.EventArgs,[]);class ya{constructor(){this.c$e=this.If=null}get Wf(){return this.If?this.c$e?this.c$e.getTime()-
this.If.getTime():(new Date).getTime()-this.If.getTime():0}start(){this.If=new Date}stop(){this.c$e=new Date}}Object(D.a)(ya,"SimpleStopwatch",null,[]);var va=b(1399),xa;(function(qa){qa[qa.contentUpdate=0]="contentUpdate";qa[qa.editorsTableUpdate=1]="editorsTableUpdate";qa[qa.fileNameUpdate=2]="fileNameUpdate";qa[qa.wetContentUpdate=3]="wetContentUpdate";qa[qa.persistedContentUpdate=4]="persistedContentUpdate";qa[qa.clientRtcReconnectRequest=5]="clientRtcReconnectRequest";qa[qa.replicationTelemetry=
6]="replicationTelemetry";qa[qa.lockUpdate=7]="lockUpdate";qa[qa.collabServiceContentUpdate=8]="collabServiceContentUpdate";qa[qa.trackChangeSettingUpdate=9]="trackChangeSettingUpdate";qa[qa.saveTargetUpdate=10]="saveTargetUpdate";qa[qa.uploadToOcsUpdate=11]="uploadToOcsUpdate";qa[qa.labelUpdate=12]="labelUpdate";qa[qa.hostNotificationSubscriptionStatus=13]="hostNotificationSubscriptionStatus";qa[qa.subscribeOrExtend=14]="subscribeOrExtend";qa[qa.elapsedBootTelemetry=15]="elapsedBootTelemetry";qa[qa.clientToClientTelemetryMessage=
16]="clientToClientTelemetryMessage";qa[qa.clientToClientResponseMessage=17]="clientToClientResponseMessage";qa[qa.verifyNotificationPipeline=18]="verifyNotificationPipeline";qa[qa.hostNotificationHeartbeat=19]="hostNotificationHeartbeat";qa[qa.secondaryMetadataUpdate=20]="secondaryMetadataUpdate";qa[qa.last=21]="last"})(xa||(xa={}));Object(D.b)("UpdateNotificationType",xa);class Ia extends Ma{constructor(qa,Oa,Ha,ab,Ra,Pa,bb,hb,Pb,wb){super(bb);this.Rv=null;this.w8g=!1;this.m6a=0;this.a4e=new Aa.a;
this.Uc=qa;this.T$g=this.S$g=0;this.I1c=Oa;this.I1c.q1d(Object(c.a)(this,this.yZl,"onTooManyUndeliveredMessages"));this._clientId=Ha;this.BGj=Ra;this.gm.CVj(Object(c.a)(this,this.oXl,"onRefreshProxyRequired"));this.gm.AVj(Object(c.a)(this,this.mXl,"onRefreshAllPersistentStateRequest"));this.gm.IVj(Object(c.a)(this,this.GR,"sendUpdateNotification"));this.gm.ZTj(Object(c.a)(this,this.kVl,"onInternalPresenceUpdated"));this.gm.$Tj(Object(c.a)(this,this.lVl,"onInternalUpdateNotificationReceived"));this.gm.YTj(Object(c.a)(this,
this.jVl,"onInternalPersistentStateUpdated"));this.gm.XTj(Object(c.a)(this,this.iVl,"onInternalPersistentStateCleared"));this.gm.HVj(Object(c.a)(this,this.EBd,"sendPersistentState"));this.gm.TVj(Object(c.a)(this,this.edc,"updateClientInfo"));this.Jc=Pa;this.xw=ab;this.gv=hb;this.SY=Pb;this.aWc=wb}oXl(qa,Oa){this.Rv=this.BGj(Oa.hubConnection);this.I1c.reset();this.Rv.Wgm(Object(c.a)(this,this.l0,"onPresenceUpdated"));this.Rv.Vgm(Object(c.a)(this,this.V6b,"onPersistentStateUpdated"));this.Rv.Ugm(Object(c.a)(this,
this.czc,"onPersistentStateCleared"));this.Rv.shm(Object(c.a)(this,this.C8,"onUpdateNotificationReceived"))}sna(qa,Oa){this.R0a=Oa.newState;2===Oa.newState&&this.Btm()}Btm(){for(let qa of this.a4e)this.GR(null,new oa(qa.key,qa.value,!1,new n.a));this.a4e=new Aa.a}mXl(qa,Oa){Oa.Sof();for(qa=0;2>qa;++qa)this.htm(qa,Oa)}htm(qa,Oa){try{this.Rv.XIf(qa).done(Ha=>{Oa.KHc(Oa.rrf,"GetCompletePresenceSuccess")&&(Oa.Mgk.QYl(),f.ULS.sendTraceTag(3249540,500,50,"Successfully retrieved complete session state for [{0}]",
this.xw),this.gm.Yam(),this.QWl(qa,Ha),this.gm.tam(Ha),Oa.BRh.La(qa)&&this.gm.pKi(qa,Oa.BRh.J(qa),new n.a))}).fail(Ha=>{const {RtcUtils:ab}=b(1131);Oa.KHc(Oa.rrf,"GetCompletePresenceFail")&&(f.ULS.sendTraceTag(3249541,500,15,"Failed to retrieve complete session state : {0} for [{1}]",ab.QAb(Ha),this.xw),this.gm.nve())}).always(()=>{Oa.Ev&&Oa.Ev.stop()})}catch(Ha){f.ULS.sendTraceTag(595132428,500,10,"Exception thrown while calling hub method GetCompletePersistentStateWithMetadata. Promise not even created. Current event token: {0}, Exception message: {1}",
Oa.rrf,Ha.message)}}EBd(qa,Oa){var {RtcUtils:Ha}=b(1131);qa=Oa.presence;let ab;const Ra=Oa.okb;this.SY.SQ(1,0);try{ab=Ha.B4d(qa,this.aWc)}catch(bb){this.SY.SQ(1,3);f.ULS.sendTraceTag(574407636,500,10,"Exception thrown while trying to serialize presence. Exception message: {0}",bb.message);Ra.setException(bb);return}Ha=new w.a;Ha.W(this._clientId,Object.assign(new ba,{Presence:qa,TimeStamp:(new Date).getTime()}));this.gm.wKi(Oa.type,Ha);if(2!==this.R0a)this.gv.U8b(),this.SY.SQ(1,2),Ra.Ue(null);else{var Pa=
this.m6a.toString();++this.m6a;qa=new V(()=>this.Dtm(Oa.type,ab,Pa),Pa);qa=this.z6i(0,Oa.type).add(qa);qa.Uqe(bb=>{2===bb&&this.SY.SQ(1,6);Ra.Ue(null)});qa.Tqe(()=>{})}}Dtm(qa,Oa,Ha){let ab=null;const Ra=new ya,Pa=new ha.a;f.ULS.sendTraceTag(3249501,500,50,"Sending presence update for [{0}]",this.xw);if(2!==this.R0a)return this.gv.U8b(),this.SY.SQ(1,2),f.ULS.sendTraceTag(7934171,500,15,"Connection is lost - unable to send the message for [{0}]",this.xw),Pa.j$f(),Pa;this.Jc&&20>this.S$g&&(ab=this.Jc.le("WebServiceCall",
"Send Presence Message"),this.S$g++);Ra.start();Pa.Rrd(1);try{this.Rv.updatePersistentState(qa,Oa).done(()=>{this.gv.fpg();this.SY.SQ(1,1);f.ULS.sendTraceTag(3249502,500,50,"Successfully delivered presence update message [{0}] for [{1}]",Ha,this.xw);Pa.cAb(1);Ra&&(Ra.stop(),Ra.Wf>this.Uc.kSi?this.SY.SQ(1,4):this.SY.SQ(1,5))}).fail(bb=>{const {RtcUtils:hb}=b(1131);this.AWb||(this.gv.U8b(),this.SY.SQ(1,3),f.ULS.sendTraceTag(3249503,500,15,"Server failed to process the presence update message [{0}]: [{1}] for [{2}]",
Ha,hb.QAb(bb),this.xw));Pa.cAb(2)}).always(()=>{ab&&ab.stop()})}catch(bb){f.ULS.sendTraceTag(593072906,500,15,"Exception when invoking hub method UpdatePersistentState, error: {1}",bb.message),this.SY.SQ(1,3),Pa.cAb(2)}return Pa}edc(qa,Oa){({RtcUtils:qa}=b(1131));const Ha=Oa.ddk,ab=Oa.okb;let Ra;try{Ra=qa.B4d(Ha,this.aWc)}catch(Pa){f.ULS.sendTraceTag(544318999,500,10,"Exception thrown while trying to serialize clientInfo. Exception message: {0}",Pa.message);ab.setException(Pa);return}try{this.Rv.edc(Ra).done(()=>
{f.ULS.sendTraceTag(544319E3,500,50,"Successfully delivered clientInfo.")}).fail(Pa=>{const {RtcUtils:bb}=b(1131);this.AWb||f.ULS.sendTraceTag(544319001,500,15,"Server failed to process udpate clientInfo: {0}.",bb.QAb(Pa));ab.Ue(null)})}catch(Pa){f.ULS.sendTraceTag(544319002,500,15,"Exception when invoking hub method UpdateClientInfo: error: {0}",Pa.message),ab.Ue(null)}}GR(qa,Oa){({RtcUtils:qa}=b(1131));const Ha=Oa.type,ab=Oa.z9,Ra=Oa.ytk,Pa=Oa.okb;let bb;this.SY.SQ(0,0);try{bb=qa.B4d(ab,this.aWc)}catch(Pb){this.SY.SQ(0,
3);f.ULS.sendTraceTag(574407637,500,10,"Exception thrown while trying to serialize updateHint. Exception message: {0}",Pb.message);Pa.setException(Pb);return}if(2!==this.R0a)Ra?this.a4e.W(Ha,ab):(this.gv.U8b(),this.SY.SQ(0,2)),Pa.Ue(null);else{var hb=this.m6a.toString();++this.m6a;Oa=new V(()=>this.$tm(Ha,bb,hb),hb);Oa=this.z6i(1,Ha).add(Oa);Oa.Uqe(Pb=>{2===Pb&&this.SY.SQ(0,6);Pa.Ue(null)});Oa.Tqe(()=>{})}}$tm(qa,Oa,Ha){let ab=null;const Ra=new ya,Pa=new ha.a;f.ULS.sendTraceTag(3249505,500,50,"Sending update notification for [{0}]",
this.xw);if(2!==this.R0a)return this.gv.U8b(),this.SY.SQ(0,2),f.ULS.sendTraceTag(7934172,500,15,"Connection is lost - unable to send the message for [{0}]",this.xw),Pa.j$f(),Pa;this.Jc&&3===qa&&20>this.T$g&&(ab=this.Jc.le("WebServiceCall","Send WetContent Update"),this.T$g++);Ra.start();Pa.Rrd(1);this.Rv.GR(qa,Oa).done(()=>{this.gv.fpg();this.SY.SQ(0,1);f.ULS.sendTraceTag(3249506,500,50,"Successfully delivered update notification message [{0}] for [{1}]",Ha,this.xw);Pa.cAb(1);Ra&&(Ra.stop(),Ra.Wf>
this.Uc.kSi?this.SY.SQ(0,4):this.SY.SQ(0,5))}).fail(bb=>{const {RtcUtils:hb}=b(1131);this.AWb||(this.gv.U8b(),this.SY.SQ(0,3),f.ULS.sendTraceTag(3249507,500,15,"Server failed to process the update notification message [{0}] : [{1}] for [{2}]",Ha,hb.QAb(bb),this.xw));Pa.cAb(2)}).always(()=>{ab&&ab.stop()});return Pa}Dca(){this.Rv.rVm(Object(c.a)(this,this.l0,"onPresenceUpdated"));this.Rv.qVm(Object(c.a)(this,this.V6b,"onPersistentStateUpdated"));this.Rv.pVm(Object(c.a)(this,this.czc,"onPersistentStateCleared"));
this.Rv.vVm(Object(c.a)(this,this.C8,"onUpdateNotificationReceived"))}kVl(qa,Oa){this.l0(Oa.yxa,Oa.W8d)}l0(qa){this.gv.wyd();this.V6b(0,qa)}jVl(qa,Oa){this.V6b(Oa.type,Oa.yxa)}QWl(qa,Oa){const Ha={};for(let ab in Oa)Ha[ab]=Oa[ab].Presence;this.RBi(qa,Ha,Oa)}V6b(qa,Oa){this.gv.wyd();this.RBi(qa,Oa)}RBi(qa,Oa,Ha=null){var {RtcUtils:ab}=b(1131);if(f.ULS.O0(500,100))for(var Ra in Oa);delete Oa[this._clientId];if(!L.a.isEmpty(Oa)){for(var Pa in Oa)Ra=Pa,Oa[Ra]=ab.deserialize(Oa[Pa],"Presence",Ra,!1,this.aWc);
ab=new w.a;Pa=(new Date).getTime();for(let bb in Oa){Ra=Oa[bb];let hb=bb,Pb;Ha?(Pb=Ha[hb],Pb.Presence=Ra):Pb=Object.assign(new ba,{Presence:Ra,TimeStamp:Pa});ab.W(hb,Pb)}this.gm.wKi(qa,ab);qa?this.gm.Qam(qa,Oa):(this.w8g||(f.ULS.sendTraceTag(4539734,500,50,"Raising first presence update notification for [{0}]",this.xw),this.w8g=!0,z.AFrameworkApplication.vg&&z.AFrameworkApplication.vg.cJl()),this.gm.hKi(Oa,[]))}}iVl(qa,Oa){this.czc(Oa.e5d)}czc(qa){this.gv.wyd();if(f.ULS.O0(500,100))for(let Oa=0;Oa<
qa.length;++Oa);qa.length&&(this.gm.kbm(qa),this.gm.Pam(qa),this.gm.hKi({},qa))}lVl(qa,Oa){this.C8(Oa.type,Oa.z9)}C8(qa,Oa=null){this.Uc.WDm&&!qa&&f.ULS.sendTraceTag(40128990,500,100,"Received ContentUpdate notification from the server");this.Uc.XDm&&13===qa&&f.ULS.sendTraceTag(575221780,500,50,String.format("Received HostSubscription notification from the server : {0}",Oa||"<none>"));this.gv.wyd();5===qa?(Oa=(qa=this.q2l(Oa))?String.format("Received client reconnection request from the server. Reason: {0}, Backoff time: {1} ",
qa.reason,qa.reconnectDelay):"Received client reconnection request from the server without params.",f.ULS.sendTraceTag(18637071,500,50,Oa),this.gm.nve(qa)):(Oa=b(1131).RtcUtils.deserialize(Oa,String.format("UpdateNotification-{0}",xa[qa]),null,this.Uc.lHl,this.aWc),this.gm.jbm(qa,Oa))}q2l(qa){try{if(!qa||""===qa)return null;const Oa=JSON.parse(qa);return new la(Oa[va.a.Svg],Oa[va.a.Npm],Oa[va.a.Qpm],Oa[va.a.pxg])}catch(Oa){return f.ULS.sendTraceTag(593844380,500,15,"Error when parsing reconnect hint: {0}",
Oa.message),null}}z6i(qa,Oa){return this.I1c.y8k(this.z8k(qa,Oa))}z8k(qa,Oa){return qa+","+Oa}}Object(D.a)(Ia,"RtcMessageHandler",Ma,[]);class mb{sIh(qa,Oa=""){const {MaxOutstandingThrottler:Ha}=b(1396);return Ha.createInstance(qa,Oa)}$mk(qa,Oa=""){const {MaxRateThrottler:Ha}=b(1398);return Ha.createInstance(qa,Oa)}}Object(D.a)(mb,"ThrottlerFactory",null,[1009]);var gb=b(1400);class Za{constructor(qa){this.Uc=null;this.oe=!1;this.la=new Na.a;this.d0e=new w.a;this.b0e=new w.a;this.uaf=qa;this.ghc=
this.uaf.sIh(Oa=>Oa.send(),"GlobalMaxOustandingThrottler");this.ghc.q1d(()=>{this.la.raiseEvent("TMUDM")})}init(qa){this.oe||(this.Uc=qa,this.ghc.init(this.Uc.$Eb,this.Uc.Fal),this.oe=!0)}y8k(qa){var {MaxRateThrottler:Oa}=b(1398),{MaxOutstandingThrottler:Ha}=b(1396);this.oe||this.init(new gb.a(Oa.yKh,Ha.OKh,Ha.IKh,Za.lKl));({value:Oa}=this.d0e.tb(qa)).returnValue||(({value:Oa}=this.b0e.tb(qa)).returnValue||(Oa="MaxOutstandingThrottler-"+qa,Oa=this.uaf.sIh(Object(c.a)(this.ghc,this.ghc.add,"add"),
Oa),Oa.init(this.Uc.$Eb,this.Uc.kKl),Oa.q1d(()=>{this.la.raiseEvent("TMUDM")}),this.b0e.add(qa,Oa)),Ha="MaxRateThrottler-"+qa,Oa=this.uaf.$mk(Object(c.a)(Oa,Oa.add,"add"),Ha),Oa.init(this.Uc.ILl),this.d0e.add(qa,Oa));return Oa}reset(){for(let qa of this.d0e)qa.value.hpg();for(let qa of this.b0e)qa.value.hpg(),qa.value.reset();this.ghc.hpg();this.ghc.reset()}q1d(qa){this.la.addHandler("TMUDM",qa)}}Za.lKl=1E3;Object(D.a)(Za,"ThrottlerManager",null,[1010]);var $a;(function(qa){qa[qa.unspecified=0]="unspecified";
qa[qa.word=1]="word";qa[qa.excel=2]="excel";qa[qa.powerPoint=3]="powerPoint";qa[qa.test=4]="test";qa[qa.wacFrontEnd=5]="wacFrontEnd";qa[qa.oneNote=6]="oneNote";qa[qa.visio=7]="visio";qa[qa.officeMobile=8]="officeMobile";qa[qa.last=9]="last"})($a||($a={}));Object(D.b)("RtcClientAppName",$a);const cb=(qa,Oa,Ha,ab,Ra,Pa,bb,hb,Pb=null,wb=null,Fb=null,Ta=null)=>{const Zb=G.createInstance(z.AFrameworkApplication.K),Db=z.AFrameworkApplication.buildVersion?z.AFrameworkApplication.buildVersion:"1.0",pb=La(qa,
Oa,bb,Db),nb=Zb.edk?b(1547).RealtimeChannelMetrics.createInstance(pb):new C;var ub=b(1172).FrequentLoggingMetrics.create(Ra);Zb.Spm&&ub.XKm(Zb.Rpm);var kb="";kb=Pb&&""!==Pb?Pb:"/rtc2/";ub.jTh=t.a.p7(kb);const zc=kb+"signalr";Pb=kb+"findsession";const Qc=J.mhl;kb=new mb;Fb=Fb||Da.getInstance();f.ULS.shipAssertTag(556867617,500,Zb.mSi<=b(1180).RealtimeChannel.fui,"Client attempting to override max payload size beyond absolute limit");const md=Math.min(Zb.mSi,b(1180).RealtimeChannel.fui);ub.eui=md;ub=
new Ia(Zb,new Za(kb),qa,pb,vd=>new M(vd.createHubProxy(Qc)),hb,Fb,nb,ub,md);wb||(wb=b(1434).FindSessionStrategy.createInstance(Oa,Ra,Pb,hb,Db,bb,qa,pb,Fb,Pa,ab,Ta));wb.Cae=Zb.Cae;Oa=new S(pb);Ha=Ha?Ha.split(","):null;qa=new (b(1180).RealtimeChannel)(qa,Ha,pb,hb,()=>$.hubConnection(zc),wb,ub,Oa,Fb,nb,Zb,Ra);qa.init();return qa},La=(qa,Oa,Ha)=>String.format("ClientID={0}, App={1}, ClientType={2}, SessionId={3}",qa,Ya($a[Ha]),Ya("browser"),Oa),Ya=qa=>qa?qa.charAt(0).toLocaleUpperCase()+qa.substring(1,
qa.length):qa;b.d(P,"RealtimeChannel",function(){return Eb});class Eb{constructor(qa,Oa,Ha,ab,Ra,Pa,bb,hb,Pb,wb,Fb,Ta){this.a$e=!1;this.fda=null;this.P5=new w.a;this.TNc=1;this.sja=null;this.Fi=!1;this.aZe=(new Date(0)).getTime();this.Xhh=0;this._clientId=qa;this.$Zd=Oa;this.gda=0;this.Jc=ab;this.WMe=hb;this.eIj=bb;this.gmj=Pb;this.tqj=Ra;this.Qlb=Pa;this.xw=Ha;this.gv=wb;this.Uc=Fb;this.Re=Ta;this.bKj=1>100*Math.random()}get $zb(){return this.Qlb.$zb}set $zb(qa){this.Qlb.$zb=qa}get UCb(){return this.eIj}get gm(){return this.gmj}init(){this.gm.BVj(Object(c.a)(this,
this.U8d,"disconnectAndCreateNewConnection"));this.gm.VVj(Object(c.a)(this,this.PZl,"onUpdatePersistentStateRequestReceivedInternal"));this.gm.UVj(Object(c.a)(this,this.OZl,"onUpdatePersistentStateClearedRequestReceived"));this.Re.fRb(this.gv);z.AFrameworkApplication.cL(()=>{const {FrequentLoggingMetrics:qa}=b(1172);this.gv.ipg();qa.instance&&qa.instance.f7f()});this.AIh();this.Avk();this.gm.JVj(Object(c.a)(this,this.SWm,"updateConnectionQueryString"))}Avk(){try{const Ha=$.signalR;if(!Ha)throw Error.invalidOperation("Failed to retrieve Signalr object");
const ab=Ha.version;if(!ab)throw Error.invalidOperation("Signalr object is missing version information");if("2.1.1"===ab){var qa=Ha.transports;if(!qa)throw Error.invalidOperation("Failed to retrieve transports object");var Oa=qa.longPolling;if(!Oa)throw Error.invalidOperation("Failed to retrieve longPolling object");if(!Oa.supportsKeepAlive)throw Error.invalidOperation("LongPolling object does not have a field called supportsKeepAlive");Oa.supportsKeepAlive=this.Mok()}}catch(Ha){f.ULS.sendTraceTag(6432339,
500,15,"Failed to disable longPolling KeepAlives: {0}",Ha.message)}}Mok(){return()=>!1}AIh(){const qa=++this.TNc;this.aZe=(new Date(0)).getTime();this.sja=this.tqj();this.gm.Uam(this.sja);this.sja.stateChanged(Oa=>{this.NSl(Oa,qa)});this.sja.connectionSlow(Object(c.a)(this,this.KYl,"onSlowConnection"));this.sja.error(Object(c.a)(this,this.EYl,"onSignalRError"));this.sja.log=Object(c.a)(this,this.FYl,"onSignalRLog")}KHc(qa,Oa){return qa!==this.TNc?(f.ULS.sendTraceTag(4309017,500,50,"ConnectionToken verification failed for {0}",
Oa),!1):!0}connect(){2!==this.gda&&1!==this.gda&&(f.ULS.sendTraceTag(4539721,500,50,"Starting a new RTC connection for client [{0}]",this.xw),this.WMe.KSl(),A.a.instance.YKm(),this.sna(1,this.gda),this.j3i())}j3i(){const qa=this.TNc;this.a$e=!1;this.gv.jLi();this.Qlb.J4k(Object(c.a)(this,this.Kgk,"connectSignalrConnection"),Object(c.a)(this,this.sAi,"onFailureToConnect"),Object(c.a)(this.UCb,this.UCb.Ajl,"initThrottlerManager"),Object(c.a)(this,this.KHc,"verifyConnectionToken"),qa)}sAi(qa=null){this.gv.lLi();
let Oa=null;!qa||"documentsessiondeleted"!==(Oa=qa.toLowerCase())&&"documentsessionexpired"!==Oa?this.U8d():(f.ULS.sendTraceTag(41788292,500,15,"In RealtimeChannel method OnFailureToConnect: Disconnect was called for [{0}], due to non-retriable RtcErrorCode:{1}",this.xw,qa),this.disconnect())}U8d(qa,Oa=null){f.ULS.sendTraceTag(4309018,500,50,"Disconnecting the connection [{0}]",this.fda);qa=(qa=2===this.gda||1===this.gda)&&!this.UCb.AWb;let Ha=!0,ab=0;Oa&&Object.getType(Oa)!==Object.getType(Sys.EventArgs.Empty)&&
Oa.ptg&&""!==Oa.ptg&&(qa=!0,this.Qlb.Tzm(Oa.ptg),Ha=Oa.pxg,ab=Oa.reconnectDelay);qa&&this.sna(1,this.gda);++this.TNc;this.UCb.Dca();this.QLm(Ha);this.Qlb.Hwk();this.AIh();qa&&window.setTimeout(Object(c.a)(this,this.j3i,"startConnecting"),Math.min(ab,3E4))}SWm(){let qa=null;const Oa=({correlationId:qa}=this.Qlb.i_h()).returnValue;this.sja.qs=Oa;f.ULS.sendTraceTag(40768457,500,50,"Connection parameters refresh finished for client [{0}], CorrelationId:{1}",this.xw,qa)}Kgk(qa){const {FrequentLoggingMetrics:Oa}=
b(1172);this.aZe=(new Date).getTime();let Ha=null;this.sja.qs=({correlationId:Ha}=this.Qlb.i_h()).returnValue;this.Uc.kXj&&(this.sja.url=qa,Oa.instance&&(Oa.instance.cFh=t.a.p7(qa)));let ab=null;this.Jc&&(ab=this.Jc.le("WebServiceCall","ConnectToServer"));f.ULS.sendTraceTag(3290048,500,50,"Connecting to server for client [{0}]",this.xw);qa={};this.$Zd&&(qa.transport=1===this.$Zd.length?this.$Zd[0]:this.$Zd);qa.pingInterval=null;A.a.instance.vyd(1,0);qa.waitForPageLoad=!1;this.sja.start(qa,null).done(Ra=>
{this.gv.mLi();A.a.instance.vyd(1,1,!0);f.ULS.sendTraceTag(3457857,500,50,"Successfully connected to server using connection [{0}], CorrelationId:{1}",Ra.id,Ha)}).fail(Ra=>{const {RtcUtils:Pa}=b(1131);f.ULS.sendTraceTag(3457858,500,15,"Failed to connect to server : connection string: {0}, CorrelationId:{1}, callback parameter:{2} for [{3}]",this.Qlb.YZ,Ha,Pa.QAb(Ra),this.xw);this.sAi();this.gv.kLi(Ra);A.a.instance.vyd(1,1,!1);this.gm.mKi(0,{["CorrelationId"]:Ha,["ErrorDetails"]:Ra,["ConnectionState"]:m.a[this.gda]})}).always(()=>
{const {FrequentLoggingMetrics:Ra}=b(1172);ab&&ab.stop();Ra.instance&&(Ra.instance.SQe=!1)})}disconnect(){const {FrequentLoggingMetrics:qa}=b(1172);this.gda?(this.gv.qLi(),qa.instance&&(qa.instance.SQe=!0),f.ULS.sendTraceTag(36545633,500,50,"Starting explicit disconnect for [{0}]",this.xw),this.UCb.AWb=!0,this.WMe.wTl(),this.sna(0,this.gda),this.U8d(),this.UCb.AWb=!1):f.ULS.sendTraceTag(36545632,500,50,"Disconnect for [{0}] was called but the channel is already Disconnected",this.xw)}QLm(qa){const Oa=
this.p8j(),Ha=this.sja,ab=this.fda,Ra=()=>{if(this.a$e)f.ULS.sendTraceTag(591692192,500,15,"Stop connection was called twice, possibly on the same connection.");else try{this.a$e=!0,Ha.stop(!0,qa)}catch(Pa){f.ULS.sendTraceTag(591692191,500,15,"Stopping connection failed: {0}",Pa.message)}};0<Oa?(f.ULS.sendTraceTag(4309020,500,50,"Waiting to stop connection [{0}]: [{1}] ms.",ab,Oa),window.setTimeout(Ra,Oa)):(f.ULS.sendTraceTag(36804372,500,50,"Stopping connection [{0}].",ab),Ra())}p8j(){let qa=0;this.sja.state||
(qa=this.aZe+Eb.r2m-(new Date).getTime(),0>qa&&(qa=0));return qa}get connectionState(){return this.gda}Zza(qa){this.gm.Zza(qa)}Fzd(qa){this.gm.Fzd(qa)}ZUi(qa){this.EBd(0,qa)}EBd(qa,Oa){const Ha=new n.a;this.gm.pKi(qa,Oa,Ha);return Ha.task}FVa(qa){this.gm.FVa(qa)}E9b(qa){this.gm.E9b(qa)}p1d(qa){this.gm.p1d(qa)}Awe(qa){this.gm.Awe(qa)}o1d(qa){this.gm.o1d(qa)}zwe(qa){this.gm.zwe(qa)}sjd(qa){return this.P5.La(qa)&&this.P5.J(qa).La(0)?this.P5.J(qa).J(0).data:null}GXb(){return this.GHf(0)}GHf(qa){const Oa=
{};for(let Ha of this.P5)Ha.value.La(qa)&&(Oa[Ha.key]=Ha.value.J(qa).data);return Oa}PZl(qa,Oa){for(let Ha of Oa.O_m)this.P5.La(Ha.key)||this.P5.W(Ha.key,new Aa.a),qa=Ha.value,this.P5.J(Ha.key).W(Oa.type,new B(qa.Presence,new Date(qa.TimeStamp))),Ha.key!==this._clientId||Oa.type||this.gm.Cam(qa.Presence)}OZl(qa,Oa){for(const Ha of Oa.e5d)this.P5.remove(Ha)}EMk(){const qa=new Aa.a;if(!this.P5.La(this._clientId))return qa;for(let Oa of this.P5.J(this._clientId))qa.W(Oa.key,Oa.value.data);return qa}GR(qa,
Oa=null,Ha=!1){const ab=new n.a;this.gm.nog(qa,Oa,Ha,ab);return ab.task}n6(qa){this.gm.n6(qa)}kCc(qa){this.gm.kCc(qa)}mvb(qa){let Oa,Ha;return({value:Oa}=this.P5.tb(qa)).returnValue&&({value:Ha}=Oa.tb(0)).returnValue?new v(this.a$k(Ha),Ha.timeStamp):null}Ued(){const qa={};for(let Oa of this.P5)Oa.value.tb(0).returnValue&&(qa[Oa.key]=this.mvb(Oa.key));return qa}edc(qa){const Oa=new n.a;this.gm.ibm(qa,Oa);return Oa.task}get clientId(){return this._clientId}get sIm(){return this.bKj}dispose(){const {FrequentLoggingMetrics:qa}=
b(1172);this.Fi||(this.UCb.Dca(),this.Re.ozd(this.gv),this.gv.ipg(),qa.instance&&qa.instance.f7f(),this.Fi=!0)}NSl(qa,Oa){this.KHc(Oa,"StateChangedSignalR")&&this.sna(this.zGh(qa.newState),this.zGh(qa.oldState))}sna(qa,Oa){var {FrequentLoggingMetrics:Ha}=b(1172),{ClientToClientMessageTelemetry:ab}=b(1452);if((1!==this.gda||Oa||1!==qa)&&this.gda!==Oa){const Ra=String.format.apply(null,["Unexpected connection state change : Current state is '{0}' while the event indicates ('{1}'->'{2}') transition"].concat([this.gda,
Oa,qa]));f.ULS.sendTraceTag(3290053,500,10,Ra)}if(this.gda!==qa){switch(qa){case 2:Ha.instance&&Ha.instance.iJl();this.fda=this.sja.id;f.ULS.sendTraceTag(3249539,500,50,"Established connection [{0}] for client [{1}]",this.fda,this.xw);this.fHl(this.sja);f.ULS.sendTraceTag(4298369,500,50,"Retrieving complete session state");Ha=null;this.Jc&&(Ha=this.Jc.le("WebServiceCall","Receive First Presence"));ab=this.TNc;this.gm.Tam(Object(c.a)(this,this.KHc,"verifyConnectionToken"),ab,this.WMe,Object(c.a)(this,
this.Sof,"clearExistingPersistentState"),this.EMk(),Ha);this.Uc.Opm&&(Ha=100*Math.random()<=this.Uc.Ppm,b(1452).ClientToClientMessageTelemetry.r0k(this.gm,this.Uc,Ha).start());break;case 1:2===Oa&&f.ULS.sendTraceTag(4298644,500,50,"Lost connection [{0}] to the server ...trying to re-establish it",this.fda);break;case 0:if(ab.instance&&ab.instance.stop(),this.UCb.AWb)f.ULS.sendTraceTag(3249543,500,50,"Connection [{0}] has been explicitly closed",this.fda);else{1===Oa&&(f.ULS.sendTraceTag(7672737,500,
50,"Signalr detected an unexpected disconnect event while attempting to re-establish connection [{0}]. Kicking off global reconnect logic ...",this.fda),this.gv.rLi());2===Oa&&f.ULS.sendTraceTag(36574532,500,50,"Signalr detected a disconnect event triggered by a period of client inactivity for connection [{0}]. Kicking off global reconnect logic ...",this.fda);this.U8d();return}}this.gda=qa;this.gm.jam(qa,Oa)}}fHl(qa){if(qa&&qa.transport&&qa.transport.name){qa=qa.transport.name;var Oa=qa.toLowerCase();
"websockets"===Oa?f.ULS.sendTraceTag(4290723,500,50,"Transport name - {0} for [{1}]",qa,this.xw):"serversentevents"===Oa?f.ULS.sendTraceTag(4290752,500,50,"Transport name - {0} for [{1}]",qa,this.xw):"foreverframe"===Oa?f.ULS.sendTraceTag(4290753,500,50,"Transport name - {0} for [{1}]",qa,this.xw):"longpolling"===Oa?f.ULS.sendTraceTag(4290754,500,50,"Transport name - {0} for [{1}]",qa,this.xw):"mocktransport"!==Oa&&f.ULS.sendTraceTag(4290755,500,15,"Unknown transport protocol encountered - '{0}'",
qa)}else f.ULS.sendTraceTag(4290722,500,10,"Transport protocol name is missing")}KYl(){f.ULS.sendTraceTag(3249544,500,50,"Detected that the connection [{0}] is slow",this.fda)}EYl(qa){const {RtcUtils:Oa}=b(1131);f.ULS.sendTraceTag(3249545,600,10,"SignalR ERROR for connection [{0}]: {1}",this.fda,Oa.QAb(qa)||"<empty>")}FYl(qa){qa=b(1131).RtcUtils.QAb(qa);this.sIm&&2E3>this.Xhh&&!qa.startsWith("Invok")&&!qa.startsWith("Trigger")&&(f.ULS.sendTraceTag(578950464,500,50,"SignalR lib: {0}",qa),this.Xhh++)}Sof(){let qa;
const Oa=[];({value:qa}=this.P5.tb(this._clientId)).returnValue&&this.P5.remove(this._clientId);for(let Ha of this.P5.keys)Array.add(Oa,Ha);for(const Ha of Oa)this.P5.remove(Ha);qa&&this.P5.W(this._clientId,qa);this.gm.wam(Oa)}zGh(qa){switch(qa){case 0:return 1;case 2:return 1;case 1:return 2;case 4:return 0;default:throw Error.argumentOutOfRange("state",qa,"Unknown SignalR state");}}a$k(qa){return qa&&qa.timeStamp?(new Date).getTime()-qa.timeStamp.getTime()>(this.Uc.v1j?6E4:this.Uc.u1j)?2:1:1}static createInstance(qa,
Oa,Ha,ab,Ra,Pa,bb,hb=null,Pb=null,wb=null,Fb=null,Ta=null,Zb=null){return cb(qa,Oa,Ha,Zb,ab,Ra,Pa,bb,hb,Pb,wb,Ta,Fb)}}Eb.fui=31E3;Eb.Rne=8E3;Eb.r2m=15E3;Object(D.a)(Eb,"RealtimeChannel",null,[986,987])},1295:function(D,P,b){b.d(P,"a",function(){return f});D=b(0);class f{constructor(){this.Uih=!1;this.FVd=null;this.hXg=0;this.xRe=this.tJh();this.lMd=this.tJh();this.MHb=this.ahc=0;this.HG=()=>new Date}get DMm(){return this.Uih}tJh(){const c=Array(6);for(let n=0;n<c.length;n++)c[n]=0;return c}rUk(){return this.xRe.toString()}vQk(){return this.lMd.toString()}YKm(){this.FVd=
this.HG()}vyd(c,n,m=!1){this.DMm||(m&&(this.Uih=!0),m=this.HG(),!c&&5<this.ahc||1===c&&5<this.MHb||(this.hXg<c?(1===this.ahc%2&&(this.xRe[this.ahc]=-1,this.ahc++),this.hXg=c,1===n&&(this.lMd[this.MHb]=-1,this.MHb++),this.lMd[this.MHb]=this.qGg(m),this.MHb++):c?(this.lMd[this.MHb]=this.qGg(m),this.MHb++):(this.xRe[this.ahc]=this.qGg(m),this.ahc++)))}qGg(c){const n=c.getTime()-this.FVd.getTime();this.FVd=c;return n}static get instance(){f.ra||(f.ra=new f);return f.ra}static set instance(c){f.ra=c}}
f.ra=null;Object(D.a)(f,"LatencyMetrics",null,[])},1323:function(D,P,b){D=b(0);class f{constructor(){this.MUg=this.QMe=!1;this.callback=null}bud(n){this.callback=n;this.l8i()}Fti(n){this.QMe||(this.QMe=!0,this.pqj=n,this.l8i())}l8i(){this.QMe&&this.callback&&!this.MUg&&(this.MUg=!0,this.callback(this.pqj))}}Object(D.a)(f,"CompletionTask",null,[]);b.d(P,"a",function(){return c});class c{constructor(){this.x9g=new f;this.w9g=new f}Uqe(n){this.x9g.bud(n)}Tqe(n){this.w9g.bud(n)}Rrd(n){this.x9g.Fti(n)}cAb(n){this.w9g.Fti(n)}j$f(){this.Rrd(2);
this.cAb(2)}}Object(D.a)(c,"MessageStatus",null,[1024])},1395:function(D,P,b){b.d(P,"a",function(){return f});D=b(0);var f;(function(c){c[c.disconnected=0]="disconnected";c[c.connecting=1]="connecting";c[c.connected=2]="connected"})(f||(f={}));Object(D.b)("ChannelConnectionState",f)},1396:function(D,P,b){b.r(P);b.d(P,"MaxOutstandingThrottler",function(){return m});D=b(0);var f=b(42),c=b(59);P=b(1397);var n=b(1323);class m extends P.a{constructor(w,z=""){super(w,z);this.Rxc=this.$Eb=0;this.la=new c.a;
this.aic=!1;this.UTd=this.LMd=this.mMd=this.taf=0;this.e6=[];this.clearTimeout=m.qxf}add(w){this.bic||this.init(m.OKh,m.IKh);this.LPb++;const z=new n.a;this.Zvc?this.cAe(w,z):this.UTd<this.Rxc?this.CBd(w,z):(this.cAe(w,z),this.aic=!1);return z}CBd(w,z){w=this.Igh(w);const v=this.setTimeout(Object(f.a)(this,this.XVl,"onMessageWaitTimeExpired"),this.$Eb);++this.UTd;Array.add(this.e6,v);const t=this.mMd;w.Uqe(A=>{z.Rrd(A)});w.Tqe(A=>{this.mMd===t&&(this.WVl(t,v),z.cAb(A))})}WVl(w,z){this.mMd===w&&(--this.UTd,
this.clearTimeout(z),Array.remove(this.e6,z),this.Zvc&&this.Ttm())}Ttm(){this.Zvc&&!this.aic&&(this.taf=this.setTimeout(Object(f.a)(this,this.Utm,"sendThrottledMessageFromTimer"),0),this.aic=!0)}Utm(){this.aic=!1;if(this.Zvc){const w=this.AZd,z=this.qlc;this.z7c(!1);this.CBd(w,z)}}XVl(){++this.LMd;this.LMd>Math.floor(this.Rxc/2)&&(this.LMd=-1E9,this.la.raiseEvent("TMUDM"))}q1d(w){this.la.addHandler("TMUDM",w)}reset(){this.LPb=this.H1c=this.IPc=this.LMd=0;++this.mMd;for(const w of this.e6)this.clearTimeout(w);
this.UTd=0;this.e6=[];this.z7c(!0);this.aic&&(this.clearTimeout(this.taf),this.taf=0,this.aic=!1)}init(w,z){this.bic||(this.$Eb=w,this.Rxc=z,this.bic=!0)}static createInstance(w,z=""){return new m(w,z)}static qxf(w){window.clearTimeout(w)}}m.OKh=15E3;m.IKh=5;Object(D.a)(m,"MaxOutstandingThrottler",P.a,[1020,1021])},1397:function(D,P,b){b.d(P,"a",function(){return c});D=b(0);var f=b(10);class c{constructor(n,m=""){this.IPc=this.H1c=0;this.XWe=!1;this.qlc=this.AZd=null;this.bic=!1;this.Igh=n;this.A6i=
m;this.setTimeout=c.xxf;this.LPb=this.H1c=this.IPc=0}hpg(){0<this.LPb&&0<this.IPc&&f.ULS.sendTraceTag(36545635,500,50,"Throttler [{0}] dropped [{1}] messages out of [{2}]",this.A6i,this.IPc,this.LPb);0<this.LPb&&0<this.H1c&&f.ULS.sendTraceTag(36545634,500,50,"Throttler [{0}] throttled [{1}] messages out of [{2}]",this.A6i,this.H1c,this.LPb)}get Zvc(){return this.XWe}cAe(n,m){this.H1c++;this.z7c(!0);this.XWe=!0;this.AZd=n;this.qlc=m}z7c(n){this.XWe=!1;this.qlc&&n&&(this.IPc++,this.qlc.j$f());this.qlc=
this.AZd=null}static xxf(n,m){return window.setTimeout(n,m)}}Object(D.a)(c,"ThrottlerBase",null,[])},1398:function(D,P,b){b.r(P);b.d(P,"MaxRateThrottler",function(){return n});D=b(0);var f=b(42);P=b(1397);var c=b(1323);class n extends P.a{constructor(m,w=""){super(m,w);this.Txc=0;this.JUc=(new Date(0)).getTime();this.currentTime=()=>(new Date).getTime()}init(m){this.bic||(this.Txc=m,this.bic=!0)}add(m){this.bic||this.init(n.yKh);this.LPb++;const w=this.currentTime(),z=new c.a;this.JUc>w&&(this.JUc=
w);this.Zvc?(this.z7c(!0),this.cAe(m,z)):this.JUc+this.Txc<=w?this.CBd(m,z):(this.cAe(m,z),this.setTimeout(Object(f.a)(this,this.Stm,"sendThrottledMessage"),this.JUc+this.Txc-w));return z}Stm(){if(this.Zvc){const m=this.AZd,w=this.qlc;this.z7c(!1);this.CBd(m,w)}}CBd(m,w){this.JUc=this.currentTime();m=this.Igh(m);m.Uqe(z=>{w.Rrd(z)});m.Tqe(z=>{w.cAb(z)})}static createInstance(m,w=""){return new n(m,w)}}n.yKh=200;Object(D.a)(n,"MaxRateThrottler",P.a,[1022,1021])},1399:function(D,P,b){b.d(P,"a",function(){return f});
D=b(0);class f{}f.Svg="rr";f.Qpm="rd";f.Npm="rbp";f.pxg="sa";Object(D.a)(f,"RtcReconnectParams",null,[])},1400:function(D,P,b){b.d(P,"a",function(){return f});D=b(0);class f{constructor(c,n,m,w){this.ILl=c;this.$Eb=n;this.kKl=m;this.Fal=w}}Object(D.a)(f,"ThrottlerManagerSettings",null,[])},1434:function(D,P,b){b.r(P);D=b(0);var f=b(10),c=b(42),n=b(74),m=b(1395);class w{}w.Txc="throttling_messageDelay";w.uod="enabled";w.$Eb="throttling_timeToWaitForResponse";w.Rxc="throttling_maxNumberOfOutstandingMessages";
w.C8h="throttling_globalMaxNumberOfOutstandingMessages";w.errorMessage="errorMessage";w.$1i="url";w.IPa="queryString";w.YZ="connectionString";Object(D.a)(w,"RtcFindSessionOutputFieldNameConstants",null,[]);var z=b(2),v=b(44),t=b(33),A=b(254),B=b(1225),S=b(65),C=b(16),H=b(129);class J{constructor(){this.D8h=this.cui=this.dui=this.iui=0;this.Mke=!1;this.correlationId=this.YZ=this.IPa=this.srf=this.errorMessage=null}get Xfk(){return this.srf+"?"+this.IPa}}Object(D.a)(J,"FindSessionResponse",null,[]);
var M=b(513);class G{constructor(fa,ma,ka,oa,za,Ja){this.q7a=null;const {FindSessionStrategy:pa}=b(1434);this.KGj=fa;fa=String.format("{0}={1}",M.a.clientId,C.a.mj(oa));fa=String.format("{0}&{1}={2}",fa,M.a.userSessionId,C.a.mj(za));fa=String.format("{0}&{1}={2}",fa,M.a.uOg,C.a.mj(ka.toString()));fa=String.format("{0}&{1}={2}",fa,M.a.userType,C.a.mj("1"));fa=String.format("{0}&{1}={2}",fa,M.a.GOg,C.a.mj(ma));fa=String.format("{0}&{1}={2}",fa,M.a.wpf,C.a.mj(pa.fdk));(ma=G.VHf(ka,Ja))&&(fa=String.format("{0}&{1}",
fa,ma));this.uqj=fa}hMi(){this.q7a=this.KGj()}FKk(){this.q7a&&""!==this.q7a||(this.hMi(),f.ULS.sendTraceTag(575784194,500,this.q7a&&""!==this.q7a?50:15,"Query signature delegate called for refresh returned: {0} ",this.q7a));const fa=String.format("{0}={1}",M.a.j0a,C.a.mj(this.q7a));return String.format("{0}&{1}",fa,this.uqj)}static VHf(fa,ma){return 4===fa?String.format("{0}={1}",M.a.hcg,"1"):ma?ma.R7h():null}}Object(D.a)(G,"FindSessionQueryStringGenerator",null,[]);var R=b(1172),O=b(1295),I=b(1131),
K=b(1400);class Y{}Y.zGk="FSType";Object(D.a)(Y,"RtcFindSessionRequestHeaders",null,[]);class W{}W.Rbm="polling";Object(D.a)(W,"RtcFindSessionTypes",null,[]);var Z=b(1399);class U{}U.C1m="RTC-TokenProofkey";U.eAl="RTC-IsWacJsBootFsRequest";Object(D.a)(U,"RtcRequestHeaders",null,[]);b.d(P,"FindSessionStrategy",function(){return X});class X{constructor(fa,ma,ka,oa,za,Ja,pa,Na,Da,Aa,Ma,ba,L=null){this.e7g=(new Date(0)).getTime();this.H8g=0;this.XSd=!1;this.Tgh=null;this.Hpg=36E5;this.Hfc=X.rdi;this.nQc=
0;this.V9b=null;this.R0a=0;this.WCc=this.eFh=null;this.IHj=[w.uod,w.errorMessage,w.$1i,w.YZ,w.IPa,w.C8h,w.Rxc,w.$Eb,w.Txc];this.HHj=[w.uod,w.errorMessage];this.YZ=this.$zb=null;this.Z_g=new G(Ma?Ma:()=>z.AFrameworkApplication.zk,za,Ja,pa,fa,ma);this.cNc=ba;this.Jc=oa;this.Re=ma;this.BRe=ka;this.xw=Na;this.gm=Da;this.QQc=L;this.$_g=!1;this.Cae=9E4;Aa&&Aa.execute(V=>{V.EVa(()=>{f.ULS.sendTraceTag(40768456,500,50,"Connection parameters refresh requested for client [{0}]",this.xw);this.Z_g.hMi()})});
2>=100*Math.random()&&(this.Hpg=3E5);R.FrequentLoggingMetrics.instance&&(R.FrequentLoggingMetrics.instance.nVh=this.Hpg)}Tzm(fa){this.WCc=fa}init(){this.gm.GVj(Object(c.a)(this,this.tnm,"resetGetMachineIdDelay"));this.gm.Zza(Object(c.a)(this,this.sna,"onConnectionStateChanged"))}sna(fa,ma){this.R0a=ma.newState;2===ma.newState&&(this.nQc=0)}i_h(){let fa;fa=this.V9b.correlationId;return{returnValue:String.format("{0}&{1}={2}",this.V9b.IPa,X.aHh,C.a.mj(fa)),correlationId:fa}}J4k(fa,ma,ka,oa,za){this.ftm(()=>
{oa(za,"GetMachineIdSuccess")&&(f.ULS.sendTraceTag(17956951,500,50,"Successfully retrieved Rtc MachineId [{0}] for [{1}]",this.YZ,this.xw),fa(this.Tgh),ka(this.A8k()))},Ja=>{oa(za,"GetMachineIdFailure")&&(f.ULS.sendTraceTag(4060129,500,15,"Failed to retrieve Rtc MachineId for [{0}]",this.xw),ma(Ja))},oa,za)}Hwk(){this.mCh();this.Dil()}ftm(fa,ma,ka,oa){f.ULS.sendTraceTag(17956952,500,50,"Retrieving Rtc MachineId from server. Getting from last findsession, connectionString is [{0}]",this.YZ);if(this.YZ)fa();
else{var za=this.O7j();window.setTimeout(()=>{this.sendFindSessionRequestToServerInternal(fa,ma,ka,oa)},za)}}sendFindSessionRequestToServerInternal(fa,ma,ka,oa){ka(oa,"RequestMachineId")&&(this.e7g=(new Date).getTime(),ka=t.a.Ze(),this.ede(za=>{const Ja=t.a.Ze();this.BFi(za);this.Nzg();fa();za=t.a.Ze()-Ja;f.ULS.sendTraceTag(577356039,345,50,"SFSRTS Success - TimeElapsed: {0}",za)},za=>{const Ja=t.a.Ze();this.mCh();R.FrequentLoggingMetrics.instance&&R.FrequentLoggingMetrics.instance.SQ(2,3);ma(za);
za=t.a.Ze()-Ja;f.ULS.sendTraceTag(577356040,345,50,"SFSRTS Failure - TimeElapsed: {0}",za)},!1),ka=t.a.Ze()-ka,f.ULS.sendTraceTag(577599296,345,50,"SFSRTS - TimeElapsed: {0}",ka))}Dil(){this.Hfc+=X.YYk;this.Hfc=Math.min(this.Hfc,X.YJl)}O7j(){var fa=(new Date).getTime();fa=this.e7g+this.Hfc-fa;0>fa&&(fa=0);return fa}BFi(fa){try{this.V9b=fa,this.$zb=fa.Xfk,this.YZ=fa.YZ,this.eFh=fa.IPa,this.Tgh=fa.srf}catch(ma){f.ULS.sendTraceTag(17956953,500,10,"FindSession response contains invalid fields. Exception {0}, is thrown",
ma.toString())}}mCh(){this.YZ=null;this.nCh()}Nzg(){this.nCh();this.XSd=!0;this.H8g=window.setTimeout(Object(c.a)(this,this.Hem,"refreshMachineId"),this.Hpg)}nCh(){this.XSd&&(window.clearTimeout(this.H8g),this.XSd=!1)}Hem(){this.XSd=!1;this.ede(fa=>{const ma=this.eFh!==fa.IPa,ka=this.YZ!==fa.YZ,oa=this.YZ;this.BFi(fa);this.R0a&&(ka?(f.ULS.sendTraceTag(17956955,500,15,"Recycling RTC connection due to RTC machine id change. old={0}, new={1}",oa||"null",fa.YZ),this.gm.nve()):(this.gm.Zam(ma,ka),this.Nzg()))},
()=>{R.FrequentLoggingMetrics.instance&&R.FrequentLoggingMetrics.instance.SQ(2,3);this.Nzg()},!0)}tnm(){this.Hfc=X.rdi}A8k(){return new K.a(this.V9b.iui,this.V9b.dui,this.V9b.cui,this.V9b.D8h)}ZRm(fa){if(Object.getType(fa)!==Object)return null;for(let ma in fa);return this.Flk(fa)}Flk(fa){if(!(w.uod in fa))return null;const ma=fa[w.uod];var ka=ma?this.IHj:this.HHj;for(const oa of ka)if(!(oa in fa))return null;ka=Object.assign(new J,{Mke:fa[w.uod],errorMessage:fa[w.errorMessage],correlationId:H.a.create().toString()});
ma&&(ka.srf=fa[w.$1i],ka.IPa=fa[w.IPa],ka.YZ=fa[w.YZ],ka.D8h=fa[w.C8h],ka.cui=fa[w.Rxc],ka.dui=fa[w.$Eb],ka.iui=fa[w.Txc]);return ka}sUk(fa,ma){f.ULS.sendTraceTag(50448152,500,50,"Using FindSessionUtils find session response");this.QQc.kTh.continueWith(()=>{this.QQc.kTh.result?(f.ULS.sendTraceTag(50448153,500,50,"FindSessionUtils find Session resulted in success"),fa(this.QQc.lTh)):(f.ULS.sendTraceTag(50448154,500,15,"FindSessionUtils find Session resulted in error"),ma(this.QQc.lTh))})}iQi(fa,ma,
ka,oa,za=!1){return Ja=>{O.a.instance.vyd(0,1);fa&&fa.stop();this.cNc=this.WCc=null;this.Yri(Ja.data,!0,ma);var pa=I.RtcUtils.deserialize(Ja.data.wd,"FindSession",null,!0);if(pa)if(pa=this.ZRm(pa)){if(pa.Mke&&pa.IPa&&pa.YZ){f.ULS.sendTraceTag(4317446,500,50,"Successfully retrieved MachineId from server for [{0}]",this.xw);this.cFl(Ja.data);ka(pa);return}ma.FindSessionFailureReason="FindSessionInvalidResponse";ma.IsRtcEnabled=pa.Mke;ma.IsQueryStringEmpty=!pa.IPa;ma.IsConnectionStringEmpty=!pa.YZ;f.ULS.sendTraceTag(4290720,
500,15,"Response did not contain valid MachineId [ConnectionUrl and/or QueryString] for [{0}]; IsRtcEnabled:{1}; IsQueryStringEmpty:{2}; IsConnectionStringEmpty:{3}",this.xw,pa.Mke,!pa.IPa,!pa.YZ)}else ma.FindSessionFailureReason="FindSessionTranslateServerResponseFailed",f.ULS.sendTraceTag(8745097,500,15,"Could not translate server response to findSession response for [{0}]",this.xw);else ma.FindSessionFailureReason="FindSessionDeserializeServerResponseFailed",f.ULS.sendTraceTag(7372827,500,10,"Could not deserialize response data for [{0}]",
this.xw);this.nKi(ma,za);oa(null)}}eQi(fa,ma,ka,oa=!1){return za=>{O.a.instance.vyd(0,1);fa&&fa.stop();this.cNc=this.WCc=null;this.Yri(za.data,!1,ma);let Ja=null;var pa="unknown";let Na="unknown";za.data&&((pa=za.data.Dk)&&X.VAd in pa&&(Ja=pa[X.VAd].toString()),pa=B.a[za.data.status],Na=za.data.mf.toString());ma.FindSessionFailureReason="FindSessionRequestFailed";ma.HttpErrorCode=Na;ma.HttpErrorStatus=pa;ma[X.VAd]=Ja;f.ULS.sendTraceTag(4290721,500,15,"Request for MachineId failed with Status='{0}'; HttpStatus='{1}' for [{2}]; RtcErrorCode='{3}'. Polling: '{4}' '",
pa,Na,this.xw,Ja,oa);this.nKi(ma,oa);ka(Na)}}ede(fa,ma,ka=!1){let oa=null;f.ULS.sendTraceTag(4317445,500,50,"Getting MachineId from server for [{0}]",this.xw);const za={};var Ja=this.Z_g.FKk();za[A.a.rfa]=H.a.create().toString();this.WCc&&""!==this.WCc?Ja=String.format("{0}&{1}={2}",Ja,Z.a.Svg,this.WCc):this.cNc&&""!==this.cNc&&(Ja=String.format("{0}&{1}={2}",Ja,Z.a.Svg,this.cNc),za[U.C1m]="True",za[U.eAl]="True");Ja=this.BRe+"?"+Ja;ka&&(za[Y.zGk]=W.Rbm);const pa={};pa.IsNetworkOfflineBeforeSendRequest=
this.Re.L1b;pa.HasAvailableConnectionsBeforeSendRequest=this.Re.ytc;pa.MaxConnectionsAllowed=this.Re.$Za;pa.IsRefreshMachineId=ka;this.QQc&&!this.$_g?(this.sUk(this.iQi(null,pa,fa,ma,ka),this.eQi(null,pa,ma,ka)),this.$_g=!0):(this.Jc&&(oa=this.Jc.le("WebServiceCall","GetMachineIdFromTheServer")),R.FrequentLoggingMetrics.instance&&R.FrequentLoggingMetrics.instance.SQ(2,0),0>this.Re.nmc(Ja,1,null,za,[X.S6d,X.VAd,X.Btd,X.Rvg,X.qwi,X.Ayi,X.zyi],1,this.iQi(oa,pa,fa,ma,ka),this.eQi(oa,pa,ma,ka),null,!1,
null,this.Cae,"3",null,!0)&&(5<this.nQc&&200>this.nQc&&f.ULS.sendTraceTag(578166985,500,15,"FindSession request not scheduled due to expired token. Manually triggered failure callback {0} times.",this.nQc),window.setTimeout(()=>{this.nQc++;ma("-1")},1E3)))}Yri(fa,ma,ka){ka||(ka={});ka.IsNetworkOfflineAfterRequestComplete=this.Re.L1b;ka.IsRequestSucceeded=ma;fa&&(ka.EnqueueTime=fa.mbb,ka.InvokedTime=fa.PG,ka.CompletedTime=fa.lT,fa.Dk&&(X.S6d in fa.Dk&&(ka.CorrelationId=fa.Dk[X.S6d]),X.Btd in fa.Dk&&
(ka[X.Btd]=fa.Dk[X.Btd])));f.ULS.sendTraceTag(38633565,500,ma?50:15,I.RtcUtils.QAb(ka))}nKi(fa,ma){fa||(fa={});fa.ConnectionState=m.a[this.R0a];ma||this.gm.mKi(1,fa)}cFl(fa){try{var ma=!1,ka=!1,oa=fa.Dk,za=v.a.p7(fa.request.get_url());if(oa&&X.Rvg in oa){const Aa=oa[X.Rvg].toString().toLocaleLowerCase();ka="true"===Aa;ma="false"===Aa}oa=!1;const Da=0<=za.toLocaleLowerCase().indexOf("collab");ka&&!Da?oa=!0:ma&&Da&&(oa=!0);if(oa){ma={};ma.HostName=za;ma.Status=B.a[fa.status];ma.HttpStatus=fa.mf.toString();
var Ja=fa.request.get_headers();for(let Aa in Ja){var pa=Ja[Aa];(za=Aa)&&0<za.length&&(ka=0,pa&&(ka=pa.toString().length),ma["r_"+za]=ka)}if(fa.Dk){const Aa=new n.a;Aa.add(X.S6d);Aa.add(X.Btd);Aa.add(X.VAd);Aa.add(X.Ayi);Aa.add(X.zyi);Aa.add(X.qwi);X.oSj(ma,fa.Dk,Aa)}X.cSj(fa.request.get_url(),ma);var Na=S.a.toJSON(ma);f.ULS.sendTraceTag(559437006,500,15,Na)}}catch(Da){f.ULS.sendTraceTag(559437007,500,10,"DomainLandingIncorretDC exception[{0}]",Da.toString())}}static createInstance(fa,ma,ka,oa,za,
Ja,pa,Na,Da,Aa,Ma,ba=null){return X.xmk(fa,ma,ka,oa,za,Ja,pa,Na,Da,Aa,Ma,ba)}static xmk(fa,ma,ka,oa,za,Ja,pa,Na,Da,Aa,Ma,ba=null){fa=fa||H.a.create().toString();fa=new X(fa,ma,ka,oa,za,Ja,pa,Na,Da,Aa,null,Ma,ba);fa.init();return fa}static oSj(fa,ma,ka){for(let oa of ka)oa in ma&&(fa[oa]=ma[oa])}static cSj(fa,ma){if(fa){var ka=fa.indexOf("?");if(-1!==ka)for(fa=fa.substr(ka+1).split("&"),ka=0;ka<fa.length;++ka){var oa=fa[ka].split("=");if(2===oa.length){const za=oa[0];if(za&&0<za.length){let Ja=0;if(oa=
oa[1])Ja=oa.length;ma["q_"+za]=Ja}}}}}}X.YYk=3E3;X.YJl=3E5;X.fdk="1.0";X.rdi=1E3;X.S6d="X-CorrelationId";X.aHh="corrid";X.VAd="RtcErrorCode";X.Btd="X-OfficeCluster";X.Rvg="X-NewEnv";X.qwi="X-MSEdge-Ref";X.zyi="X-OFFICEFD";X.Ayi="X-OfficeFE";Object(D.a)(X,"FindSessionStrategy",null,[1007])},1452:function(D,P,b){b.r(P);D=b(0);var f=b(10),c=b(42),n=b(364),m=b(52),w=b(74);class z{constructor(t){this.messageId=t;this.Vtm=(new Date).getTime();this.v4f=new w.a}}Object(D.a)(z,"MessageLatencyDetails",null,
[]);b.d(P,"ClientToClientMessageTelemetry",function(){return v});class v{constructor(t,A,B){this.bUa=null;this.N_e=this.p8e=0;this.Uc=A;this.y9g=B;this.V_c=!1;this.gm=t;this.gm.n6(Object(c.a)(this,this.jcm,"receiveMessage"))}start(){if(this.y9g&&!this.V_c){const t=this.Uc.pSi;this.N_e=this.Uc.lSi;t<=this.N_e?(f.ULS.sendTraceTag(570975114,500,15,"LogMetrics cannot be started because configuration values are incorrect. RtcSendTelemetryMessageIntervalInMS({0}) should be greater than RtcLogClientMessageMetricsTimeOutInMs({1})",
this.Uc.pSi,this.Uc.lSi),this.y9g=!1):(this.V_c=!0,this.p8e=window.setInterval(Object(c.a)(this,this.xh,"sendMessage"),t))}}xh(){if(this.V_c){const t=m.a.create().toString();this.bUa=new z(t);this.gm.nog(16,t,!1,new n.a);window.setTimeout(()=>{this.oGl(t)},this.N_e)}}oGl(t){this.bUa&&this.bUa.messageId===t&&(0<this.bUa.v4f.count?(t=this.bUa.v4f.toArray().join(","),f.ULS.sendTraceTag(571339719,500,15,"ClientMessageLatencies:[{0}]",t)):f.ULS.sendTraceTag(562312150,500,50,"No client message latencies recorded"),
this.bUa=null)}stop(){this.p8e&&(window.clearInterval(this.p8e),this.V_c=!1)}jcm(t,A){16===A.type?this.gm.nog(17,A.z9,!1,new n.a):17===A.type&&this.V_c&&A.z9&&this.a8l(A.z9)}a8l(t){t&&this.bUa&&t.toString()===this.bUa.messageId&&(t=(new Date).getTime()-this.bUa.Vtm,this.bUa.v4f.add(t))}static get instance(){return v.ra}static r0k(t,A,B){return v.instance||(v.ra=new v(t,A,B))}}v.ra=null;Object(D.a)(v,"ClientToClientMessageTelemetry",null,[])},1546:function(D,P,b){b.d(P,"a",function(){return f});D=
b(0);class f extends Sys.EventArgs{constructor(c,n){super();this.yxa=c;this.W8d=n}}Object(D.a)(f,"PresenceUpdatedEventArgs",Sys.EventArgs,[])},1547:function(D,P,b){b.r(P);b.d(P,"RealtimeChannelMetrics",function(){return w});D=b(0);var f=b(10),c=b(152),n=b(65),m=b(1131);class w{constructor(){this.cah=this.dah=this.eah=this.Z$g=this.Y$g=this.$$g=this.UWc=this.x1e=0;this.NOd=this.zZe=this.OUc=this.mZe=this.nZe=this.$Ye=this.dob=this.wUc=this.kic=this.ZYe=this.LOd=this.Pgc=null;this.Y_e=this.ZVc=this.Rgh=
this.BVg=0;this.z9g=!1;this.jLi=this.Rog;this.mLi=this.Uog;this.lLi=this.Tog;this.rLi=this.$og;this.qLi=this.Zog;this.ipg=this.jpg;this.fpg=this.gpg;this.U8b=this.dpg;this.wyd=this.epg;this.kLi=this.Sog;this.PCa=this.Nbg;this.g_a=this.Obg}Rog(){this.x1e++;this.ZYe=new Date;this.Pgc||(this.Pgc=new Date)}Uog(){this.UWc++;this.dob=new Date;this.LOd||(this.LOd=this.dob);this.OUc=this.dob;this.ogk()}Tog(){this.$$g++;this.$Ye=new Date}$og(){this.Y$g++;this.kic=new Date}Zog(){this.Z$g++;this.wUc=new Date}gpg(){this.nZe=
new Date;this.eah++}epg(){this.NOd||(this.NOd=new Date);this.dah++}dpg(){this.mZe=new Date;this.cah++}jpg(){!this.z9g&&this.x1e&&(f.ULS.sendTraceTag(39321871,500,15,n.a.toJSON(this.oek())),this.z9g=!0)}Sog(z){let v,t;({Lbi:z,Mbi:v,exception:t}=m.RtcUtils.EDk(z));z&&z!==c.a.Yw&&(f.ULS.sendTraceTag(40157596,500,15,n.a.toJSON({["HttpErrorCode"]:z,["HttpErrorStatus"]:v,["Exception"]:t})),c.a.Gmd(z)&&this.BVg++,c.a.q2f(z)&&this.Rgh++)}Nbg(){this.zZe=new Date}Obg(){this.kic=this.OUc=new Date}oek(){return{["numberOfConnectionAttempts"]:this.x1e,
["numberOfSuccessfulConnections"]:this.UWc,["numberOfFailedConnections"]:this.$$g,["numberOfDisconnectedConnections"]:this.Y$g,["numberOfExplicitDisconnectedConnections"]:this.Z$g,["numberOfSentMessages"]:this.eah,["numberOfReceivedMessages"]:this.dah,["numberOfLostMessages"]:this.cah,["firstConnectionAttempt"]:this.Pgc?this.Pgc:null,["firstMessageReceived"]:this.NOd?this.NOd:null,["firstConnectionSuccess"]:this.LOd?this.LOd:null,["lastConnectionAttempt"]:this.ZYe?this.ZYe:null,["lastConnectionSuccess"]:this.dob?
this.dob:null,["lastConnectionFailure"]:this.$Ye?this.$Ye:null,["lastMessageSent"]:this.nZe?this.nZe:null,["lastMessageLost"]:this.mZe?this.mZe:null,["lastDisconnect"]:this.kic?this.kic:null,["lastExplicitDisconnect"]:this.wUc?this.wUc:null,["lastTimeOnline"]:this.OUc?this.OUc:null,["lastTimeOffline"]:this.zZe?this.zZe:null,["maxDisconnectedTimeMs"]:this.ZVc,["maxExplicitDisconnectedTimeMs"]:this.Y_e,["clientConnectionErrors"]:this.BVg,["serverConnectionErrors"]:this.Rgh}}ogk(){this.Pgc&&1===this.UWc&&
(this.ZVc=Math.max(this.ZVc,this.dob.getTime()-this.Pgc.getTime()));this.kic&&1<this.UWc&&(this.ZVc=Math.max(this.ZVc,this.dob.getTime()-this.kic.getTime()));this.wUc&&1<this.UWc&&(this.Y_e=Math.max(this.Y_e,this.dob.getTime()-this.wUc.getTime()))}static createInstance(z){w.ra||(w.ra=new w,f.ULS.sendTraceTag(39321870,500,50,"RealtimeChannelMetrics initialized for client {0}",z));return w.ra}}w.ra=null;Object(D.a)(w,"RealtimeChannelMetrics",null,[1008,179])},1548:function(D,P,b){b.d(P,"a",function(){return f});
D=b(0);class f extends Sys.EventArgs{constructor(c,n){super();this.type=c;this.yxa=n}}Object(D.a)(f,"PersistentStateUpdateEventArgs",Sys.EventArgs,[])},1549:function(D,P,b){b.d(P,"a",function(){return f});D=b(0);class f extends Sys.EventArgs{constructor(c){super();this.e5d=c}}Object(D.a)(f,"PersistentStateClearedEventArgs",Sys.EventArgs,[])},1667:function(D,P,b){b.r(P);var f=b(0),c=b(42);class n{constructor(ta,jb){this.kza=null;this.Tch=ta;this.OFj=jb}init(){this.Tch.continueWith(()=>{this.kza=this.Tch.result;
this.kza.b4c(Object(c.a)(this,this.Kha,"onUsersUpdated"))})}Kha(){n.njf(this.kza.pub())&&(this.kza.xsg(Object(c.a)(this,this.Kha,"onUsersUpdated")),this.OFj.IsRealCoauthSession=!0)}get Vki(){return this.kza?n.njf(this.kza.pub()):!1}static njf(ta){let jb=null;for(const Mb of ta)if(Mb)if(ta=Mb.isAnonymous||!Mb.email?Mb.clientId:Mb.email.toUpperCase(),!jb)jb=ta;else if(jb!==ta)return!0;return!1}}Object(f.a)(n,"CoauthTelemetry",null,[150]);var m=b(10),w=b(364),z=b(56),v=b(2),t;(function(ta){ta[ta.badStatePreventedTelemetry=
0]="badStatePreventedTelemetry";ta[ta.notImplemented=1]="notImplemented";ta[ta.renderHandled=2]="renderHandled";ta[ta.renderHandledWithVeto=3]="renderHandledWithVeto"})(t||(t={}));Object(f.b)("CoauthorGalleryTelemetryEndResult",t);var A=b(77),B=b(65),S=b(105);class C{constructor(ta,jb,Mb,xb,Nc,rc,wd,Fc,qe){this.Uch=this.SVg=this.tD=null;this.I9=ta;this.xYd=new w.a;this.qa=Mb;this.zMe=jb;this.hP=xb;this.pe=Nc;this.d4e=rc;this.Xob=wd;this.xnj=Fc;this.g2g=this.$1g=!1;this.DZd=0;this.QVg=1;this.bHb=qe;
this.xqb=this.qa.$("PeoplesWellExtraButtonInfoIsEnabled");this.XEa=Object(z.a)(String,v.AFrameworkApplication.sessionStartInfoSettings.Application)||""}get F3i(){return this.xYd.task}init(){S.Task.WAA.call(null,this.Xob,this.zMe,this.d4e).continueWith(()=>{this.tD=this.Xob.result;this.SVg=this.zMe.result;this.Uch=this.d4e.result;S.Task.WAA.call(null,this.zMe.result.J$a,this.d4e.result.E6i).continueWith(()=>{this.QVg=this.SVg.J$a.result;this.DZd=this.Uch.E6i.result;this.tD.b4c(Object(c.a)(this,this.Sre,
"onUsersUpdatedEventListener"));this.tD.pub().length&&this.Kha()})})}Sre(){this.Kha()}Kha(){this.xnj(this.tD.pub())?(this.tD.xsg(Object(c.a)(this,this.Sre,"onUsersUpdatedEventListener")),this.bUl(this.$1g)):this.xYd.cP(1);this.$1g=!0}bUl(ta){this.g2g?this.F3i.continueWith(()=>{m.ULS.sendTraceTag(42062996,325,15,"We already attempted to log a render of coauthor gallery: {0}",t[this.F3i.result])}):(this.g2g=!0,this.H8l(!this.QVg&&!ta))}H8l(ta){ta?this.hP.Pk(4,Object(c.a)(this,this.jfg,"onInteractiveReady")):
this.xYd.cP(1)}jfg(){const ta=this.pe.$v("AppInitStatus_interactivityReady");m.ULS.shipAssertTag(42259235,325,!!this.DZd);const jb=this.DZd-ta,Mb={};Mb.InteractiveTime=ta;Mb.ReactRenderComplete=this.DZd;Mb.HadTabSwitch=this.bHb();Mb.IsModernGallery=this.xqb;m.ULS.sendTraceTag(594883104,325,50,B.a.toJSON(Mb));this.xqb?(m.ULS.sendTraceTag(42062997,325,15,jb.toString()),this.xYd.cP(this.N1m(jb)?3:2)):m.ULS.sendTraceTag(594883103,325,15,jb.toString())}N1m(ta){const jb=ta>this.qa.vb("CoauthorGalleryTimeToRenderDurationMs",
1E4),Mb="Word"===this.XEa;if(this.bHb())return m.ULS.sendTraceTag(50455714,325,50,jb.toString()),!1;Mb&&A.Health.instance.recordKpiUsage("CoauthGalleryExperienceDegraded",0,"wordcollabrel",null);jb&&(Mb?A.Health.instance.recordKpiFailure("CoauthGalleryExperienceDegraded","CoauthorGalleryTimeToRenderDurationIsTooLong",!1,!0,null):A.Health.instance.recordQosError("CoauthorGalleryTimeToRenderDurationIsTooLong",["CoauthGalleryExperienceDegraded"],!1,!0,!0,!1,null),m.ULS.sendTraceTag(42062998,325,15,ta.toString()));
return jb}}Object(f.a)(C,"CoauthorGalleryTelemetry",null,[149]);class H{constructor(ta){this.tD=null;this.$Ld={};this.eVd={};this.JSc=null;this.Xob=ta}Gee(ta){const jb=new w.a;this.init().continueWith(()=>{ta in this.$Ld?jb.cP(this.$Ld[ta]):this.eVd[ta]=jb});return jb.task}init(){if(this.JSc)return this.JSc.task;this.JSc=new w.a;this.Xob.continueWith(()=>{this.tD=this.Xob.result;this.tD.b4c(Object(c.a)(this,this.Kha,"onUsersUpdated"));this.Tbj();this.JSc.Ue(null)});return this.JSc.task}Tbj(){const ta=
this.tD.pub();ta.sort(Object(c.a)(this,this.Sfk,"comparePresenceUsers"));this.$Ld={};for(let jb=0;jb<ta.length&&ta[jb]&&ta[jb].zZa;jb++)this.VRj(this.$Ld,ta[jb].clientId,jb)}VRj(ta,jb,Mb){ta[jb]=Mb;jb in this.eVd&&(this.eVd[jb].cP(Mb),delete this.eVd[jb])}Kha(){this.Tbj()}Sfk(ta,jb){return ta.zZa>jb.zZa?1:ta.zZa<jb.zZa?-1:0}}Object(f.a)(H,"CoauthorPositionFinder",null,[148]);var J=b(74),M=b(203);class G{constructor(){this.id=null;this.d=this.tp=this.mp=this.st=this.et=0;this.ct=null;this.vc=!1}}Object(f.a)(G,
"PL",null,[]);var R=b(30);class O{constructor(){this.ct=this.vt=this.d=0}static lVi(ta,jb,Mb){const xb=new O;xb.d=ta;xb.vt=jb;xb.ct=Mb;return R.c(xb)}}Object(f.a)(O,"VD",null,[]);var I=b(188);class K{constructor(ta,jb,Mb,xb,Nc,rc,wd,Fc,qe){this.If=0;this.Zgh=!1;this._id=ta;this.xih=jb;this.Jm=Mb;this.K0e=xb;this.qaf=Nc;this.nQb=rc;this.pIb=wd;this.nMe=Fc;this.bHb=qe;this.XEa=Object(z.a)(String,v.AFrameworkApplication.sessionStartInfoSettings.Application)||""}hGe(ta){S.Task.WAA(this.xih,this.K0e,this.qaf).continueWith(()=>
{if(this.K0e.result<=this.qaf.result)ta.cP(!1);else{this.If=this.xih.result;var jb=this.Jm-this.If,Mb=new G;Mb.id=this._id;Mb.et=this.Jm;Mb.st=this.If;Mb.d=this.Jm-this.If;Mb.mp=this.K0e.result;Mb.tp=this.qaf.result;Mb.ct=this.MPk(this.nMe);Mb.vc=this.bHb();var xb=R.c(Mb),Nc="Word"===this.XEa;m.ULS.sendTraceTag(42078597,302,15,xb);if(Nc){const rc=new Map;rc.set("data",xb);A.Health.instance.recordKpiUsage("PresenceExperienceDegraded",0,"wordcollabrel",rc)}jb>this.nQb.value&&!this.Zgh&&!Mb.vc&&(this.Zgh=
!0,ta.cP(!0),Mb=Object.assign(new I.a,{extendedProperties:new Map}),Mb.extendedProperties.set("data",xb),Nc?A.Health.instance.recordKpiFailure("PresenceExperienceDegraded","PresenceRenderDurationIsTooLong",!1,!0,Mb):A.Health.instance.recordQosError("PresenceRenderDurationIsTooLong",["PresenceExperienceDegraded"],!1,!0,!1,!1,Mb),jb<this.pIb.value&&m.ULS.sendTraceTag(42078598,302,15,O.lVi(jb,this.nQb.value,this.pIb.value)));ta.task.isCompleted||ta.cP(!1)}})}MPk(ta){switch(ta){case 2:return"NonWac";
case 0:return"Unknown";case 1:return"Wac";default:return"Unknown"}}}Object(f.a)(K,"PresenceLatencyActivityLogger",null,[]);class Y{constructor(ta,jb,Mb){this.ZUg=this.PVg=this.FLd=this.ZLd=this.tec=0;this._id=ta;this.nQb=jb;this.pIb=Mb;this.XEa=Object(z.a)(String,v.AFrameworkApplication.sessionStartInfoSettings.Application)||""}get vrh(){return this.tec}set vrh(ta){this.tec=ta;this.$nf()}get oDh(){return this.ZLd}set oDh(ta){this.ZLd=ta;this.$nf()}get hAh(){return this.FLd}set hAh(ta){this.FLd=ta;
this.$nf()}get pDh(){return!!this.PVg}get iAh(){return!!this.ZUg}$nf(){!this.pDh&&this.tec&&this.ZLd&&(this.PVg=this.hGe(this.ZLd,"CoauthGalleryLightupDurationTooLong"));!this.iAh&&this.tec&&this.FLd&&(this.ZUg=this.hGe(this.FLd,"CanvasPresenceLightupDurationTooLong"))}hGe(ta,jb){const Mb=ta-this.tec;var xb=new G;xb.id=this._id;xb.et=ta;xb.st=this.tec;xb.d=Mb;var Nc=R.c(xb);ta="Word"===this.XEa;xb="CanvasPresenceLightupDurationTooLong"===jb?"PresenceExperienceDegraded":"CoauthGalleryExperienceDegraded";
"CanvasPresenceLightupDurationTooLong"===jb?m.ULS.sendTraceTag(572289499,302,15,Nc):m.ULS.sendTraceTag(571524118,302,15,Nc);if(ta){var rc=new Map;rc.set("data",Nc);A.Health.instance.recordKpiUsage(xb,0,"wordcollabrel",rc)}return Mb>this.nQb.value?(rc=Object.assign(new I.a,{extendedProperties:new Map}),rc.extendedProperties.set("data",Nc),Nc=Mb<this.pIb.value,rc.extendedProperties.set("cash",Nc?"true":"false"),ta?A.Health.instance.recordKpiFailure(xb,jb,!1,!0,rc):A.Health.instance.recordQosError(jb,
[xb],!1,!0,!1,!1,rc),m.ULS.sendTraceTag(572289500,302,15,O.lVi(Mb,this.nQb.value,this.pIb.value)),Nc?2:1):3}}Object(f.a)(Y,"PresenceLightupLatencyLogger",null,[]);class W{constructor(ta,jb,Mb,xb,Nc,rc,wd,Fc=null,qe=null,Nf=null){this.Rdh={};this.yMe={};this.x6g=new J.a;this.uMc=this.KSc=this.tD=this.Ai=null;this.wih=this.vih=0;this.nQb=new M.a(()=>Fc.Raa("PresenceBootLatencyThreshold",1E4));this.pIb=new M.a(()=>Fc.Raa("PresenceBootLatencyCutoffThreshold",6E4));this.KNj=new M.a(()=>Fc.Raa("PresenceLightupLatencyThreshold",
2E3));this.lrj=new M.a(()=>Fc.Raa("PresenceLightupLatencyCutoffThreshold",1E4));this.hP=xb;this.RFj=Nc;this.RVg=ta;this.Tfh=jb;this.Xob=Mb;this.pe=rc;this.DTd=qe;this.bHb=wd;this.Rg=Nf;this.eUg=!1;this.init()}ncd(ta,jb,Mb=null,xb=0){Mb&&(m.ULS.shipAssertTag(42274970,302,!this.DTd||this.DTd===Mb,"_myClientId is already set and you are trying to update it to something different"),this.DTd=Mb);const Nc=new w.a;this.init().continueWith(()=>{this.YWl(ta);this.jAk(Nc,ta,jb,xb)})}get ywi(){return this.DTd||
"{"+v.AFrameworkApplication.userSessionId+"}"}init(){if(this.KSc)return this.KSc.task;this.KSc=new w.a;this.bHb()&&m.ULS.sendTraceTag(50951700,302,15,"TabSwitched Session");this.RVg.continueWith(()=>{const ta=this.RVg.result,jb=ta.J$a,Mb=ta.Mvi;Mb.continueWith(()=>{jb.continueWith(()=>{this.Rg&&this.Rg.addQosPillar("RealTimeCoauth");this.KEd(jb.result,Mb.result);this.KSc.Ue(null)})})});this.Tfh.continueWith(()=>{this.Ai=this.Tfh.result;this.Ai.Zza(Object(c.a)(this,this.UXl,"onRtcConnection"));this.Ai.n6(Object(c.a)(this,
this.qSl,"onCoauthorBootReceived"))});this.Xob.continueWith(()=>{this.tD=this.Xob.result;this.tD.b4c(Object(c.a)(this,this.Sre,"onUsersUpdatedEventListener"));0<this.tD.pub().length&&this.Kha()});return this.KSc.task}W0h(){if(this.uMc)return this.uMc.task;this.uMc=new w.a;this.hP.Pk(4,()=>{this.uMc.cP(this.pe.$v("AppInitStatus_interactivityReady"))});return this.uMc.task}UXl(ta,jb){if(!this.eUg&&2===jb.newState){var Mb=this.W0h();Mb.continueWith(()=>{const xb=Date.now()-Mb.result,Nc={};Nc.clientId=
this.ywi;Nc.bootTime=xb;this.eUg=!0;this.Ai.GR(15,Nc)})}}qSl(ta,jb){if(15===jb.type){ta=Date.now();jb=jb.z9;var Mb=jb.bootTime;this.aMf(jb.clientId).vrh=ta-Mb}}Sre(){this.Kha()}Kha(){const ta=Date.now();var jb=this.tD.pub();const Mb=new J.a;for(const xb of jb)this.x6g.contains(xb.clientId)||(this.x6g.add(xb.clientId),Mb.add(xb.clientId));if(0<Mb.count)for(let xb of Mb)jb=this.aMf(xb),jb.pDh||(jb.oDh=ta)}YWl(ta){ta=this.aMf(ta);ta.iAh||(ta.hAh=Date.now())}aMf(ta){return ta in this.yMe?this.yMe[ta]:
this.yMe[ta]=new Y(ta,this.KNj,this.lrj)}KEd(ta,jb=0){this.vih=ta;this.wih=jb?jb:(new Date).getTime()}jAk(ta,jb,Mb,xb){Mb=Mb?Mb.getTime():(new Date).getTime();jb in this.Rdh?ta.qxa():(xb=new K(jb,this.B6k(),Mb,this.Gee(this.ywi),this.Gee(jb),this.nQb,this.pIb,xb,this.bHb),this.Rdh[jb]=xb,xb.hGe(ta))}B6k(){return 1===this.vih?S.Task.s_(this.wih):this.W0h()}Gee(ta){return this.RFj.Gee(ta)}}Object(f.a)(W,"PresenceBootTelemetry",null,[135]);var Z=b(130),U=b(145),X=b(35),fa=b(172),ma=b(133),ka=b(21),oa=
b(462);class za{get name(){return"Common.App.CoauthTelemetry"}Mb(ta){ta.register(n,"Common.App.CoauthTelemetry.CoauthTelemetry").as("Common.App.CoauthTelemetry.ICoauthTelemetry").fa().hd(()=>new n(oa.a.Wp(ta.Da("Common.IPeopleInfoProvider")),v.AFrameworkApplication.vg));ta.register(C,"Common.App.CoauthTelemetry.CoauthorGalleryTelemetry").as("Common.ICoauthorGalleryTelemetry").fa().hd(()=>new C(v.AFrameworkApplication.pa,oa.a.Wp(ta.Da("Common.ICoauthoringTelemeryInfoProvider")),v.AFrameworkApplication.K,
Z.a.get_instance(),fa.a.instance,oa.a.Wp(ta.Da("Common.IPeoplesWell")),oa.a.Wp(ta.Da("Common.IPeopleInfoProvider")),n.njf,()=>this.yxh()));ta.register(W,"Common.App.CoauthTelemetry.PresenceBootTelemetry").as("Common.App.CoauthTelemetry.IPresenceBootTelemetry").fa().hd(()=>new W(oa.a.Wp(ta.Da("Common.ICoauthoringTelemeryInfoProvider")),oa.a.Wp(ta.Da("Common.IRealtimeChannelBasic")),oa.a.Wp(ta.Da("Common.IPeopleInfoProvider")),Z.a.get_instance(),ta.resolve("Common.App.CoauthTelemetry.ICoauthorPositionFinder"),
fa.a.instance,()=>this.yxh(),v.AFrameworkApplication.K,null,A.Health.instance));ta.register(H,"Common.App.CoauthTelemetry.CoauthorPositionFinder").as("Common.App.CoauthTelemetry.ICoauthorPositionFinder").fa().hd(()=>new H(oa.a.Wp(ta.Da("Common.IPeopleInfoProvider"))))}init(){v.AFrameworkApplication.K.Qo(()=>{ka.a.instance.resolve("Common.App.CoauthTelemetry.CoauthTelemetry").init();v.AFrameworkApplication.K.$("CoauthorGalleryTelemetryIsEnabled")&&ka.a.instance.resolve("Common.ICoauthorGalleryTelemetry").init();
v.AFrameworkApplication.K.$("CashTelemetryIsEnabled")&&(ka.a.instance.resolve("Common.App.CoauthTelemetry.IPresenceBootTelemetry"),ka.a.instance.resolve("Common.App.CoauthTelemetry.ICoauthorPositionFinder"))})}dispose(){}yxh(){return ma.a.ESb&&fa.a.instance.ZZ(X.a.zdc)?0<fa.a.instance.$v(X.a.zdc)[X.a.xPg]:!1}static main(){U.a.instance.kc(new za)}}Object(f.a)(za,"CoauthTelemetryPackage",null,[1,2]);class Ja extends Sys.EventArgs{constructor(){super()}}Object(f.a)(Ja,"RtcHostNotificationEventArgs",
Sys.EventArgs,[]);var pa;(function(ta){ta[ta.notYetStarted=0]="notYetStarted";ta[ta.polling=1]="polling";ta[ta.subscribed=2]="subscribed";ta[ta.blocked=3]="blocked";ta[ta.permanentlyStopped=4]="permanentlyStopped"})(pa||(pa={}));Object(f.b)("RtcHostNotificationSubscriptionState",pa);var Na=b(75),Da=b(1054),Aa=b(59);class Ma{constructor(ta,jb,Mb,xb,Nc,rc,wd,Fc,qe){this.Fe=!1;this.YUa=this.dkc=this.Eea=this.tpb=null;this.X0c=Ma.vIe;this.la=new Aa.a;this.Zpb=new Da.a(0);this.Zpb.a4c(Object(c.a)(this,
this.OYl,"onStateMachineChanged"));this.dIj=ta;this.dXd=jb;this.cIj=Mb;this.t7e=xb;this.Za=Nc;this.Gi=rc;wd.execute(Nf=>{this.Fe||(this.dkc=Nf,this.dkc.n6(Object(c.a)(this,this.C8,"onUpdateNotificationReceived")),this.start())});Fc.execute(Nf=>{this.Fe||(this.YUa=Nf,Nf.EVa(Object(c.a)(this,this.yna,"onTokenRefreshed")))});this.rlc=qe}get pFc(){return this.Zpb.currentState}get xli(){return!this.Gi||this.Gi.cOa}get Lli(){return 2===this.pFc&&this.rlc()<this.X0c}start(){this.pFc?m.ULS.sendTraceTag(573100178,
502,15,"HostNotifications: Tried starting poll when in state {0}",pa[this.pFc]):(this.Zpb.event(1),this.Jxg(null))}Jxg(){this.tpb=null;if(this.xli){m.ULS.sendTraceTag(573100181,502,50,"HostNotifications: Send event when connected.  Current state: {0}",pa[this.pFc]);let ta=null;this.t7e&&this.t7e.length&&(ta={},ta.etts=this.t7e);this.dkc.GR(14,ta,!0);this.xTi(this.dIj)}else this.Zpb.event(3)}xTi(ta){this.tpb=Na.a.w2(1E3*ta,Object(c.a)(this,this.Jxg,"sendSubscribeEvent"),this.dXd,192,"RtcHostNotificationSubscribe");
this.Za.Cb(this.tpb)}urm(ta){ta=1E3*(ta+this.cIj);const jb=this.rlc().getTime()+ta;this.X0c=new Date(jb);ta-=this.dXd;this.Eea?this.Za.N3(this.Eea,ta):(this.Eea=Na.a.w2(ta,Object(c.a)(this,this.TRm,"transitionToPollingEvent"),this.dXd/2,194,"RtcHostNotificationTransitionToPolling"),this.Za.Cb(this.Eea))}TRm(){this.Eea=null;2===this.pFc&&(this.Zpb.event(1),m.ULS.shipAssertTag(573100185,502,!!this.Eea,"Missing transition to polling task"))}yna(){this.Pbl()}Pbl(){3===this.pFc&&this.xli&&(this.Zpb.event(this.Lli?
2:1),this.Jxg(null))}C8(ta,jb){if(13===jb.type&&(ta=jb.z9,m.ULS.sendTraceTag(573100183,502,50,"HostNotifications: Subscription status: {0}",{["SerializableHostNotificationSubscription"]:ta,["DurationBeforeExpirationToResubscribeInSec"]:this.dXd}),jb=ta.cts,!this.xTm(jb))){if(ta.sb){var Mb=2;this.urm(ta.cts)}else Mb=1,this.X0c=Ma.vIe,this.Eea&&(this.Za.Oe(this.Eea),this.Eea=null);this.Zpb.event(Mb);this.tpb?this.Za.N3(this.tpb,1E3*jb):this.xTi(jb)}}xTm(ta){if(!isNaN(ta)&&isFinite(ta)&&0<ta)return!1;
this.M3i(!1);return!0}M3i(ta){this.tpb&&(this.Za.Oe(this.tpb),this.tpb=null);this.Eea&&(this.Za.Oe(this.Eea),this.Eea=null);this.dkc&&(this.dkc.kCc(Object(c.a)(this,this.C8,"onUpdateNotificationReceived")),this.dkc=null);this.YUa&&(this.YUa.D9b(Object(c.a)(this,this.yna,"onTokenRefreshed")),this.YUa=null);ta||this.Zpb.event(4)}OYl(ta,jb){ta=jb.newState;const Mb=jb.c8b,xb={};xb.NewState=pa[ta];xb.PreviousState=pa[Mb];xb.PreviousStateHits=jb.Kwd;xb.PreviousStateTransitionTime=jb.Lwd.toISOString();xb.IsSubscribed=
this.Lli;this.X0c!==Ma.vIe&&(xb.SubscriptionExpiringTime=this.X0c.toISOString());m.ULS.sendTraceTag(572346515,502,4===ta?15:50,"HostNotificationChanged: {0}",xb);this.la.raiseEvent("HN",new Ja(Mb,ta))}dispose(){this.Fe||(this.Fe=!0,this.M3i(!0),this.Eea&&(this.Za.Oe(this.Eea),this.Eea=null))}}Ma.vIe=new Date(0);Object(f.a)(Ma,"RtcHostNotificationSubscriptionManager",null,[863,12]);var ba=b(387);class L{constructor(){this.oe=this.Fe=!1}get name(){return"RtcHostNotificationSubscription"}Mb(ta){ta.register(Ma,
"Common.App.RtcHostNotificationSubscription.RtcHostNotificationSubscriptionManager").as("Common.App.RtcHostNotificationSubscription.IRtcHostNotificationSubscriptionManager").fa().hd(()=>{const jb=v.AFrameworkApplication.K;return new Ma(jb.vb("RtcHostNotificationRetryIntervalIdeallyInSeconds",1800),jb.vb("RtcHostNotificationRetryIntervalBufferInSeconds",120),jb.vb("RtcHostNotificationSubscriptionLostBufferInSeconds",60),this.Z4k(jb),v.AFrameworkApplication.Sb,ba.SessionStatusManager.instance,ta.Da("Common.IRealtimeChannelBasic"),
ta.Da("Common.ISessionExpirationManager"),()=>new Date)})}init(){v.AFrameworkApplication.K.Qo(()=>{!this.Fe&&v.AFrameworkApplication.K.$("RtcHostNotificationEnabled")&&(this.oe=!0,ka.a.instance.resolve("Common.App.RtcHostNotificationSubscription.IRtcHostNotificationSubscriptionManager"))})}dispose(){this.Fe||(this.Fe=!0,this.oe&&ka.a.instance.resolve("Common.App.RtcHostNotificationSubscription.RtcHostNotificationSubscriptionManager").dispose())}Z4k(ta){return ta.FD("RtcEventTypesToSubscribe")?ta.UD("RtcEventTypesToSubscribe"):
null}static main(){U.a.instance.kc(new L)}}Object(f.a)(L,"RtcHostNotificationSubscriptionPackage",null,[1,2]);class V{constructor(ta=0){this.capabilities=ta}JBa(ta){return!!(this.capabilities&ta)}ajb(ta){this.capabilities|=ta}equals(ta){return!(this.capabilities-ta.capabilities)}clone(){return new V(this.capabilities)}toString(){return Object.prototype.toString.call(this)}}Object(f.a)(V,"UserCapabilities",null,[]);class ha{constructor(ta,jb,Mb,xb,Nc=null,rc=null,wd=null,Fc=null,qe=!1,Nf=!1,mg=!1,
mi=0,Fg=null,Tj=0){this.clientId=ta;this.userName=jb;this.color=Mb;this.capabilities=xb||new V;this.Q6c=Nc;this.chatThreadDiscoveryUri=Fc;this.inChat=Nf;this.email=rc;this.client=wd;this.isAnonymous=qe;this.isReadOnly=mg;this.zZa=mi;this.presenceStatus=Fg;this.qTb=Tj}equals(ta){return!!ta&&ta.color===this.color&&ta.userName===this.userName&&ta.clientId===this.clientId&&ta.isAnonymous===this.isAnonymous&&ta.email===this.email&&ta.inChat===this.inChat&&this.capabilities.equals(ta.capabilities)&&ta.presenceStatus===
this.presenceStatus&&ta.qTb===this.qTb}clone(){return new ha(this.clientId,this.userName,this.color,this.capabilities.clone(),this.Q6c,this.email,this.client,this.chatThreadDiscoveryUri,this.isAnonymous,this.inChat,this.isReadOnly,this.zZa,this.presenceStatus,this.qTb)}Ou(){return this.Gc()&&!!this.userName&&!(this.userName===CommonUIStrings.l_AnonymousUserName&&!this.isAnonymous)}Gc(){return!!this.clientId}toString(){return Object.prototype.toString.call(this)}static Olk(ta){return new ha(ta,null,
null,new V,null,null,null,null,!1,!1,!1,0,null)}}Object(f.a)(ha,"PresenceUser",null,[808]);class la{constructor(ta,jb,Mb,xb,Nc,rc,wd,Fc,qe,Nf,mg){this.clientId=ta;this.SkypeChatThreadId=Mb;this.chatThreadDiscoveryUri=xb;this.inChat=Nc;this.localColbaltSessionId=jb;this.capabilities=rc;this.email=wd;this.isReadOnly=Fc;this.userName=qe;this.isAnonymous=Nf;this.presenceStatus=mg}}Object(f.a)(la,"SerializablePresenceUserData",null,[]);class ya extends ha{constructor(ta,jb,Mb,xb,Nc=null,rc=null,wd=null,
Fc=null,qe=null,Nf=!1,mg=!1,mi=!1,Fg=null){super(ta,jb,Mb,xb,rc,wd,Fc,qe,Nf,mg,mi);this.lR=Nc;this.presenceStatus=Fg}getData(){return new la(this.clientId,this.lR,this.Q6c,this.chatThreadDiscoveryUri,this.inChat,this.capabilities.capabilities,this.email,this.isReadOnly,this.userName,this.isAnonymous,this.presenceStatus)}Hee(ta){return(ta=ta.value)?ta.user:null}clone(){return new ya(this.clientId,this.userName,this.color,this.capabilities.clone(),this.lR,this.Q6c,this.email,this.client,this.chatThreadDiscoveryUri,
this.isAnonymous,this.inChat,this.isReadOnly,this.presenceStatus)}static eUb(ta){return ta.clientId?new ya(ta.clientId,ta.userName,null,new V(void 0===ta.capabilities?0:ta.capabilities),ta.localColbaltSessionId,ta.SkypeChatThreadId,ta.email,null,ta.chatThreadDiscoveryUri,ta.isAnonymous,ta.inChat,ta.isReadOnly,ta.presenceStatus):null}static WHh(ta,jb,Mb,xb=null,Nc=null,rc=null,wd=null,Fc=null,qe=!1,Nf=!1,mg=!1,mi=null){return ta?new ya(ta,jb,null,new V(void 0===Mb?0:Mb),xb,Nc,rc,wd,Fc,mg,qe,Nf,mi):
null}}Object(f.a)(ya,"PresenceUser",ha,[1533,1534,808]);class va extends ya{constructor(){super();this.nAc=this.J5f=null}SZk(){const ta=v.AFrameworkApplication.userName,jb=v.AFrameworkApplication.K.Oa("UserPrincipalName"),Mb=this.J5f?this.J5f.lR:null,xb=v.AFrameworkApplication.LId||v.AFrameworkApplication.ECa,Nc=this.nAc?this.nAc.getStatus():null;return new ya(this.clientId,ta,this.color,this.capabilities,Mb,this.Q6c,jb,this.client,this.chatThreadDiscoveryUri,xb,this.inChat,this.isReadOnly,Nc)}}Object(f.a)(va,
"MyPresenceUser",ya,[1569,808]);class xa{constructor(ta,jb,Mb,xb,Nc){this.Uc=ta;this._clientId=jb;this.msj=Nc;this.Uvj=Mb||(()=>null);this.Vvj=xb||(()=>null)}get id(){return this.Uc.id}get e0d(){return this.Uc.e0d}get i0d(){return this.Uc.i0d}get h0d(){return this.Uc.h0d}get g0d(){return this.Uc.g0d}get f0d(){return this.Uc.f0d}get j0d(){return this.Uc.j0d}get Qdf(){return this.Uc.Qdf}get VEc(){return this.Uc.VEc}get IBe(){return this.Uc.IBe}get Noe(){return this.Uc.Noe}get clientId(){return this._clientId}get sjd(){return this.Uvj}get mvb(){return this.Vvj}get uwk(){return this.msj}static createInstance(ta,
jb,Mb,xb,Nc=!1){return new xa(ta,jb,Mb,xb,Nc)}}Object(f.a)(xa,"PeoplesWellSettings",null,[]);var Ia=b(1134),mb=b(11),gb=b(50),Za=b(118),$a=b(73),cb=b(215),La=b(304),Ya=b(394),Eb=b(323);class qa extends cb.a{constructor(){super();this.JoinTimeInMS=0;this.IsAnonymous=!1;this.ImageUrl=null;this.ChatCapable=this.CanJump=this.ActiveStatus=!1;this.Upn=null}get ControlType(){return 5}}Object(f.a)(qa,"PeopleButtonProps",cb.a,[]);var Oa=b(943),Ha=b(16),ab=b(129),Ra=b(340),Pa=b(58);class bb{constructor(ta){this.NId=
new Pa.a;this.Dwf=null;this.clientId=ta}nBm(ta){this.eim();this.Vvm(ta);for(const jb of ta)jb.clientId!==this.clientId&&this.Gph(jb)}get AOg(){const ta=[];for(let jb of this.NId.values){const Mb=this.mUi(jb);Array.add(ta,Mb)}return ta}get PAb(){return this.NId.count}Fff(ta,jb){ta=ta.toUpperCase();let Mb;({value:Mb}=this.NId.tb(ta)).returnValue||(Mb=[],this.NId.W(ta,Mb));Array.add(Mb,jb)}eim(){this.NId=new Pa.a}Vvm(ta){for(const jb of ta)if(jb.clientId===this.clientId){this.Dwf=jb;break}}}Object(f.a)(bb,
"UserTracker",null,[1123]);class hb extends bb{constructor(ta,jb){super(ta);this.Wvj=jb}Gph(ta){ta.isAnonymous||!ta.email?this.Fff(ta.clientId,ta):this.Dwf&&Ra.a.lf().equals(this.Dwf.email,ta.email)||this.Fff(ta.email,ta)}mUi(ta){let jb=new Date(0),Mb=0<ta.length?ta[0]:null;for(const xb of ta)(ta=this.Wvj(xb.clientId))&&jb.getTime()<ta.nxc.getTime()&&(jb=ta.nxc,Mb=xb);return Mb}}Object(f.a)(hb,"UniqueUserTracker",bb,[]);class Pb extends bb{constructor(ta){super(ta)}Gph(ta){this.Fff(ta.clientId,ta)}mUi(ta){return ta[0]}}
Object(f.a)(Pb,"UserInstanceTracker",bb,[]);const wb=(ta,jb,Mb)=>Mb?new hb(ta,jb):new Pb(ta);var Fb=b(72),Ta=b(1024),Zb=b(13);class Db{constructor(ta,jb=null,Mb=null,xb=null){this.tD=null;this.yaf=new w.a;this.wHb=null;this.Uc=ta;this.lte=jb;Mb&&Mb.continueWith(()=>{this.tD=Mb.result;this.tD.b4c(Object(c.a)(this,this.Kha,"onUsersUpdated"));this.Dyd()});xb&&xb.continueWith(()=>{this.wHb=xb.result;this.wHb.U5m(Object(c.a)(this,this.Kha,"onUsersUpdated"));this.Dyd()});new ha(this.settings.clientId,"Anonymous user",
"#cccccc",new V(7));this.Mje=this.$Xe=!0;this.NTe=this.Vch=!1;this.zEa=wb(this.settings.clientId,this.settings.mvb,ta.uwk)}get settings(){return this.Uc}get Vpl(){return v.AFrameworkApplication.K?v.AFrameworkApplication.K.$("ColorPresenceHashIsEnabled"):!1}get Pgi(){return v.AFrameworkApplication.K?v.AFrameworkApplication.K.$("PeoplesWellExtraButtonInfoIsEnabled"):!1}aRk(){let ta,jb,Mb,xb;const Nc=this.bRk();this.zEa.PAb?1===this.zEa.PAb?(ta=!0,jb=this.settings.VEc.cluster,Mb=this.settings.VEc.G7d,
xb=this.zEa.AOg[0].color):(ta=!0,jb=this.settings.Noe.cluster,Mb=this.settings.Noe.G7d,xb=""):(ta=!1,xb=Mb=jb="");return{c0l:Nc[0],d0l:Nc.slice(1),Z_l:ta,san:jb,a0l:Mb,$_l:xb}}bRk(){if(2<=this.zEa.PAb)return[String.format(CommonUIStrings.l_PeoplesWellStateNumberOfOtherPeopleEditingHere,this.zEa.PAb)];if(1===this.zEa.PAb){const ta=this.zEa.AOg[0],jb=this.settings.mvb(ta.clientId);return jb&&2===jb.status?[CommonUIStrings.l_PeoplesWellStateUserIsInactive,ta.userName]:[ta.isReadOnly?CommonUIStrings.l_PeoplesWellStateUserIsAlsoViewing:
CommonUIStrings.l_PeoplesWellStateUserIsAlsoEditing,ta.userName]}return[CommonUIStrings.l_PeoplesWellStateYouAreAllByYourself]}b$k(ta){return this.c$k(ta)}Fzh(ta,jb,Mb){return jb?this.p9j(jb)?(ta=this.settings.mvb(ta))&&2===ta.status?!1:!0:(Mb&&m.ULS.sendTraceTag(4482394,325,50,"User has presence data but app can't use it"),!1):(Mb&&m.ULS.sendTraceTag(4482393,325,50,"User does not have any presence data"),!1)}G6k(ta){return ta.isReadOnly?CommonUIStrings.l_PeoplesWellUserStatusIsViewingOffline:CommonUIStrings.l_PeoplesWellUserStatusLocationUnknown}c$k(ta){if(!ta.capabilities.JBa(1))return this.G6k(ta);
const jb=ta.isReadOnly,Mb=this.settings.mvb(ta.clientId);ta=this.settings.sjd(ta.clientId);if(!Mb)return CommonUIStrings.l_PeoplesWellUserStatusLocationUnknown;switch(Mb.status){case 1:return ta?jb?CommonUIStrings.l_PeoplesWellUserStatusIsViewingOnline:this.Qik(ta)||CommonUIStrings.l_PeoplesWellUserStatusLocationUnknown:CommonUIStrings.l_PeoplesWellUserStatusLocationUnknown;case 2:return CommonUIStrings.l_PeoplesWellUserStatusIsInactive;default:return CommonUIStrings.l_PeoplesWellUserStatusLocationUnknown}}HWk(ta){if(this.lte.xle)return this.lte.apc(ta.email,
"O365",v.AFrameworkApplication.zk,0)}Q9k(ta){ta=this.settings.mvb(ta.clientId);return!ta||ta&&1===ta.status?!0:!1}T9k(ta){return this.wHb?this.wHb.f8m(ta.clientId):ta.capabilities.JBa(4)}R9k(ta){var jb=String.format("buttonPeoplesWellUser-{0}",ta.clientId),Mb=ta.clientId,xb=this.b$k(ta);const Nc=ta.userName,rc=ta.color;var wd=Object,Fc=wd.assign,qe=new qa,Nf=this.settings.j0d.toString(),mg=this.settings.IBe.cluster,mi=this.settings.IBe.G7d,Fg=this.FZh(),Tj=ta.isAnonymous,lj;if(lj=[Nc],lj.length){var mj=
new Sys.StringBuilder("STRARRY@");for(const bn of lj)mj.append(bn?bn.length:0),mj.append(","),mj.append(bn),mj.append(",");lj=mj.toString().slice(0,-1)}else lj=null;jb=Fc.call(wd,qe,{Id:jb,Command:Nf,LabelText:"{0}",Image32by32:mg,Image32by32Class:mi,MenuItemId:Mb,CommandValueId:Mb,Alt:Nc,DisplayMode:Fg,LabelCss:"display:block; max-width:160px; padding:0px; white-space:normal; word-wrap:break-word",Description:xb,ImageBackColor:rc,IsAnonymous:Tj,LabelTextUserGeneratedPlaceholderReplacements:lj,Upn:ta.email});
v.AFrameworkApplication.K.$("PeoplesWellExtraButtonInfoIsEnabled")&&this.lte&&(Mb=this.HWk(ta),xb=this.Q9k(ta),jb.ImageUrl=Mb,jb.ActiveStatus=xb,jb.JoinTimeInMS=ta.zZa,xb=this.Fzh(ta.clientId,this.settings.sjd(ta.clientId),!1),ta=this.T9k(ta),jb.CanJump=xb,jb.ChatCapable=ta,""===Mb&&m.ULS.sendTraceTag(40969413,302,50,"ImageURL collection failed"));return jb}zVk(){return Object.assign(new cb.a,{Id:"BasicChat",Command:"2288458806",LabelText:CommonUIStrings.l_StartGroupChat,LabelCss:"display:block; max-width:160px; padding:0px; white-space:normal; word-wrap:break-word"})}FZh(){return this.Vpl?
"Initials":"Menu32"}S9k(ta){const jb=[];for(const Mb of ta)ta=this.R9k(Mb),Array.add(jb,ta);return jb}dje(){return 0<this.zEa.PAb}H$l(ta){if(!this.$Xe)return!0;this.Mje||(ta[Ta.a.Visible]=!0);let jb,Mb,xb,Nc,rc;({c0l:jb,d0l:Mb,Z_l:xb,a0l:Nc,$_l:rc}=this.aRk());ta[Ta.a.LabelText]=jb;Mb&&Mb.length&&(ta[Ta.a.LabelTextUserGeneratedPlaceholderReplacements]=Mb);ta[Ta.a.ImageIsVisible]=xb;ta[Ta.a.Image16by16Class]=Nc;ta[Ta.a.ImageBackColor]=rc;this.$Xe=!1;return!0}F4l(ta){if(0>=this.zEa.PAb)return!1;var jb=
this.oJm(this.zEa.AOg),Mb=this.S9k(jb);jb=Object.assign(new Ya.a,{Id:"menuCoauthors",MaxWidth:"220px",MenuSectionList:[]});Mb=Object.assign(new Eb.a,{Id:"msCoauthors",ControlsId:"msCoauthorsControls",DisplayMode:this.FZh(),ControlList:Mb});v.AFrameworkApplication.K.$("WordEditorDisplayPeoplesWellLabelIsEnabled")&&this.lte&&(Mb.Title=CommonUIStrings.l_PeoplesWellFlyoutLabel,Mb.TitleId="menuCoauthorsTitle",Mb.Theme="Light");Array.add(jb.MenuSectionList,Mb);v.AFrameworkApplication.K.$("DocChatIsEnabled")&&
v.AFrameworkApplication.K.$("PeoplesWellExtraButtonInfoIsEnabled")&&v.AFrameworkApplication.oa&&v.AFrameworkApplication.oa.mb.Bp&&(Mb=[],Array.add(Mb,this.zVk()),Mb=Object.assign(new Eb.a,{Id:"msGroupChat",ControlsId:"msGroupChatControl",ControlList:Mb}),Array.add(jb.MenuSectionList,Mb));v.AFrameworkApplication.oa&&v.AFrameworkApplication.oa.mb.Bp?ta.MenuItems=jb:ta.PopulationXML=La.t(jb);return!0}vOg(ta){m.ULS.sendTraceTag(4482395,325,50,"PeoplesWell: Received user button click");ta=ta.MenuItemId;
if(!ta)return!1;const jb=this.settings.sjd(ta);if(!this.Fzh(ta,jb,!0))return!1;this.XAl(jb);return!0}Bem(){const ta=this.UMk();this.zEa.nBm(ta);this.Mje&&1<=this.zEa.PAb&&(m.ULS.sendTraceTag(6092429,325,50,"PeoplesWell: User is no longer forever alone."),this.Mje=!1);this.$Xe=!0}Kha(){this.NTe||(window.setTimeout(()=>{this.Dyd();this.NTe=!1},3E3),this.NTe=!0)}UMk(){let ta;ta=this.TMk()||[];for(const jb of ta)this.zqm(jb);return ta}zqm(ta){ta.clientId||(ta.clientId=ab.a.create().toString());ta.userName||
(ta.userName="Anonymous user");ta.capabilities||(ta.capabilities=new V);ta.color||(ta.color="#cccccc");ta.zZa||(ta.zZa=0)}oJm(ta){const jb=[];Array.addRange(jb,ta);jb.sort(Db.P_l);return jb}Sgm(){v.AFrameworkApplication.K.$("CoauthorGalleryTelemetryIsEnabled")&&v.AFrameworkApplication.pa.ma(Zb.a.Ydk,Fb.a.frame,Object(c.a)(this,this.rSl,"onCoauthorGalleryFirstRender"));this.Tgm();this.Vch=!0;this.Dyd()}rSl(ta,jb,Mb,xb,Nc){this.yaf.cP(Nc.RenderTime);return 32}get E6i(){return this.yaf.task}Dyd(){if(!this.Vch&&
(this.yaf.cP((new Date).getTime()),m.ULS.sendTraceTag(42567504,325,50,"We are trying to render the coauthor gallery before we are ready to record the render time"),this.Pgi))return;this.Bem();this.Pgi&&this.Mje?Oa.a.LAb("ribbon","coauthorGallery"):(Oa.a.Hba("ribbon","coauthorGallery"),Oa.a.zva("ribbon","coauthorGallery"),this.Cem())}dispose(){this.tD&&(this.tD.xsg(Object(c.a)(this,this.Kha,"onUsersUpdated")),this.tD=null);this.wHb&&(this.wHb.Tan(Object(c.a)(this,this.Kha,"onUsersUpdated")),this.wHb=
null)}static P_l(ta,jb){return ta.capabilities.JBa(1)&&jb.capabilities.JBa(1)||!ta.capabilities.JBa(1)&&!jb.capabilities.JBa(1)?Ha.a.localeCompare(ta.userName,jb.userName):ta.capabilities.JBa(1)?-1:1}}Object(f.a)(Db,"APeoplesWell",null,[1041,12]);var pb=b(14);class nb extends Db{constructor(ta,jb,Mb=null,xb=null){super(ta,Mb,xb);this.n4a=()=>!0;this.ea=jb}J$l(ta){return this.H$l(ta)}H4l(ta){return this.F4l(ta)}o0m(ta){return this.vOg(ta)}qdb(ta,jb,Mb,xb,Nc,rc){ta=!1;switch(Mb){case 1:ta=Nc(xb);break;
case 2:ta=rc(xb)}return nb.K2j(ta)}uql(ta,jb,Mb,xb,Nc){return this.qdb(ta,jb,Mb,Nc,()=>this.dje(),this.n4a)}I$l(ta,jb,Mb,xb,Nc){return this.qdb(ta,jb,Mb,Nc,Object(c.a)(this,this.J$l,"queryUsersProxy"),this.n4a)}G4l(ta,jb,Mb,xb,Nc){return this.qdb(ta,jb,Mb,Nc,this.n4a,Object(c.a)(this,this.H4l,"populateFlyoutContentsProxy"))}Tek(ta,jb,Mb,xb,Nc){return this.qdb(ta,jb,Mb,Nc,this.n4a,this.n4a)}Sek(ta,jb,Mb,xb,Nc){return this.qdb(ta,jb,Mb,Nc,this.n4a,this.n4a)}n0m(ta,jb,Mb,xb,Nc){return this.qdb(ta,jb,
Mb,Nc,this.n4a,Object(c.a)(this,this.o0m,"userButtonClickProxy"))}e3l(ta,jb,Mb,xb,Nc){return this.qdb(ta,jb,Mb,Nc,this.n4a,()=>{this.Dyd();return!0})}Tgm(){this.ea.ma(this.settings.e0d,pb.a.application,Object(c.a)(this,this.uql,"isControlEnabledHandler"));this.ea.Ia(this.settings.i0d,pb.a.application,Object(c.a)(this,this.I$l,"queryUsersHandler"),96);this.ea.Ia(this.settings.g0d,pb.a.application,Object(c.a)(this,this.Tek,"commandMenuOpenHandler"),96);this.ea.Ia(this.settings.f0d,pb.a.application,
Object(c.a)(this,this.Sek,"commandMenuCloseHandler"),96);this.ea.Ia(this.settings.h0d,pb.a.application,Object(c.a)(this,this.G4l,"populateFlyoutContentsHandler"),96);this.ea.ma(this.settings.j0d,pb.a.application,Object(c.a)(this,this.n0m,"userButtonClickHandler"));this.ea.Ia(this.settings.Qdf,pb.a.application,Object(c.a)(this,this.e3l,"peoplesWellRefreshControlHandler"),96)}dispose(){super.dispose()}static K2j(ta){return ta?32:8}}Object(f.a)(nb,"ABox4PeoplesWell",Db,[]);var ub=b(3),kb=b(46),zc=b(9),
Qc=b(25),md=b(156);class vd{static isSupported(ta){for(let jb=0;jb<vd.E4i.length;jb++)if(ta===vd.E4i[jb])return!0;return!1}}vd.E4i=[1];Object(f.a)(vd,"RTTDataVersion",null,[]);var Jb=b(1296);const mc=ta=>{if("number"!==typeof ta.RK||"number"!==typeof ta.DK)return!1;let jb,Mb=!1,xb=!1,Nc=!1;switch(ta.RK){case 0:xb=jb=!0;break;case 1:Nc=Mb=xb=jb=!0;break;case 2:if(null!=ta.PE&&"number"!==typeof ta.PE)return!1;jb=!0;break;case 4:jb=!0;break;case 3:xb=jb=!0;break;case 5:Mb=jb=!0;break;default:return!1}return jb&&
("number"!==typeof ta.PS||"number"!==typeof ta.TS)||xb&&("object"!==typeof ta.OS||!ta.OS||!Jb.validateVersionedCpData(ta.OS))||Mb&&("number"!==typeof ta.PE||"number"!==typeof ta.TE)||Nc&&("object"!==typeof ta.OE||!ta.OE||!Jb.validateVersionedCpData(ta.OE))?!1:!0},sc=ta=>{let jb="";if("number"!==typeof ta.I)return{returnValue:!1,Fma:"Invalid PacketId Type"};if("number"!==typeof ta.O)return{returnValue:!1,Fma:"Invalid Operation Type"};if("string"!==typeof ta.A)return{returnValue:!1,Fma:"Invalid ClientId Type"};
if("object"!==typeof ta.AN)return{returnValue:!1,Fma:"Invalid Anchor Object Type"};if(!ta.AN)return{returnValue:!1,Fma:"Null AnchorObject"};if(!mc(ta.AN)){let Mb;try{Mb=R.c(ta.AN)}catch(xb){Mb=String.format("Failed to JSON-serialize payload : {0}",xb)}8E3<Mb.length&&(Mb=String.format("Payload exceeds maximum length: {0} > {1}, not logging",Mb.length,8E3));jb="Invalid AnchorObject: "+Mb+", Client: "+ta.C;return{returnValue:!1,Fma:jb}}return!ta.O&&ta.AN.RK?(jb="Invalid RangeKind:"+ta.AN.RK+" for Caret",
{returnValue:!1,Fma:jb}):2===ta.O&&("number"!==typeof ta.TF||"undefined"!==typeof ta.TX&&"string"!==typeof ta.TX||1!==ta.AN.RK&&ta.AN.RK)?{returnValue:!1,Fma:"Invalid TypingData"}:3!==ta.O||"object"===typeof ta.AP&&ta.AP&&"number"===typeof ta.AP.TFA&&"number"===typeof ta.AP.PN&&"number"===typeof ta.AP.TN&&2===ta.AN.RK?6!==ta.O||"object"===typeof ta.MP&&ta.MP&&"number"===typeof ta.MP.PM&&"number"===typeof ta.MP.TM&&5===ta.AN.RK?4!==ta.O||"object"===typeof ta.SP&&ta.SP&&"number"===typeof ta.SP.PA&&
"number"===typeof ta.SP.TA&&"number"===typeof ta.SP.PB&&"number"===typeof ta.SP.TBS&&3===ta.AN.RK&&(ta.AN.PS===ta.SP.PA||ta.AN.PS===ta.SP.PB)?7!==ta.O||"object"===typeof ta.SPS&&ta.SPS&&"string"===typeof ta.SPS.SF&&"boolean"===typeof ta.SPS.SL?null!=ta.ISS&&"number"!==typeof ta.ISS?{returnValue:!1,Fma:"invalid StrictlySequentialId"}:{returnValue:!0,Fma:jb}:{returnValue:!1,Fma:"Invalid SymbolData"}:{returnValue:!1,Fma:"Invalid SplitParaData"}:{returnValue:!1,Fma:"Invalid RemoveParaData"}:{returnValue:!1,
Fma:"Invalid AddParaData"}};var Mc=b(1251);class Nb{constructor(ta,jb=null,Mb=null){this.Nia=this.Dig=this.CIg=null;null!=ta&&(this.CIg=ta);null!=jb&&(this.Dig=jb);null!=Mb&&(this.Nia=Mb)}}Object(f.a)(Nb,"AddParaData",null,[]);class Kb{constructor(ta=null,jb=null){this.hGc=this.Cig=null;null!=ta&&(this.Cig=ta);null!=jb&&(this.hGc=jb)}}Object(f.a)(Kb,"MergeRemoveParaData",null,[]);class Yb{constructor(ta,jb,Mb,xb,Nc,rc,wd=null,Fc=null,qe=null,Nf=null,mg=null,mi=null,Fg=0,Tj=null){this.jFd=this.text=
this.qcc=this.wbc=this.nsd=this.lmc=this.Woa=null;this.G_a=ta;this.client=Mb;this.RC=xb;this.clientId=jb.toLowerCase();this.pW=Nc;this.version=Fg;rc&&(this.Woa=rc);null!=wd&&(this.qcc=wd);void 0!==Fc&&null!==Fc&&(this.text=Fc);qe&&(this.lmc=qe);Nf&&(this.nsd=Nf);mg&&(this.wbc=mg);mi&&(this.jFd=mi);this.F1a=Tj}}Object(f.a)(Yb,"RTTData",null,[]);class Bb{constructor(ta=null,jb=null,Mb=null,xb=null){this.BIg=this.Aig=this.yIg=this.zig=null;null!=ta&&(this.zig=ta);null!=jb&&(this.yIg=jb);null!=Mb&&(this.Aig=
Mb);null!=xb&&(this.BIg=xb)}}Object(f.a)(Bb,"SplitParaData",null,[]);class Lb{constructor(ta=null,jb=null){this.kHg=this.Ubc=null;ta&&(this.Ubc=ta);null!=jb&&(this.kHg=jb)}}Object(f.a)(Lb,"SymbolData",null,[]);class gc{constructor(ta,jb=null,Mb=null){null!=ta&&(this.TFA=ta);null!=jb&&(this.PN=jb);null!=Mb&&(this.TN=Mb)}}Object(f.a)(gc,"SerializableAddParaDataV1",null,[]);class Gc{constructor(ta=null,jb=null){null!=ta&&(this.PM=ta);null!=jb&&(this.TM=jb)}}Object(f.a)(Gc,"SerializableMergeRemoveParaDataV1",
null,[]);class fc{}Object(f.a)(fc,"SerializableRTTDataV1",null,[]);class dd{constructor(ta=null,jb=null,Mb=null,xb=null){null!=ta&&(this.PA=ta);null!=jb&&(this.TA=jb);null!=Mb&&(this.PB=Mb);null!=xb&&(this.TBS=xb)}}Object(f.a)(dd,"SerializableSplitParaDataV1",null,[]);class Td{constructor(ta=null,jb=null){ta&&(this.SF=ta);null!=jb&&(this.SL=jb)}}Object(f.a)(Td,"SerializableSymbolDataV1",null,[]);const Bd=ta=>{var jb;if(!({Fma:jb}=sc(ta)).returnValue)return m.ULS.sendTraceTag(9188759,302,15,"Failed to parse RTT packet, InvalidFieldInfo {0}",
jb),null;let Mb=jb=null,xb=null,Nc=null,rc=null,wd=null,Fc=null,qe=null;ta.WD&&(jb=ta.WD);null!=ta.TF&&(Mb=ta.TF);void 0!==ta.TX&&null!==ta.TX&&(xb=ta.TX);ta.AP&&(Nc=new Nb(ta.AP.TFA,ta.AP.PN,ta.AP.TN));ta.MP&&(rc=new Kb(ta.MP.PM,ta.MP.TM));ta.SP&&(wd=new Bb(ta.SP.PA,ta.SP.TA,ta.SP.PB,ta.SP.TBS));ta.SPS&&(Fc=new Lb(ta.SPS.SF,ta.SPS.SL));null!=ta.ISS&&(qe=ta.ISS);return new Yb(ta.I,ta.A,ta.C,ta.O,Mc.a(ta.AN),jb,Mb,xb,Nc,rc,wd,Fc,1,qe)},ce=ta=>{let jb=ta;if("number"===typeof jb.V){if(1===jb.V)return Bd(ta);
m.ULS.sendTraceTag(9188758,302,15,"Unsupported Version");return null}let Mb=0,xb=null;for(let Nc=0;Nc<ta.length;Nc++)jb=ta[Nc],vd.isSupported(jb.V)&&jb.V>Mb&&(Mb=jb.V,xb=ta[Nc]);return 1===Mb?Bd(xb):null},Ec=ta=>{if(ta){const jb=new fc;jb.I=ta.G_a;jb.V=1;jb.A=ta.clientId;jb.C=ta.client;jb.O=ta.RC;jb.AN=Mc.c(ta.pW);ta.Woa&&(jb.WD=ta.Woa);null!=ta.qcc&&(jb.TF=ta.qcc);void 0!==ta.text&&null!==ta.text&&0<ta.text.length&&(jb.TX=ta.text);ta.lmc&&(jb.AP=new gc(ta.lmc.CIg,ta.lmc.Dig,ta.lmc.Nia));ta.nsd&&
(jb.MP=new Gc(ta.nsd.Cig,ta.nsd.hGc));ta.wbc&&(jb.SP=new dd(ta.wbc.zig,ta.wbc.yIg,ta.wbc.Aig,ta.wbc.BIg));ta.jFd&&(jb.SPS=new Td(ta.jFd.Ubc,ta.jFd.kHg));jb.ISS=ta.F1a;ta=jb}else ta=null;return ta};var kc=b(52);class hc{constructor(ta,jb,Mb,xb,Nc,rc,wd,Fc,qe){this.LocalCobaltSessionId=ta;this.SkypeChatThreadId=jb;this.ChatThreadDiscoveryUri=Mb;this.InChat=xb;this.Capabilities=Nc;this.Email=rc;this.UserName=wd;this.IsAnonymous=Fc;this.PresenceStatus=qe}}Object(f.a)(hc,"SerializableWacData",null,[]);
class Gd{constructor(){this.rYd=this.qYd=0}x_k(){this.rYd===Number.MAX_VALUE&&(this.rYd=0);this.rYd++;return this.rYd}w_k(){this.qYd===Number.MAX_VALUE&&(this.qYd=0);this.qYd++;return this.qYd}static get instance(){return Gd.wKj}}Gd.wKj=new Gd;Object(f.a)(Gd,"StrictlySequentialIdGenerator",null,[862]);var nc=b(1169);class uc{constructor(ta,jb,Mb,xb,Nc,rc,wd,Fc=0){this.WV=null;this.NNd=0;this.lG=ta;this.nUa=rc;this.Bc=Nc;this.FQb=wd;this.mC=jb;this.QXd=Fc;this.qPa=Mb;this.sVd=wd.create(this,xb,Nc,
rc)}clone(){return new uc(this.lG,this.yb,this.qPa,this.Zha.Ydc,this.Bc,this.nUa,this.FQb,this.shapeId)}get yb(){return this.mC}get paragraphId(){return this.WV?this.WV:this.lG.hMa(this.yb)}get shapeId(){return this.QXd}get dryDeletion(){return this.NNd}dgg(){this.WV||(this.WV=this.paragraphId,this.Zha.dgg())}get Zha(){return this.sVd}Gc(){return 0<=this.Zha.cp}getData(){const ta=this.Zha.Ydc;return ta?new nc.a(0,this.yb,this.qPa,ta,null,null,null,0,this.shapeId):null}static eUb(ta,jb,Mb,xb,Nc){return jb?
new uc(jb,parseInt(ta.H_a),ta.skb,ta.AU,Mb,xb,Nc,ta.shapeId):null}}Object(f.a)(uc,"WordPresenceIp",null,[854,146,855]);class yc{constructor(ta,jb,Mb){this.v1a=this.Vga=this.UVc=!1;this.Rob=ta;this.u5a=Mb;this.user=jb}get ip(){return this.u5a}get Oxc(){return this.UVc}set Oxc(ta){(this.UVc=ta)&&this.ip.dgg()}aPf(){const ta=Gd.instance.w_k();return new Yb(this.Rob,this.user.clientId,1,0,this.ip?this.ip.getData():null,new hc(this.user.lR,this.user.Q6c,this.user.chatThreadDiscoveryUri,this.user.inChat,
this.user.capabilities.capabilities,this.user.email,this.user.userName,this.user.isAnonymous,this.user.presenceStatus),void 0,void 0,void 0,void 0,void 0,void 0,void 0,ta)}b0h(){return this.user.clientId+(this.ip?this.ip.paragraphId.toString():kc.a.nil.toString())}Gc(){const ta=!!this.user&&this.user.Gc(),jb=!this.ip||this.ip.Gc();return ta&&jb}clone(){const ta=new yc;ta.Rob=this.Rob;ta.UVc=this.UVc;ta.user=this.user?this.user.clone():null;ta.u5a=this.ip?this.ip.clone():null;ta.Vga=this.Vga;ta.v1a=
this.v1a;return ta}static get Qa(){return ka.a.instance.sa("Box4.IFeatureHelper")}static kuf(ta,jb,Mb,xb,Nc){if(!ta||!yc.Qa.isFeatureEnabled(202)||!jb)return null;if(ta.RC)return m.ULS.sendTraceTag(7685324,302,15,"Presence packet is of unexpected operationType {0}",ta.RC),null;let rc;rc=void 0!==ta.Woa&&null!==ta.Woa?ya.WHh(ta.clientId,ta.Woa.UserName,ta.Woa.Capabilities,ta.Woa.LocalCobaltSessionId,ta.Woa.SkypeChatThreadId,ta.Woa.Email,ta.client,ta.Woa.ChatThreadDiscoveryUri,ta.Woa.InChat,!1,ta.Woa.IsAnonymous,
ta.Woa.PresenceStatus):ya.WHh(ta.clientId,null,0,void 0,void 0,void 0,ta.client);return new yc(ta.G_a,rc,uc.eUb(ta.pW,jb,Mb,xb,Nc))}}Object(f.a)(yc,"WordPresenceInfo",null,[856,146]);class ke extends nb{constructor(ta,jb,Mb,xb,Nc,rc,wd,Fc,qe,Nf,mg,mi,Fg,Tj){super(ta,rc,Tj,jb);this.npj=Mb;this.oIj=xb;this.aHj=Nc;this.Ea=wd;ke.Cr=Fc;this.lG=qe;this.Bc=Nf;this.nUa=mg;this.ldf=mi;this.wpa=Fg}vOg(ta){this.wpa.Jle(ta.CommandValueId);return super.vOg(ta)}XAl(ta){let jb;({hlg:jb}=this.x1f(ta)).returnValue&&
(this.oIj(jb.ip.paragraphId,jb.ip.Zha.cp),v.AFrameworkApplication.K.$("WordEditorMoveIpToUserLocationIsEnabled")&&(ta=ke.O5k(jb),void 0!==ta&&null!==ta?(m.ULS.sendTraceTag(20764574,325,50,"Attempting to move IP to the editing location of the selected user"),this.Ea.setSelection(ta),gb.FocusManager.EH()&&gb.FocusManager.instance().uf(Za.AFrame.uo)):m.ULS.sendTraceTag(20764575,325,50,"IP will not be moved since the selection is either null or undefined")),ta=new Na.a(2,1,0,()=>{this.ea.zb(ub.a.nBe,
2,jb)}),$a.a.instance.Cb(ta))}$3h(ta){return ta?(ta=yc.kuf(ce(ta),this.lG,this.Bc,this.nUa,this.ldf.instance))&&ta.Gc()&&ta.ip?ta:null:null}p9j(ta){return this.hwl(ta)?this.C9j(ta)?!0:(m.ULS.sendTraceTag(41236613,325,50,"Cannot jump to user location because paragraph has not been loaded yet"),!1):(m.ULS.sendTraceTag(41236612,325,50,"Cannot jump to user location because presence is not valid"),!1)}hwl(ta){return!!this.$3h(ta)}x1f(ta){ta=this.$3h(ta);return{returnValue:!!ta,hlg:ta}}C9j(ta){let jb;return({hlg:jb}=
this.x1f(ta)).returnValue?this.npj(jb.ip.paragraphId,jb.ip.Zha.cp):!1}TMk(){if(!this.tD)return[];const ta=[];for(let jb of this.tD.pub())jb.userName?ta.push(jb):m.ULS.sendTraceTag(592229832,304,15,"The looked up RTC User has no name");return ta}Qik(ta){let jb;return({hlg:jb}=this.x1f(ta)).returnValue&&jb.user&&jb.user.presenceStatus&&"0"!==jb.user.presenceStatus?String.format(WordEditorIntl.WordEditorStrings.l_PresenceStatusOnPage,jb.user.presenceStatus):CommonUIStrings.l_PeoplesWellUserStatusLocationUnknown}Cem(){this.aHj(this.settings.id)}dispose(){super.dispose()}static createInstance(ta,
jb,Mb,xb,Nc,rc,wd){const Fc=mb.App.na.Aa,qe=v.AFrameworkApplication.pa,Nf=kb.a.instance,mg=ka.a.instance.resolve("Box4.ICoauthCashTelemetry");return new ke(ta,jb,mi=>Fc.hc.vj?Fc.hc.a4d(mi,!0):!1,(mi,Fg)=>{Fc.hc.vj&&Fc.hc.eDb(mi,Fg,!0,!0)},()=>{mb.App.Pp.sC.kdc()},qe,Nf,Fc,Mb,xb,Nc,rc,mg,wd)}static O5k(ta){const jb=ke.Cr.Nb.wc.Ua(ta.ip.paragraphId);if(void 0===jb||null===jb)return m.ULS.sendTraceTag(20764576,325,15,"The node could not be obtained"),null;if(!zc.ParagraphReader.Hb(jb))return m.ULS.sendTraceTag(20764577,
325,15,"The obtained node is not a paragraph node"),null;ta=Qc.a.uc(jb,ta.ip.Zha.cp);return new md.Selection([ta],!0)}}ke.Cr=null;Object(f.a)(ke,"WordEditorPeoplesWell",nb,[]);class Qe{get name(){return"WordEditor.PeoplesWellControl"}Mb(ta){Qe.Z=ta}init(){v.AFrameworkApplication.K.Qo(Object(c.a)(this,this.Kx,"onFullAppSettingsReady"))}Kx(){v.AFrameworkApplication.Bjg?Qe.S0a.mK().continueWith(Object(c.a)(this,this.Mud,"onRtcProxyReady")):m.ULS.sendTraceTag(23196872,325,50,"PeoplesWell control is explicitly disabled. Skipping initialization attempt")}Mud(){Qe.Ai=
Qe.S0a.mK().result;if(Qe.Ai){var ta=()=>{const jb=mb.App.na.Aa;return jb?jb.Nb?jb.Nb.wc:(m.ULS.sendTraceTag(23196876,325,15,"ActivePage is null"),null):(m.ULS.sendTraceTag(23196875,325,15,"Workspace is null"),null)};mb.App.ema().continueWith(()=>{const jb=mb.App.ema().result.$g,Mb=Ia.CuiHelper.g2k(v.AFrameworkApplication.Sp,v.AFrameworkApplication.Sp,v.AFrameworkApplication.Sp,v.AFrameworkApplication.Sp),xb=xa.createInstance(Mb,jb,Object(c.a)(Qe.Ai.Qxe,Qe.Ai.Qxe.sjd,"getUserPresence"),Object(c.a)(Qe.Ai.Qxe,
Qe.Ai.Qxe.mvb,"getUserStatusInfo"),v.AFrameworkApplication.K.$("WordEditorPresenceDedupeMultipleCoauthorInstances"));ka.a.instance.ia("RealtimePresenceUI.WordEditorPeoplesWell",()=>ke.createInstance(xb,oa.a.Wp(Qe.Z.Da("Common.IPeopleInfoProvider")),Qe.Z.sa("WordEditor.ParagraphWordIdMapping"),Qe.Z.sa("WordEditor.WordTextOffsetTranslator.IWordTextOffsetTranslator"),ta,Qe.Z.Da("WordEditor.Presence.IWordPresenceCpFactory"),Qe.Z.resolve("Common.App.People.IPeopleManager"))).as("Common.IPeoplesWell").fa();
Qe.ra=ka.a.instance.resolve("Common.IPeoplesWell");Qe.ra.Sgm();m.ULS.sendTraceTag(23196877,325,50,"PeoplesWellControl is fully initialized")})}else m.ULS.sendTraceTag(23196873,325,15,"Can't initialize the PeoplesWell control because can't get a handle to RtcProxy")}dispose(){Qe.ra&&(Qe.ra.dispose(),Qe.ra=null)}static get S0a(){return Qe.Bpb||(Qe.Bpb=ka.a.instance.resolve("Box4.Presence.IRtcProxyProvider"))}}Qe.ra=null;Qe.Z=null;Qe.Ai=null;Qe.Bpb=null;Object(f.a)(Qe,"WordEditorPeoplesWellControlPackage",
null,[1,2]);var Gg=b(64),Kg=b(174),mf=b(33),Kf;(function(ta){ta[ta.multipleBrowsersImageClassName=0]="multipleBrowsersImageClassName";ta[ta.peopleImageClassName=1]="peopleImageClassName";ta[ta.peopleImageClusterPath=4]="peopleImageClusterPath";ta[ta.multipleBrowserImageClusterPath=5]="multipleBrowserImageClusterPath";ta[ta.imageDimension=6]="imageDimension";ta[ta.rtl=8]="rtl";ta[ta.pointerInputManager=9]="pointerInputManager";ta[ta.clickInputManager=10]="clickInputManager";ta[ta.vertical=11]="vertical";
ta[ta.zIndex=12]="zIndex";ta[ta.contextMenuInputManager=13]="contextMenuInputManager";ta[ta.imageDomElement=14]="imageDomElement";ta[ta.useIdleTooltip=15]="useIdleTooltip";ta[ta.viewportBoundsCallback=16]="viewportBoundsCallback";ta[ta.flipHorizontalDirection=17]="flipHorizontalDirection";ta[ta.fixRemoveFadeOutElementCrash=18]="fixRemoveFadeOutElementCrash"})(Kf||(Kf={}));Object(f.b)("PresenceTooltipSettingKeys",Kf);class yb{constructor(){this.Kp={}}get(ta,jb=null){ta=Kf[ta];return"number"===typeof jb?
(jb=this.Kp[ta])?Number.parseInvariant(jb.toString()):0:this.Kp[ta]}add(ta,jb){this.Kp[Kf[ta]]=jb}zVa(ta,jb){Kf[ta]in this.Kp||(this.Kp[Kf[ta]]=jb)}remove(ta){delete this.Kp[Kf[ta]]}}Object(f.a)(yb,"PresenceTooltipSettings",null,[]);class Ob extends Aa.a{constructor(ta){super();this._element=null;this.element=ta}get element(){return this._element}set element(ta){this._element=ta}get visible(){return"visible"===this.element.style.visibility}set visible(ta){this.element.style.visibility=ta?"visible":
"hidden"}get rtl(){return"rtl"===this.element.dir.toLowerCase()}set rtl(ta){this.element.dir=ta?"rtl":"ltr"}get zIndex(){return this.element.style.zIndex}set zIndex(ta){this.element.style.zIndex=String(ta)}dispose(){this.element&&this.element.parentNode&&this.element.parentNode.removeChild(this.element);this.element=null;super.dispose()}createElement(ta){return this.element.ownerDocument.createElement(ta)}Aoa(){return!0}static RIh(ta){return"prControl"+(ta?"Rtl":"")}}Object(f.a)(Ob,"BasePresenceControl",
Aa.a,[12,881]);class Lc extends Sys.EventArgs{constructor(ta,jb){super();this.type=ta;this.Oo=jb}}Lc.gX="InteractivityChanged";Object(f.a)(Lc,"InteractivityChangedEventArgs",Sys.EventArgs,[]);class nd{static fSk(ta){return nd.gSk(ta)}static gSk(ta){const jb=document.createElementNS(nd.JQg,"svg");jb.setAttribute("viewBox",String.format(nd.Vqk,nd.Zdj,nd.Ydj));jb.appendChild(nd.m7k(ta));return jb}static m7k(ta){const jb=nd.Zdj/ta,Mb=2*jb,xb=nd.Ydj/2;ta=(ta-12-8)*jb/2;const Nc=document.createElementNS(nd.JQg,
"g");Nc.setAttribute("class",nd.Uqk);for(let rc=1;3>=rc;rc++)Nc.appendChild(nd.IPk(rc,Mb,ta+(6*rc-2)*jb,xb));return Nc}static IPk(ta,jb,Mb,xb){const Nc=document.createElementNS(nd.JQg,"circle");Nc.setAttribute("class",String.format("{0}-{1}",nd.Bbk,ta));Nc.setAttribute("cx",String.format("{0}",Mb));Nc.setAttribute("cy",String.format("{0}",xb));Nc.setAttribute("r",String.format("{0}",jb));return Nc}}nd.JQg="https://www.w3.org/2000/svg";nd.Uqk="prDancingDots";nd.Bbk="prAnimateCircle";nd.Vqk="0 0 {0} {1}";
nd.Ydj=40;nd.Zdj=120;Object(f.a)(nd,"ModernPresenceTooltipDancingDots",null,[]);var Rd=b(86),Yf=b(92),Pd=b(7),Mf=b(54),Me=b(121),Xd=b(51);class Fe extends Ob{constructor(ta,jb){super(ta);this.Klh=this.anb=this.eMe=this._img=this.nL=this.yr=this.Yd=null;this.MUa=jb.get(8,!1);this.Kmb=jb.get(6,0);this.pNj=jb.get(15,!1);this.Uc=jb;this.u_g=0;this.element=ta;this.element.className=Fe.HFf;this._span=document.createElement("span");this.element.appendChild(this._span);this.Isj=nd.fSk(jb.get(6,0));this.lH(jb);
this._state=5}nRb(ta){this.addHandler(Lc.gX,ta)}C9b(ta){this.removeHandler(Lc.gX,ta)}get user(){return this.Klh}get state(){return this._state}dispose(){this.element&&(this.Yd.Gb(Pd.a.click,this.element,Object(c.a)(this,this.onClick,"onClick")),this.Yd.Gb(Pd.a.nF,this.element,Object(c.a)(this,this.Aoa,"stopPropagationAndPreventDefaultBehavior")),this.yr.Gb(Pd.a.pointerDown,this.element,Object(c.a)(this,this.LI,"onPointerDown")),this.yr.Gb(Pd.a.pointerOut,this.element,Object(c.a)(this,this.rR,"onPointerOut")),
this.yr.Gb(Pd.a.pointerOver,this.element,Object(c.a)(this,this.k0,"onPointerOver")),this.nL.Gb(this.element,Object(c.a)(this,this.Aoa,"stopPropagationAndPreventDefaultBehavior")));super.dispose()}lH(ta){this.Yd=ta.get(10);this.Yd.Ma(Pd.a.click,this.element,Object(c.a)(this,this.onClick,"onClick"));this.Yd.Ma(Pd.a.nF,this.element,Object(c.a)(this,this.Aoa,"stopPropagationAndPreventDefaultBehavior"));this.yr=ta.get(9);this.yr.Ma(Pd.a.pointerOver,this.element,Object(c.a)(this,this.k0,"onPointerOver"));
this.yr.Ma(Pd.a.pointerOut,this.element,Object(c.a)(this,this.rR,"onPointerOut"));this.yr.Ma(Pd.a.pointerDown,this.element,Object(c.a)(this,this.LI,"onPointerDown"));this.nL=ta.get(13);this.nL.Ma(this.element,Object(c.a)(this,this.Aoa,"stopPropagationAndPreventDefaultBehavior"))}hide(ta=null,jb=0,Mb=0){this.pNj&&ta?this.TGm(ta,jb,Mb):(3===this.state&&this.vNi(),this.visible=!1,this._state=5)}TGm(ta,jb,Mb=0){this.show(ta,jb,15,4,void 0,Mb)}D0i(ta,jb,Mb=!1,xb=!1,Nc=!1,rc=0){this.show(ta,jb,20,Mb?2:
xb?1:0,Nc,rc)}tGm(ta,jb,Mb,xb=!1,Nc=0){this.show(ta,jb,Mb+20,3,xb,Nc)}show(ta,jb,Mb,xb=3,Nc=!1,rc=0){!ta||xb===this.state&&this.jfl(jb,Mb)||(this.YPj(xb,Nc,rc),this.Gka(ta,xb,rc),this._state=xb,4===rc||!rc&&!this.MUa?this.element.style.left=jb+"px":this.element.style.right=jb+"px",this.element.style.top=Mb+"px",this.visible=!0)}Gka(ta,jb,Mb){this.Klh=ta;Xd.a.yx(this._span);Me.a.Qck(this._span);this._span.id="fly_"+ta.clientId;this._span.style.backgroundColor=ta.color;4!==jb?(this._span.style.height=
this.Kmb+"px",this._span.style.lineHeight=this.Kmb+"px",Me.a.wac(this._span,"border-radius",this.Kmb+"px")):4===Mb||!Mb&&!this.MUa?this._span.style.left="0px":this._span.style.right="0px";2!==jb&&(4===jb?Xd.a.Nr(this._span,""):1===jb?this._span.appendChild(this.Isj):(this._span.setAttribute("dir","auto"),Mb=Ha.a.cXk(ta.userName),!ta.isAnonymous&&Mb||jb?(ta=ta.userName,jb||(ta=Mb,Me.a.wac(this._span,"text-align","center")),Xd.a.Nr(this._span,ta)):(this._img||(this._img=this.$jk()),this._span.appendChild(this._img),
Me.a.wac(this._span,"text-align","start"))))}onClick(ta){if(!this.state)return this.raiseEvent(Lc.gX,new Lc(1,ta)),!0;3===this.state&&m.ULS.sendTraceTag(50436114,302,50,"User clicked on presence pill.");return!1}rR(ta){3===this.state&&this.raiseEvent(Lc.gX,new Lc(3,ta));return!1}k0(ta){3!==ta.Jf&&this.raiseEvent(Lc.gX,new Lc(2,ta));return!1}LI(ta){if(3!==ta.Jf)return!0;this.raiseEvent(Lc.gX,new Lc(4,ta));return!1}$jk(){const ta=document.createElement("img");ta.setAttribute("src",Rd.a.jfa("doughperson_white_glyph.svg"));
ta.setAttribute("Unselectable","on");ta.setAttribute(Mf.a.lg,Mf.a.iz);return Yf.createClusteredImageFromClusterWithImageClass(this.Kmb,this.Kmb,null,null,Fe.rIk,"",!1,"",this.element.ownerDocument,ta)}YPj(ta,jb=!1,Mb=0){if(!this.Kmd(this.state)||!this.Kmd(ta))switch(Sys.UI.DomElement.removeCssClass(this.element,this.eMe),this.state){case 4:3===ta?this.o9a(Fe.IFf,Fe.nUh):this.Kmd(ta)&&this.o9a(Fe.GFf,Fe.nUh);break;case 3:4===ta?this.o9a(Fe.LFf,Fe.mUh):this.Kmd(ta)&&(jb&&this.vNi(),this.o9a(Fe.GFf,
Fe.mUh,jb?Fe.qIk:""));break;case 0:case 1:case 2:4===ta?this.o9a(Fe.LFf,Fe.JFf):3===ta&&(jb&&this.IQj(),this.o9a(Fe.IFf,Fe.JFf,jb?Fe.oUh:"",3===Mb?Fe.uIk:Fe.sIk));break;default:4===ta?this.o9a(Fe.LFf):3===ta?this.o9a(Fe.IFf):this.Kmd(ta)&&this.o9a(Fe.GFf)}}o9a(...ta){this.eMe=ta.join(" ");Sys.UI.DomElement.addCssClass(this.element,this.eMe)}IQj(){this.u_g=window.setTimeout(()=>{this.element&&(this.anb=this.element.cloneNode(!0),this.element.parentNode.appendChild(this.anb),this.element.style.zIndex=
"2",this.anb.style.zIndex="1")},300)}vNi(){window.clearTimeout(this.u_g);this.anb&&(Sys.UI.DomElement.removeCssClass(this.anb,Fe.JFf+" "+Fe.oUh),Sys.UI.DomElement.addCssClass(this.anb,Fe.pIk),S.Task.delay(300).continueWith(()=>{this.element&&this.element.parentNode===this.anb.parentNode&&this.element.parentNode.removeChild(this.anb)}),Me.a.y9b(this.element,"z-index"))}Kmd(ta){return!ta||1===ta||2===ta}jfl(ta,jb){const Mb=Me.a.r0(this.element.style.top);return Me.a.r0(this.element.style.left)===ta&&
Mb===jb}$tg(ta){3===ta&&Me.a.gfa(this.element,"left")?(ta=Me.a.r0(this.element.style.left),Me.a.y9b(this.element,"left"),this.element.style.right=-1*ta+"px"):4===ta&&Me.a.gfa(this.element,"right")&&(ta=Me.a.r0(this.element.style.right),Me.a.y9b(this.element,"right"),this.element.style.left=-1*ta+"px")}}Fe.HFf="prModernFlyout UIFont";Fe.LFf="flyoutIdle";Fe.IFf="flyoutExpanded";Fe.GFf="flyoutCollapsed";Fe.nUh="flyoutFromIdle";Fe.mUh="flyoutFromExpanded";Fe.JFf="flyoutFromCollapsed";Fe.oUh="flyoutStacked";
Fe.qIk="flyoutFromStacked";Fe.pIk="flyoutFadeOut";Fe.rIk="cui-img-cont-float cui-img-20by20";Fe.sIk="flyoutLtrDir";Fe.uIk="flyoutRtlDir";Object(f.a)(Fe,"ModernPresenceTooltipFlyoutControl",Ob,[]);class re{constructor(ta,jb,Mb=2,xb=4){this.offsetTop=ta;this.offsetLeft=jb;this.Xdj=Mb;this.ibi=xb}}Object(f.a)(re,"FlyoutsPositioningInfo",null,[]);class Ad{constructor(ta=!1,jb=!1){this.ik=ta;this.ORe=jb}ZXk(ta,jb,Mb,xb,Nc){const rc=Nc.y,wd=Nc.height;var Fc=this.HOk(xb);const qe=Fc+jb,Nf=ta*Mb+2*(ta-1);
Mb=null;1===ta||this.c9j(Fc,Nf,rc,wd)?ta=new re(0,0,2):(ta=this.lFf(qe,Nf,rc,wd),ta.offsetTop-=Fc);this.ORe?Mb=new re(0,0,void 0,this.ik?4:3):(xb=this.GOk(xb,Nc),Fc=Math.max(0,Nc.x),Nc=Nc.width,jb=xb+jb,this.d9j(xb,Fc,Nc)?Mb=new re(0,0,void 0,this.ik?3:4):this.e9j(jb,Fc)&&(Mb=new re(0,0,void 0,this.ik?4:3)),Mb||(Mb=this.vHk(xb,jb,Fc,Nc)));return new re(ta.offsetTop,Mb.offsetLeft,ta.Xdj,Mb.ibi)}HOk(ta){return mf.a.hcb(ta)}GOk(ta,jb){return this.ik?jb.width-mf.a.rXh(ta):mf.a.jIf(ta)}c9j(ta,jb,Mb,xb){return ta+
jb<=Mb+xb}lFf(ta,jb,Mb,xb){let Nc=1,rc=Math.max(Mb,ta-jb);jb>ta-Mb&&(Nc=2,rc=jb<xb?xb-jb:Mb);return new re(rc,0,Nc)}d9j(ta,jb,Mb){return ta+150<=jb+Mb}e9j(ta,jb){return 150<=ta-jb}vHk(ta,jb,Mb,xb){xb-jb>=ta-Mb?ta=4:(jb=ta,ta=3);return new re(0,jb,void 0,ta)}}Object(f.a)(Ad,"ModernPresenceTooltipPositioner",null,[]);class zf{constructor(ta,jb,Mb,xb,Nc,rc,wd){this.uda=ta;this._parent=jb;this.VVg=Mb;this.$pj=xb;this.Ywj=Nc;this.klc=rc;this.MUa=wd;this._element=document.createElement("div");this.element.className=
"prTouchTarget"}get element(){return this._element}update(ta,jb){if(3!==ta)if(5!==ta&&this.uda&&this.uda.length){if(4===ta){var Mb=this.Ywj;var xb=(this.klc-Mb)/2;this.element.style.height=this.klc+"px";this.element.style.width=this.klc+"px";ta=Me.a.r0(this.uda[0].element.style.top);jb=Me.a.r0(this.MUa?this.uda[0].element.style.right:this.uda[0].element.style.left)}else Mb=this.VVg,xb=(this.klc-Mb)/2,this.element.style.height=this.klc+"px",this.element.style.width=this.UPk()+2*xb+"px",ta=Me.a.r0(this.uda[this.uda.length-
1].element.style.top),jb=this.k8j(this.uda[this.uda.length-1].element,Mb,jb);Me.a.wac(this.element,"border-radius",this.klc+"px");this.element.style.top=ta-xb-Mb+"px";this.MUa?this.element.style.right=jb-xb+"px":this.element.style.left=jb-xb+"px";this.element.parentNode||this._parent.insertBefore(this.element,this._parent.firstChild)}else this.element.parentNode&&this.element.parentNode.removeChild(this.element)}k8j(ta,jb,Mb){return this.MUa&&!Mb?Me.a.r0(ta.style.right):this.MUa||Mb?this.MUa&&Mb?
-Me.a.r0(ta.style.left)-jb:-Me.a.r0(ta.style.right)-jb:Me.a.r0(ta.style.left)}UPk(){return this.uda&&this.uda.length?this.VVg+Math.min(this.uda.length-1,2)*this.$pj:0}}Object(f.a)(zf,"ModernPresenceTooltipTarget",null,[]);var Id=b(195);class Ac extends Ob{constructor(ta,jb,Mb){super(ta);this.gkc=this.KTa=this.f3g=this.BJb=!1;this.Op=[];this.vSc={};this.Uc=Mb;this.ik=Mb.get(8,!1);this.r2g=Mb.get(15,!1);this.Grj=Mb.get(12,0);this.nrb=Mb.get(6,0);this.lra=jb;this.Xlh=Mb.get(16);this.ORe=Mb.get(17,!1);
this.rSd=0;this.SFj=new Ad(this.ik,this.ORe);this.yLc=this.rZh();this.MHa=!1;this.nec=[];this.zSc=[];this.element.id=Ac.kub();this.element.className=Ob.RIh(this.ik);this.Hab&&(this.zIndex=this.Hab);this.rtl=this.ik;this.Hyg(jb);this.g$=this.createElement("div");this.g$.className="prFlyoutContainer";this.element.appendChild(this.g$);this.uda=[];this.Bnb=new zf(this.d7,this.element,this.nrb,4,6,32,this.ik);this.yr=Mb.get(9);this.yr.Ma(Pd.a.pointerDown,this.Bnb.element,Object(c.a)(this,this.Ryc,"onHitTarget"));
this.yr.Ma(Pd.a.pointerOver,this.Bnb.element,Object(c.a)(this,this.Ryc,"onHitTarget"));this.yr.Ma(Pd.a.pointerOut,this.Bnb.element,Object(c.a)(this,this.Ryc,"onHitTarget"))}get Nte(){return Id.a.clone(this.Op)}get d7(){return this.uda}get Hab(){return this.Grj}get Pbb(){return this.d7?this.d7.length:0}get Dcc(){return 0<this.Pbb?this.d7[0].state:5}get aii(){return 3===this.Dcc&&!this.BJb}nRb(ta){this.addHandler(Lc.gX,ta)}C9b(ta){this.removeHandler(Lc.gX,ta)}dispose(){if(this.aii)this.MHa=!0;else{if(this.d7)for(const ta of this.d7)ta.C9b(Object(c.a)(this,
this.s_a,"onInteractivityChanged")),Gg.a.OB(ta);this.uda=null;this.yr.Gb(Pd.a.pointerDown,this.Bnb.element,Object(c.a)(this,this.Ryc,"onHitTarget"));this.yr.Gb(Pd.a.pointerOver,this.Bnb.element,Object(c.a)(this,this.Ryc,"onHitTarget"));this.yr.Gb(Pd.a.pointerOut,this.Bnb.element,Object(c.a)(this,this.Ryc,"onHitTarget"));super.dispose()}}JEc(){this.coc();this.visible=!0}YDd(){this.visible=!0;this.FRh();this.BJb=!0}xDg(){this.YDd()}hide(){this.YNi();this.Ddb();this.Bnb.update(this.Dcc,this.gkc)}Gka(ta){const jb=
this.Dcc,Mb=this.BJb;ta.clientId||(ta.clientId=(Ac.VSc++).toString());if(ta.clientId in this.vSc){var xb=this.$Wb(ta.clientId);if(0<=xb){xb=this.Op[xb];if(xb.color===ta.color&&xb.userName===ta.userName)return;this.cib(ta.clientId)}}this.hide();xb=new Fe(this.createElement("div"),this.Uc);xb.nRb(Object(c.a)(this,this.s_a,"onInteractivityChanged"));this.g$.insertBefore(xb.element,this.g$.firstChild);this.vSc[ta.clientId]=xb;Array.add(this.Op,ta);Array.add(this.d7,xb);this.Ccj(jb,Mb);this.visible=!0}cib(ta){if(this.aii)Array.add(this.zSc,
ta);else{var jb=this.Dcc,Mb=this.BJb;this.hide();this.Azd(ta);this.Ccj(jb,Mb)}}Ccj(ta,jb){0>=this.Op.length?this.hide():3===ta&&jb?this.YDd():this.JEc()}ICf(ta){ta=Ac.BOf(ta);if(this.g$!==ta&&Xd.a.yeb(this.g$,ta))return!0;for(const jb of this.d7)if(Xd.a.yeb(jb.element,ta))return!0;return!1}position(ta,jb){this.element.style.top=jb+"px";this.element.style.left=ta+"px"}coc(ta=!1){if(!ta||this.KTa){this.f3g&&this.fYi(!0);var jb=Math.min(3,this.Pbb)-1;ta=0;var Mb=1,xb=0;this.gkc&&(ta=this.yLc,Mb=-1,xb=
-this.nrb);for(let Nc=this.Pbb-1;Nc>jb;Nc--)this.d7[Nc].D0i(this.Op[Nc],-4*jb*Mb+xb,!0,!1,!0,ta);for(;0<=jb;jb--)this.d7[jb].D0i(this.Op[jb],-4*jb*Mb+xb,0<jb,Array.contains(this.nec,this.Op[jb].clientId),jb!==this.rSd,ta);this.rSd=0;this.Bnb.update(0,this.gkc);this.zIndex=this.Hab;this.BJb=!1;this.YNi(0);this.MHa&&this.dispose()}}FRh(){this.f3g&&this.fYi(!1);this.zIndex=this.Hab+1;let ta,jb,Mb;({offsetX:jb,offsetY:ta,hbi:Mb}=this.$xm());for(let xb=0;xb<this.Pbb;xb++)this.d7[xb].tGm(this.Op[xb],jb,
ta+(this.nrb+2)*xb,xb!==this.rSd,Mb)}Ddb(){let ta=0,jb=0;this.gkc&&(ta=this.yLc,jb=-6);for(let Mb=0;Mb<this.Pbb;Mb++)this.d7[Mb].hide(this.Op[Mb],jb,ta);this.zIndex=this.Hab;this.visible=this.BJb=!1;this.MHa&&this.dispose()}hqf(ta=0){ta?(this.KTa=!0,S.Task.delay(ta).continueWith(()=>{this.r2g?this.qgl():this.coc(!0);this.KTa=!1})):this.r2g?this.hide():this.coc()}qgl(){this.KTa&&this.hide()}s_a(ta,jb){ta=this.Dcc;2===jb.type||4===jb.type&&3!==ta?(this.KTa&&(this.KTa=!1),3!==ta&&(this.FRh(),3===jb.Oo.Jf&&
this.hqf(2E3))):4===jb.type&&3===ta?(this.KTa&&(this.KTa=!1),this.hqf()):3!==jb.type||3!==ta||this.BJb||(1<this.Pbb?(this.KTa=!0,S.Task.delay(250).continueWith(()=>{this.coc(!0);this.KTa=!1})):this.hqf());this.raiseEvent(Lc.gX,jb)}Ryc(ta){3===ta.Jf?this.s_a(this,new Lc(4,ta)):ta.eventName===Pd.a.pointerOver?this.s_a(this,new Lc(2,ta)):ta.eventName===Pd.a.pointerOut&&this.s_a(this,new Lc(3,ta));return!1}Hyg(ta){this.element.style.width=ta+"px";this.element.style.height=this.nrb+"px"}Azd(ta){this.Whm(ta);
ta=this.$Wb(ta);if(!(0>ta)){var jb=this.Op[ta];Array.removeAt(this.Op,ta);delete this.vSc[jb.clientId];jb=this.d7[ta];this.g$.removeChild(jb.element);this.Uc.get(18,!1)&&jb.C9b(Object(c.a)(this,this.s_a,"onInteractivityChanged"));Array.removeAt(this.d7,ta);jb.dispose()}}YNi(ta=5){if(this.zSc.length){this.visible&&this.Ddb();for(let jb=0;jb<this.zSc.length;jb++)this.Azd(this.zSc[jb]);Array.clear(this.zSc);0>=this.Op.length||5===ta?this.hide():ta||this.JEc()}}$Wb(ta){for(let jb=0;jb<this.Op.length;jb++)if(this.Op[jb].clientId===
ta)return jb;return-1}jNl(ta){if(ta in this.vSc){var jb=this.$Wb(ta);if(jb){const Mb=this.Op[jb];ta=this.vSc[ta];Array.removeAt(this.Op,jb);Array.insert(this.Op,0,Mb);Array.removeAt(this.d7,jb);Array.insert(this.d7,0,ta);this.g$.removeChild(ta.element);this.g$.appendChild(ta.element);this.coc()}}}Whm(ta){-1===this.$Wb(ta)?m.ULS.sendTraceTag(41706452,302,50,"Cannot remove active editor because client id is invalid"):Array.contains(this.nec,ta)&&(Array.remove(this.nec,ta),this.Op[0].clientId===ta&&
0<this.nec.length&&this.jNl(this.nec[this.nec.length-1]),this.Op[0].clientId===ta&&1===this.Dcc&&this.coc())}fYi(ta){ta?Sys.UI.DomElement.addCssClass(this.g$,"prBackgroundSelection"):Sys.UI.DomElement.removeCssClass(this.g$,"prBackgroundSelection")}$xm(){let ta,jb;jb=ta=0;var Mb=this.yLc;if(this.Xlh){const xb=this.Xlh(this);if(!xb)return{offsetX:ta,offsetY:jb,hbi:Mb};const Nc=4===this.Dcc;Mb=this.SFj.ZXk(this.Pbb,Nc?6:this.nrb,this.nrb,this.element,xb);jb=Mb.offsetTop;this.rSd=this.UWk(Mb.Xdj,Mb.offsetTop);
Mb=Mb.ibi;Mb!==this.yLc&&(this.$tg(Mb),this.element.dir=3===Mb?"rtl":"ltr",this.yLc=Mb);Mb!==this.rZh()?(ta=Nc?-6:-this.nrb,this.gkc=!0):this.gkc=!1}return{offsetX:ta,offsetY:jb,hbi:Mb}}UWk(ta,jb){if(1===ta)return this.Pbb-1;ta=Math.abs(jb);return 0<ta?ta/(this.nrb+2):0}$tg(ta){for(let jb=0;jb<this.Pbb;jb++)this.d7[jb].$tg(ta)}rZh(){return this.ik?3:4}static kub(){return String.format("{0}-{1}","presencetooltip",Ac.VSc++)}static BOf(ta){return ta.$a.rawEvent.relatedTarget}}Ac.VSc=0;Object(f.a)(Ac,
"ModernPresenceTooltipControl",Ob,[887,12]);var ah=b(234),cg=b(226);class Zi{constructor(ta){this.Uc=ta;this.Uc.zVa(10,ah.a.instance);this.Uc.zVa(9,Kg.a.instance);this.Uc.zVa(6,20);this.Uc.zVa(13,cg.a.instance);this.Uc.zVa(17,!1)}Btf(ta,jb=!1){this.Uc.zVa(15,jb);return new Ac(ta,20,this.Uc)}}Object(f.a)(Zi,"ModernPresenceTooltipFactory",null,[886]);class uh extends Ob{constructor(ta,jb){super(ta);this.Op=null;this.MUa=jb.get(8,!1);this.Kmb=jb.get(6,0);this.element=ta;this.element.className=uh.HFf;
this._ul=this.createElement("ul");this.element.appendChild(this._ul);this.Yd=jb.get(10);this.Yd.Ma(Pd.a.click,this.element,Object(c.a)(this,this.onClick,"onClick"));this.yr=jb.get(9);this.yr.Ma(Pd.a.pointerOut,this.element,Object(c.a)(this,this.rR,"onPointerOut"));this.yr.Ma(Pd.a.pointerDown,this.element,Object(c.a)(this,this.Aoa,"stopPropagationAndPreventDefaultBehavior"));this.nL=jb.get(13);this.nL.Ma(this.element,Object(c.a)(this,this.Aoa,"stopPropagationAndPreventDefaultBehavior"))}nRb(ta){this.addHandler(Lc.gX,
ta)}C9b(ta){this.removeHandler(Lc.gX,ta)}get fJ(){return this.Op}dispose(){this.element&&(this.Yd.Gb(Pd.a.click,this.element,Object(c.a)(this,this.onClick,"onClick")),this.yr.Gb(Pd.a.pointerDown,this.element,Object(c.a)(this,this.Aoa,"stopPropagationAndPreventDefaultBehavior")),this.yr.Gb(Pd.a.pointerOut,this.element,Object(c.a)(this,this.rR,"onPointerOut")),this.nL.Gb(this.element,Object(c.a)(this,this.Aoa,"stopPropagationAndPreventDefaultBehavior")));super.dispose()}hide(){this.visible=!1}show(ta,
jb,Mb){this.hide();!ta||0>=ta.length||(this.MUa?this.element.style.right=jb+"px":this.element.style.left=jb+"px",this.element.style.top=Mb+"px",this.pTj(ta),this.visible=!0)}pTj(ta){this.Op=ta;Xd.a.yx(this._ul);for(let jb=ta.length-1;0<=jb;jb--)this.Gka(ta[jb])}Gka(ta){const jb=document.createElement("li");jb.style.backgroundColor=ta.color;jb.style.height=this.Kmb+"px";jb.id="fly_"+ta.clientId;jb.style.lineHeight=this.Kmb+"px";Xd.a.Nr(jb,ta.userName);jb.setAttribute("dir","auto");this._ul.appendChild(jb)}onClick(){this.hide();
return!1}rR(ta){this.raiseEvent(Lc.gX,new Lc(3,ta));return!1}}uh.HFf="prFlyout UIFont";Object(f.a)(uh,"PresenceTooltipFlyoutControl",Ob,[]);class Jk extends Ob{constructor(ta,jb,Mb){super(ta);this._img=null;this.Op=[];this.element.className="prGlyph";this.Uc=jb;this.Ljc=this.Uc.get(9);this.Ho=this.Uc.get(10);this.nL=this.Uc.get(13);this.Ggl();this.Gka(Mb);this.DWe=!1}get sgb(){return this.Op.length}get fJ(){return this.Op}nRb(ta){this.addHandler(Lc.gX,ta)}C9b(ta){this.removeHandler(Lc.gX,ta)}dispose(){this.FUm();
super.dispose()}Gka(ta){Array.add(this.Op,ta);2===this.sgb?this.Ooa(!0):1===this.sgb?this.Ooa(!1):this.Ooa(this.DWe)}cib(ta){this.lFk(ta)&&(1<this.sgb&&this.Ooa(!0),1===this.sgb?this.Ooa(!1):1>this.sgb&&this.hide())}show(){this.Ooa(2<=this.sgb);this.visible=!0}hide(){this.visible=!1}FWk(ta){return ta?this.iYh(0,5):this.iYh(1,4)}lFk(ta){for(let jb=0;jb<this.sgb;jb++)if(this.Op[jb].clientId===ta)return ta=this.Op[jb],Array.removeAt(this.Op,jb),ta;return null}Ooa(ta){this.DWe!==ta&&(this._img&&this.element.removeChild(this._img),
this._img=this.FWk(ta),this.element.appendChild(this._img),this.DWe=ta);this._img.childNodes[0].style.backgroundColor=this.Op[this.Op.length-1].color}iYh(ta,jb){const Mb=this.Uc.get(6,0),xb=this.Uc.get(14);return Yf.createClusteredImageFromClusterWithImageClass(Mb,Mb,this.Uc.get(ta),this.Uc.get(jb),"cui-img-cont-float cui-img-16by16","",!1,"",this.element.ownerDocument,xb?xb.cloneNode(!0):null)}k0(ta){3!==ta.Jf&&this.raiseEvent(Lc.gX,new Lc(2,ta));return!1}onClick(ta){this.raiseEvent(Lc.gX,new Lc(1,
ta));return!0}rR(ta){3!==ta.Jf&&this.raiseEvent(Lc.gX,new Lc(3,ta));return!1}FUm(){this.element&&(this.Ljc.Gb(Pd.a.pointerDown,this.element,Object(c.a)(this,this.Aoa,"stopPropagationAndPreventDefaultBehavior")),this.Ljc.Gb(Pd.a.pointerOver,this.element,Object(c.a)(this,this.k0,"onPointerOver")),this.Ljc.Gb(Pd.a.pointerOut,this.element,Object(c.a)(this,this.rR,"onPointerOut")),this.Ho.Gb(Pd.a.nF,this.element,Object(c.a)(this,this.Aoa,"stopPropagationAndPreventDefaultBehavior")),this.Ho.Gb(Pd.a.click,
this.element,Object(c.a)(this,this.onClick,"onClick")),this.nL.Gb(this.element,Object(c.a)(this,this.Aoa,"stopPropagationAndPreventDefaultBehavior")))}Ggl(){this.element&&(this.Ljc.Ma(Pd.a.pointerDown,this.element,Object(c.a)(this,this.Aoa,"stopPropagationAndPreventDefaultBehavior")),this.Ljc.Ma(Pd.a.pointerOver,this.element,Object(c.a)(this,this.k0,"onPointerOver")),this.Ljc.Ma(Pd.a.pointerOut,this.element,Object(c.a)(this,this.rR,"onPointerOut")),this.Ho.Ma(Pd.a.nF,this.element,Object(c.a)(this,
this.Aoa,"stopPropagationAndPreventDefaultBehavior")),this.Ho.Ma(Pd.a.click,this.element,Object(c.a)(this,this.onClick,"onClick")),this.nL.Ma(this.element,Object(c.a)(this,this.Aoa,"stopPropagationAndPreventDefaultBehavior")))}}Object(f.a)(Jk,"PresenceTooltipGlyph",Ob,[]);class uj extends Ob{constructor(ta,jb,Mb){super(ta);this.Op=[];this.JL=[];this.lUa=0;this.r0c=this.Wgc=!1;this.qSg=null;this.aQd={};this.Uc=Mb;this.ik=Mb.get(8,!1);this.sqa=Mb.get(11,!1);ta=Mb.get(12,0);this.imageDimension=Mb.get(6,
0);this.lra=jb;this.element.id=uj.kub();this.element.className=Ob.RIh(this.ik);ta&&(this.zIndex=ta);this.rtl=this.ik;this.Hyg(jb);this.nGa=this.createElement("div");this.nGa.className=this.sqa?"prContainerV":"prContainerHr";this.element.appendChild(this.nGa);this.s0g=Array(this.lUa);for(jb=0;jb<this.lUa;jb++)this.Zfa[jb]=new uh(this.createElement("div"),this.Uc),this.Zfa[jb].nRb(Object(c.a)(this,this.s_a,"onInteractivityChanged")),this.element.appendChild(this.Zfa[jb].element)}get Nte(){return Id.a.clone(this.Op)}get Zfa(){return this.s0g}get mnh(){return this.qSg}get OBe(){return this.imageDimension+
2}get width(){return this.sqa?this.OBe:this.lra}get height(){return this.sqa?this.lra:this.OBe}nRb(ta){this.addHandler(Lc.gX,ta)}C9b(ta){this.removeHandler(Lc.gX,ta)}dispose(){if(this.Zfa)for(const ta of this.Zfa)ta.C9b(Object(c.a)(this,this.s_a,"onInteractivityChanged")),Gg.a.OB(ta);Gg.a.bwg(this.JL);this.JL=this.s0g=null;super.dispose()}JEc(){this.Ddb();this.HDg();this.visible=!0;this.Wgc=!1}YDd(){!this.JL||1>this.JL.length||(this.Ddb(),this.visible=!0,this.HDg(),this.Fte(this.JL[this.JL.length-
1]),this.Wgc=!0)}xDg(){if(this.JL&&!(1>this.JL.length)){this.visible=!0;this.HDg();var ta=0;for(const jb of this.JL)this.Fte(jb,ta++);this.Wgc=!1;this.r0c=!0}}hide(){this.visible=!1;this.Ddb();for(let ta=0;ta<this.JL.length;ta++)this.JL[ta].hide();this.Wgc=!1}jBh(){if(!this.r0c)return!1;let ta=0;for(const jb of this.Zfa)jb.visible&&ta++;return this.r0c=0<ta&&(this.Op.length<=this.lUa?ta===this.Op.length:ta===this.lUa)}Gka(ta){if(!(0>=this.lUa)){ta.clientId||(ta.clientId=(uj.VSc++).toString());if(ta.clientId in
this.aQd){var jb=this.$Wb(ta.clientId);if(0<=jb){jb=this.Op[jb];if(jb.color===ta.color&&jb.userName===ta.userName)return;this.cib(ta.clientId)}}jb=this.jBh();var Mb=0;if(this.Op.length<this.lUa){var xb=new Jk(this.createElement("div"),this.Uc,ta);xb.nRb(Object(c.a)(this,this.s_a,"onInteractivityChanged"));this.ik&&!this.sqa&&0<this.Op.length?this.nGa.insertBefore(xb.element,this.nGa.firstChild):(this.nGa.appendChild(xb.element),Mb=this.JL.length);Array.add(this.JL,xb)}else this.ik&&!this.sqa?xb=this.JL[0]:
(Mb=this.JL.length-1,xb=this.JL[Mb]),xb.Gka(ta);xb.show();this.aQd[ta.clientId]=xb;Array.add(this.Op,ta);this.$aj(xb,Mb);jb&&this.xDg()}}cib(ta){const jb=this.jBh();jb&&this.Ddb();this.Azd(ta);this.Op.length>=this.lUa&&this.JL.length<this.lUa&&this.ucm();0>=this.Op.length?this.hide():jb&&this.xDg()}Azd(ta){var jb=this.$Wb(ta);0>jb||(ta=this.Op[jb],Array.removeAt(this.Op,jb),jb=this.aQd[ta.clientId],delete this.aQd[ta.clientId],jb.cib(ta.clientId),this.$aj(jb),0>=jb.sgb&&(this.nGa.removeChild(jb.element),
Array.remove(this.JL,jb),jb.dispose()))}ucm(){var ta=this.L0k();!ta||1>=ta.fJ.length||(ta=Array.clone(this.Op),ta.forEach(jb=>{this.Azd(jb.clientId)}),ta.forEach(jb=>{this.Gka(jb)}))}$Wb(ta){for(let jb=0;jb<this.Op.length;jb++)if(this.Op[jb].clientId===ta)return jb;return-1}L0k(){return this.ik&&!this.sqa?this.JL[0]:this.JL[this.JL.length-1]}position(ta,jb){this.element.style.top=jb+"px";this.element.style.left=ta+"px"}HDg(){for(let ta=0;ta<this.JL.length;ta++)this.JL[ta].show()}Ddb(){for(let ta=
0;ta<this.lUa;ta++)this.Zfa[ta].hide();this.r0c=!1}Fte(ta,jb=0){if(ta)if(this.qSg=ta,this.sqa){const Mb=this.imageDimension;if(1<ta.fJ.length)this.Zfa[jb].show(ta.fJ,Mb,this.height-this.imageDimension);else{const xb=this.nGa.children.length;for(let Nc=0;Nc<this.nGa.children.length;Nc++)ta.element===this.nGa.children[Nc]&&this.Zfa[jb].show(ta.fJ,Mb,this.height-(xb-Nc)*this.OBe+2)}}else this.Zfa[jb].show(ta.fJ,this.width,0)}s_a(ta,jb){var Mb=Object(z.a)(Jk,ta);Mb=Mb?this.TSh(Mb):-1;if(2===jb.type||
1===jb.type&&-1!==Mb&&!this.Zfa[Mb].visible)this.Fte(ta);else if(1===jb.type)this.Ddb(),this.Wgc=!1;else if(3===jb.type){if(this.ICf(jb.Oo))return;this.Wgc||this.Ddb()}this.raiseEvent(Lc.gX,jb)}ICf(ta){ta=uj.BOf(ta);let jb=!1;for(const Mb of this.Zfa)if(Xd.a.yeb(Mb.element,ta)){jb=!0;break}return this.nGa!==ta&&Xd.a.yeb(this.nGa,ta)||jb}$aj(ta,jb=0){const Mb=this.Jol(ta);Mb&&0>=ta.sgb?this.Zfa[jb].hide():Mb?this.Fte(ta):this.Zfa[jb].hide()}TSh(ta){let jb=0;for(const Mb of this.JL){if(ta===Mb)return jb;
jb++}return-1}Jol(ta){const jb=this.TSh(ta);return!!this.mnh&&ta===this.mnh&&-1!==jb&&this.Zfa[jb].visible}Hyg(ta){this.lUa=ta===this.imageDimension?1:Math.floor(ta/this.OBe);this.sqa?(this.element.style.height=ta+"px",this.element.style.width=this.imageDimension+"px"):(this.element.style.width=ta+"px",this.element.style.height=this.imageDimension+"px")}static kub(){return String.format("{0}-{1}","presencetooltip",uj.VSc++)}static BOf(ta){ta=ta.$a.rawEvent;return ta.relatedTarget||ta.toElement}}uj.VSc=
0;Object(f.a)(uj,"PresenceTooltipControl",Ob,[887,12]);class Uf{constructor(ta){this.Uc=ta;this.Uc.zVa(10,ah.a.instance);this.Uc.zVa(9,Kg.a.instance);this.Uc.zVa(6,16);this.Uc.zVa(13,cg.a.instance)}Btf(ta){return new uj(ta,16,this.Uc)}}Object(f.a)(Uf,"PresenceTooltipFactory",null,[886]);class bf{constructor(ta,jb,Mb,xb,Nc,rc,wd,Fc,qe=!1){this.zlb=null;this.HRe=!0;this.E4e=this.Np=this.pKe=null;this.la=new Aa.a;this.iUa=ta;this.nka=jb;this.xdh=Mb;this.SYc=xb;this.QTg=rc;bf.Za=Nc;this.gGj=wd;this.y1=
Fc;this.fHj=qe;S.Task.WAA(jb,Mb).continueWith(Object(c.a)(this,this.mjl,"initOnTaskReady"))}XVj(ta){this.la.addHandler("u",ta)}xKi(){this.la.raiseEvent("u",null,this)}mjl(){this.nka.result&&this.xdh.result&&(this.Np=this.nka.result,this.E4e=this.xdh.result,this.Np.FVa(Object(c.a)(this,this.l0,"onPresenceUpdated")),this.pKe=new Na.a(2,2,this.QTg,Object(c.a)(this,this.pWm,"updateAwayClientsTask"),88),bf.Za.Cb(this.pKe))}l0(ta,jb){(this.HRe||this.ncm(jb.yxa))&&bf.Za.N3(this.pKe,0)}ncm(ta){for(let Mb in ta){var jb=
this.SYc.Hee({key:Mb,value:ta[Mb]});if(jb&&jb.clientId&&(jb=jb.clientId.toLowerCase(),(jb=this.zlb[jb]||this.zlb[jb.toUpperCase()])&&2===jb.status))return!0}return!1}pWm(ta){var jb=this.Np.Ued();if(jb){var Mb=new Date,xb=!1;if(this.HRe){this.zlb=jb;this.HRe=!1;var Nc=this.zlb;for(var rc in Nc){jb=rc;var wd=Nc[rc];wd.nxc<Mb&&(Mb=wd.nxc);2===wd.status&&(xb=!0,this.E4e.Bzd(jb))}xb&&this.xKi();bf.Za.N3(ta,this.e2h(Mb))}else{wd=new J.a;rc=!1;var Fc=this.zlb;for(Nc in Fc){Fc=Nc;if(!(Fc in this.zlb)||this.iUa.clientId===
Fc)continue;var qe=this.zlb[Fc];const Nf=jb[Fc];if(qe&&Nf){qe=qe.status;const mg=Nf.status;2===qe&&1===mg?(wd.add(Fc),m.ULS.sendTraceTag(38052609,392,50,Fc+" returned from away")):1===qe&&2===mg&&(rc=xb=!0,this.E4e.Bzd(Fc),m.ULS.sendTraceTag(38052610,392,50,Fc+" went away"));1===mg&&Nf.nxc<Mb&&(Mb=Nf.nxc)}}this.zlb=jb;bf.Za.N3(ta,this.e2h(Mb));(0<wd.count||xb)&&this.xKi();0<wd.count&&!this.fHj?(ta=this.RPk(wd),this.xQm(ta)):ta=new J.a;(rc||0<ta.count)&&this.gGj(Zb.a.eqf,2)}}}xQm(ta){if(ta.count)for(let jb of ta)ta=
this.y1.DAa(String.format(CommonUIStrings.l_EditorsToastArriving,jb),!1),ta.image=5,ta.oua="CoAuth_AuthorStatus_16x16x32",this.y1.aA(ta)}RPk(ta){const jb=this.Np.GXb(),Mb=new J.a;for(let xb in jb){const Nc={key:xb,value:jb[xb]};if(ta.contains(Nc.key)){const rc=this.SYc.Hee(Nc);rc&&(Mb.add(rc.userName),ta.remove(Nc.key))}}Mb.count||m.ULS.sendTraceTag(38052611,392,10,"There were no coauthor names found");return Mb}e2h(ta){const jb=new Date;return Math.max(ta.getTime()+this.QTg-jb.getTime(),0)}}bf.Za=
null;Object(f.a)(bf,"AwayManager",null,[]);var Il=b(665);class vj{constructor(ta=0){this.updates=ta}get oTf(){return!!this.updates}JBa(ta){return!!(this.updates&ta)}ajb(ta){this.updates|=ta}toString(){if(this.JBa(0))return"none";const ta=new J.a;this.JBa(1)&&ta.add("user(s) joined");this.JBa(2)&&ta.add("user(s) disconnected");this.JBa(4)&&ta.add("user(s) updated");return ta.toArray().join(", ")}}Object(f.a)(vj,"UserUpdateEvent",null,[]);var Ie=b(31);class Rf{constructor(ta,jb,Mb,xb,Nc=null){this.la=
new Aa.a;this.JE=this.Ai=null;this.i$g=this.B$g=this.Fi=!1;this.Op=new Pa.a;ta.continueWith(()=>{this.Ai=ta.result;this.Ai.FVa(Object(c.a)(this,this.zCi,"onRtcPresenceUpdate"));this.Ai.Zza(Object(c.a)(this,this.yCi,"onRtcConnectionChange"));this.SNg(null,null)});jb.continueWith(()=>{this.JE=jb.result;this.JE.m6(Object(c.a)(this,this.jud,"onEditorsTableUpdated"))});Nc&&Nc.continueWith(()=>{Nc.result.XVj(Object(c.a)(this,this.SNg,"updateUserStatus"));this.SNg(null,null)});this.yUa=Mb;this.SYc=xb}get fJ(){return this.Op}b4c(ta){this.la.addHandler("UU",
ta)}xsg(ta){this.la.removeHandler("UU",ta)}SNg(){if(this.Ai){var ta=!1,jb=this.Ai.Ued();for(let xb in jb){var Mb=jb[xb];const Nc=xb;this.fJ.La(Nc)&&(Mb=this.e8i(Mb),ta=this.fJ.J(Nc).qTb!==Mb||ta,this.fJ.J(Nc).qTb=Mb)}ta&&(ta=new vj(4),this.Hye(ta))}}e8i(ta){return 1===ta.status?0:1}pub(){this.fJ.count||(this.B$g||(Ie.b(42316242,302,50,"No users available at PeopleInfoProvider.GetAllUsers call"),this.B$g=!0),this.V4l());const ta=[];for(let jb of this.fJ)Array.add(ta,jb.value);return ta}V4l(){if(this.Ai){var ta=
this.Ai.GXb();this.pag(ta)}if(this.JE){ta=this.JE.oub();for(const jb of ta)jb.Id&&(ta=this.rJh(jb.Id),this.RNg(new vj,ta))}}usi(ta){({value:ta}=this.fJ.tb(ta));return ta}dispose(){this.Fi||(this.Ai&&(this.Ai.E9b(Object(c.a)(this,this.zCi,"onRtcPresenceUpdate")),this.Ai.Fzd(Object(c.a)(this,this.yCi,"onRtcConnectionChange"))),this.JE&&this.JE.dsg(Object(c.a)(this,this.jud,"onEditorsTableUpdated")),this.Fi=!0)}yCi(ta,jb){2===jb.newState&&(ta=this.pag(this.Ai.GXb()),ta.oTf&&this.Hye(ta))}jud(ta,jb){ta=
new vj;var Mb=this.JE.oub();m.ULS.sendTraceTag(561894485,302,50,"editorstablemanager coauthors count is {0}, editorstableupdate old count of coauthors is {1}, editorstableupdate new count of coauthors is {2}",Mb.length,jb.Oyi,jb.ape);const xb=new Pa.a;for(var Nc of Mb){Mb=Nc.Id;const rc=this.rJh(Mb);this.RNg(ta,rc);xb.W(Mb,rc)}if((jb=jb.leaving)&&0<jb.length)for(Nc=0;Nc<jb.length;Nc++)m.ULS.sendTraceTag(562415168,302,50,"{0} users in coauth gallery. User leaving the editor table: {1}",this.fJ.count,
jb.J(Nc).Id),({value:Mb}=this.fJ.tb(jb.J(Nc).Id)).returnValue?Mb?(this.fJ.remove(jb.J(Nc).Id),ta.ajb(2),xb.W(jb.J(Nc).Id,Mb)):m.ULS.sendTraceTag(561287839,302,50,"Empty entry in PIP users: {0}",jb.J(Nc).Id):m.ULS.sendTraceTag(570426140,302,15,"Disconnected user not found: {0}",jb.J(Nc).Id);jb=this.Ai.GXb();for(let rc in jb)Nc=this.SYc.Hee({key:rc,value:jb[rc]}),xb.W(Nc.clientId,Nc);for(let rc of this.fJ)xb.La(rc.value.clientId)||(m.ULS.sendTraceTag(561287840,302,15,"Coauth Gallery contains user not in Editors Table or RTC presence: {0}",
rc.key),this.fJ.remove(rc.key),ta.ajb(2));ta.oTf&&this.Hye(ta)}zCi(ta,jb){ta=this.pag(jb.yxa);for(const Mb of jb.W8d)this.fJ.La(Mb)&&(ta.ajb(2),this.fJ.J(Mb).qTb=2);ta.oTf&&this.Hye(ta)}pag(ta){const jb=new vj;if(!ta)return jb;for(let xb in ta){var Mb=this.SYc.Hee({key:xb,value:ta[xb]});Mb&&(Mb=Mb.clone(),this.RNg(jb,Mb))}return jb}RNg(ta,jb){if(jb){var Mb=jb.clientId;var xb=this.jom(jb);({value:jb}=this.fJ.tb(Mb)).returnValue?jb.equals(xb)||(ta.ajb(4),this.fJ.W(Mb,xb)):(m.ULS.sendTraceTag(562415169,
302,50,"{0} users in coauth gallery. User joining: {1}",this.fJ.count,Mb),ta.ajb(1),this.fJ.W(Mb,xb))}}rJh(ta){return this.fJ.La(ta)?this.fJ.J(ta):ha.Olk(ta)}jom(ta){if(!ta||!ta.clientId||!this.JE)return ta;const jb=ta.clone();jb.qTb=this.QPk(ta);if(ta=this.JE.HXa(jb.clientId))jb.isReadOnly=jb.isReadOnly||ta.IsReadOnly?!0:!1,jb.userName=this.iom(jb,ta),jb.capabilities=this.wLl(jb.capabilities,ta.Capabilities),jb.email=jb.email||ta.SIPAddress||ta.EmailAddress,ta.JoinCoauthTime&&(jb.zZa=ta.JoinCoauthTime);
jb.color=this.yUa.otc(new Il.a(jb.email,void 0,jb.userName,void 0,jb.isAnonymous,jb.clientId),3);return jb}QPk(ta){if(!this.Ai)return 2;if(ta&&ta.clientId){const jb=this.Ai.Ued();if(ta.clientId in jb)return this.e8i(jb[ta.clientId])}return 2}Lfk(ta,jb){jb.Name&&ta.userName&&jb.Name!==ta.userName&&!this.i$g&&(this.i$g=!0,Ie.b(42316243,302,15,"User names in EditorsTable and RTC don't match"))}wLl(ta,jb){ta=ta||new V;jb&&(jb.SupportsRealtimeChannel&&ta.ajb(1),jb.SupportsRename&&ta.ajb(2),jb.SupportsChat&&
ta.ajb(4));return ta}iom(ta,jb){this.Lfk(ta,jb);return jb.Name||ta.userName||(ta.isAnonymous||jb.IsAnonymous?CommonUIStrings.l_GuestUserName:null)}Hye(ta){m.ULS.sendTraceTag(42316245,302,100,"PeopleInfoProvider update detected: {0}",ta.toString());this.la.raiseEvent("UU")}}Object(f.a)(Rf,"PeopleInfoProvider",null,[884,12]);var Bj=b(235),Jl=b(100),$i=b(68),Cg=b(5),qk=b(6),fj=b(20),dj=b(80),wi=b(612),ef=b(274),he=b(212);class We extends Sys.EventArgs{constructor(ta,jb){super();this.paragraphId=ta;this.JCl=
jb}}Object(f.a)(We,"PresenceControlRenderedEventArgs",Sys.EventArgs,[]);class nh extends Ob{constructor(ta,jb,Mb,xb,Nc,rc=null,wd=null){super(null);this.pUe=this.rm=null;this.pqd=!1;this.lxa=0;this.qp=ta;this.N1c=jb;this.yr=Mb;this.kf=xb;this.wpa=Nc;nh.XJb=0;this.bsh=new Pa.a;this.TQi=new Pa.a;this.kC=rc;this.qa=wd;this.Fuj=this.qa.vb("PresenceIpRenderedFloodgateTimeLapseSec",30);this.LMj=this.qa.vb("PresenceIpRenderedFloodgateTriggerThreshold",3);this.hOc=0}get egb(){return v.AFrameworkApplication.K.$("PeoplesWellExtraButtonInfoIsEnabled")}NTj(ta){this.addHandler("CR",
ta)}pOi(ta){this.removeHandler("CR",ta)}mve(){this.raiseEvent("CR",new We(this.qp.ip.paragraphId,this.pqd))}hbg(){if(Object(he.a)(Ac,this.rm)){const ta=Object(z.a)(Ac,this.rm);nh.XJb=0<nh.XJb?nh.XJb+1:ta.Hab+1;ta.zIndex=nh.XJb;this.element.style.zIndex=String(nh.XJb)}}Inm(){if(Object(he.a)(Ac,this.rm)){const ta=Object(z.a)(Ac,this.rm);nh.XJb=ta.Hab;ta.zIndex=ta.Hab;this.element.style.zIndex=String(ta.Hab)}}Sri(){this.kC&&!this.dSm()&&this.kC.continueWith(()=>{this.kC.result.logActivity("PresenceIpRendered",
"PresenceIpRenderedFloodgateEnabled",this.Fuj)&&this.hOc++})}dSm(){return this.hOc>=this.LMj}static zri(){nh.g0g||(nh.g0g=!0,m.ULS.sendTraceTag(4006594,302,50,"First presence ip rendered on the page"))}static kub(ta){return nh.xhl+ta.b0h()}}nh.CHi="data-presence-control";nh.rEi="OverlayControlElementOwner";nh.xhl="ipId_";nh.DHi="WacPresence";nh.I0l="PresenceIpPaddingDiv";nh.g0g=!1;nh.XJb=0;Object(f.a)(nh,"APresenceControl",Ob,[1580,12]);class Qj{constructor(){this.rotation=this.height=this.width=
this.top=this.left=0;this.sDd=!1}}Object(f.a)(Qj,"PresenceImageControlStyle",null,[1579]);class Fh extends nh{constructor(ta,jb,Mb,xb,Nc,rc=null,wd=null){super(ta,jb,Mb,xb,Nc,rc,wd);this.Hch=null}cib(ta){this.rm&&this.rm.cib(ta)}TFe(){return this.rm?this.rm.Nte.length:0}updatePosition(ta){if(this.element&&this.element.parentNode){var jb=this.t0h(ta);if(jb){var Mb=Sys.UI.DomElement.getBounds(this.element.parentNode),xb,Nc;({left:Mb,top:xb,height:Nc,width:jb}=this.E2k(jb,Mb,this.element.parentNode,
this.kf.instance));this.element.style.top=xb+"px";this.element.style.left=Mb+"px";this.element.style.height=Nc+"px";this.element.style.width=jb+"px";Mb=this.A0h(ta);Me.a.Y3(this.element,Mb);ta=this.wLf(ta,this.qp.ip.shapeId);this.JYi(Mb,jb,this.isSelected(ta),v.AFrameworkApplication.isRtl);this.Kjb()}}}pE(ta){ta&&this.element&&ta===this.Hch&&(Xd.a.qr(this.element),this.rm.cib(this.qp.user.clientId),this.mve())}crf(ta,jb,Mb){const xb=new Qj;if(!Mb||!jb)return xb;jb=this.t0h(ta);if(!jb)return xb;xb.top=
jb.y;xb.left=jb.x;xb.height=jb.height;xb.width=jb.width;xb.rotation=this.y4k(ta);xb.sDd=!0;return xb}Fsg(ta,jb,Mb,xb){nh.zri();this.pUe=ta;if(xb){ta=this.wLf(ta,this.qp.ip.shapeId);if(!ta)return;const Nc=!this.element;Nc&&this.Itf(jb.ownerDocument);Nc||!this.element.parentNode?ta.appendChild(this.element):this.element.parentNode!==ta&&(this.element.parentNode.removeChild(this.element),ta.appendChild(this.element));this.rm.Gka(this.qp.user);this.Hch=jb;this.element.style.borderColor=this.qp.user.color;
this.element.id=nh.kub(this.qp);Mb.sDd&&(this.element.style.height=Mb.height+"px",this.element.style.top=Mb.top+"px",this.element.style.left=Mb.left+"px",this.element.style.width=Mb.width+"px",Me.a.Y3(this.element,Mb.rotation),Me.a.Y3(this.rm.element,-1*Mb.rotation),this.JYi(Mb.rotation,Mb.width,this.isSelected(ta),v.AFrameworkApplication.isRtl),this.Kjb())}this.pqd=!xb;this.mve()}y4k(ta){return this.element&&this.element.parentNode&&this.$4h(Me.a.getTransform(this.element.parentNode))?this.$4h(Me.a.getTransform(this.element)):
this.A0h(ta)}$4h(ta){return ta&&-1<ta.indexOf("deg")&&(ta=parseInt(ta.substring(ta.indexOf("(")+1,ta.indexOf("deg"))),!isNaN(ta))?ta:0}Caj(ta){this.element.style.borderColor=this.qp.user.color;this.element.id=nh.kub(this.qp);this.updatePosition(ta)}Itf(ta){this.element=ta.createElement("div");this.element.setAttribute(nh.CHi,!0);Jl.a.tj(this.element,nh.rEi,this);this.element.className=Fh.s6l;this.element.dir=v.AFrameworkApplication.isRtl?"rtl":"ltr";this.rm=this.N1c.Btf(this.createElement("div"),
!0);this.rm.Gka(this.qp.user);this.rm.hide();this.yr.Ma(Pd.a.pointerOut,this.rm.element,Object(c.a)(this,this.rR,"onPointerOut"));this.yr.Ma(Pd.a.pointerDown,this.rm.element,Object(c.a)(this,this.Mre,"onTooltipTouch"));Sys.UI.DomElement.addCssClass(this.rm.element,nh.DHi);this.element.appendChild(this.rm.element)}E2k(ta,jb,Mb,xb){let Nc=ta.y,rc=ta.x,wd=ta.height;ta=ta.width;(1<Math.abs(jb.width-Mb.offsetWidth)||1<Math.abs(jb.height-Mb.offsetHeight))&&xb&&(Nc=Math.round(Nc/xb.Eh),rc=Math.round(rc/
xb.Eh),wd=Math.round(wd/xb.Eh),ta=Math.round(ta/xb.Eh));return{left:rc,top:Nc,height:wd,width:ta}}isSelected(ta){return Sys.UI.DomElement.containsCssClass(ta,ef.a.Dpc)}JYi(ta,jb,Mb,xb){this.rm.element.style.left="auto";this.rm.element.style.top="auto";this.rm.element.style.right="auto";this.rm.element.style.bottom="auto";Mb=Mb?Math.round(.5*Fh.kxa)+Fh.YQm:0;0<=ta&&90>ta||360===ta?(this.rm.element.style.top=-.5*Fh.kxa-Mb+"px",xb?this.rm.element.style.right=jb-.5*Fh.kxa+"px":this.rm.element.style.left=
jb-.5*Fh.kxa+"px"):90<=ta&&180>ta?(this.rm.element.style.left=-.5*Fh.kxa-Mb+"px",xb?this.rm.element.style.bottom=-.5*Fh.kxa+"px":this.rm.element.style.top=-.5*Fh.kxa+"px"):180<=ta&&270>ta?(this.rm.element.style.bottom=-.5*Fh.kxa-Mb+"px",xb?this.rm.element.style.left=jb-.5*Fh.kxa+"px":this.rm.element.style.right=jb-.5*Fh.kxa+"px"):(this.rm.element.style.right=-.5*Fh.kxa-Mb+"px",xb?this.rm.element.style.top=-.5*Fh.kxa+"px":this.rm.element.style.bottom=-.5*Fh.kxa+"px")}Gh(ta,jb){const Mb=this.tde(ta,
jb);return Mb?Mb.properties:(ta=this.x0h(ta,jb))?ta.properties:null}wLf(ta,jb){var Mb=this.tde(ta,jb);return Mb&&(Mb=Mb.xBa(ta.rd))?Mb.element:(jb=this.x0h(ta,jb))?Object(z.a)(wi.a,jb).zd(ta.eb).htmlElement:null}tde(ta,jb){ta=dj.i(ta.za,5);for(const Mb of ta)if(Mb.properties.getValue(Cg.a.mqc)===jb)return Mb;return null}x0h(ta,jb){ta=qk.GraphIterator.wa(ta.za);let Mb=ta.Ta(6);for(;Mb;){const xb=Mb.properties.getValue(Cg.a.mqc);if(fj.ImageReader.Qw(Mb)&&xb===jb)return Mb;Mb=ta.kd(6)}return null}AWk(ta){const jb=
$i.a.Bd(fj.ImageReader.sz(ta),0);ta=$i.a.Bd(fj.ImageReader.nA(ta),1);return{Yoa:jb,Ufl:ta}}A0h(ta){ta=this.Gh(ta,this.qp.ip.shapeId);return fj.ImageReader.PT(ta)}t0h(ta){var jb=this.qp.ip;if(!jb||!jb.shapeId)return null;var Mb=this.Gh(ta,jb.shapeId);const xb=this.wLf(ta,jb.shapeId);if(!Mb||!xb)return null;({Yoa:ta,Ufl:jb}=this.AWk(Mb));let Nc=1,rc=1;Mb.hasProperty(Cg.a.EO)?(Mb=Mb.getValue(Cg.a.EO),Nc+=$i.a.Bd(Mb[0],0),rc+=$i.a.Bd(Mb[2],1)):(Nc+=0<xb.offsetWidth?(xb.offsetWidth-ta)/2:2,rc+=0<xb.offsetHeight?
(xb.offsetHeight-jb)/2:2);return new Sys.UI.Bounds(Math.round(Nc),Math.round(rc),Math.round(ta),Math.round(jb))}rR(){this.wvi();return!1}Mre(ta){this.rm&&3===ta.Jf&&(2!==this.lxa?(this.hbg(),this.Kjb()):this.wvi());return!1}wvi(){this.rm&&(this.rm.JEc(),this.lxa=1)}Kjb(){for(const ta of this.rm.Nte)if(ta.clientId===this.qp.user.clientId&&!ta.equals(this.qp.user)){this.rm.Gka(this.qp.user);break}if(this.qp.v1a||2===this.lxa)this.rm.YDd(),this.qp.v1a=!1,this.qp.Vga=!0,this.lxa=2;this.qp.Vga&&1!==this.lxa||
(this.rm.JEc(),this.qp.Vga=!0,this.lxa=1)}}Fh.s6l="WACImgPresenceHighlight";Fh.kxa=20;Fh.YQm=6;Object(f.a)(Fh,"PresenceImageControl",nh,[]);var wf=b(258);class Cj{constructor(){this.height=this.top=this.left=this.Ifi=0;this.sDd=!1}}Object(f.a)(Cj,"PresenceIpControlStyle",null,[1579]);class yd extends nh{constructor(ta,jb,Mb,xb,Nc,rc=null,wd=null,Fc=null){super(ta,jb,Mb,xb,Nc,rc,wd);this.D0c=this.v5a=this.Pkc=null;this.tD=Fc}Itf(ta){this.element=ta.createElement("div");this.element.setAttribute(nh.CHi,
!0);Jl.a.tj(this.element,nh.rEi,this);this.element.className=nh.I0l;this.element.dir=v.AFrameworkApplication.isRtl?"rtl":"ltr";this.yr.Ma(Pd.a.pointerOver,this.element,Object(c.a)(this,this.k0,"onPointerOver"));this.egb&&(this.yr.Ma(Pd.a.pointerOut,this.element,Object(c.a)(this,this.rR,"onPointerOut")),this.yr.Ma(Pd.a.pointerDown,this.element,Object(c.a)(this,this.Mre,"onTooltipTouch")));this.v5a=this.createElement("div");this.v5a.className=yd.t6l;this.egb||(this.D0c=this.createElement("div"),this.D0c.className=
yd.w6l,this.v5a.appendChild(this.D0c));this.rm=this.N1c.Btf(this.createElement("div"),this.egb);ta=this.qa.$("NoPresenceUserLookUpBeforeRender");this.tD&&!ta&&(this.qp.user=this.tD.usi(this.qp.user.clientId)||this.qp.user);this.rm.Gka(this.qp.user);this.rm.hide();Sys.UI.DomElement.addCssClass(this.rm.element,this.egb?nh.DHi:yd.Y2l);this.v5a.appendChild(this.rm.element);this.element.appendChild(this.v5a)}k0(ta){!this.rm||this.egb&&!this.rm.ICf(ta)||(this.hbg(),this.kye(ta));this.Caj(this.pUe);return!1}rR(){this.rm&&
this.lma();return!1}Mre(ta){this.rm&&3===ta.Jf&&(2!==this.lxa?(this.hbg(),this.kye(ta)):this.lma());return!1}Tsk(){this.Pkc&&($a.a.instance.Oe(this.Pkc),this.Pkc=null)}Kjb(ta){for(var jb of this.rm.Nte)if(jb.clientId===this.qp.user.clientId&&!jb.equals(this.qp.user)){this.rm.Gka(this.qp.user);break}jb=!1;yd.ork===this.qp.user.color?({value:jb}=this.bsh.tb(this.qp.user.clientId,jb,!1),jb||(this.bsh.W(this.qp.user.clientId,!0),m.ULS.sendTraceTag(17954772,302,50,'{ "ClientID" : "'+this.qp.user.clientId+
'" , "Event" : "RenderGrayPawn"}'))):({value:jb}=this.TQi.tb(this.qp.user.clientId,jb,!1),jb||(this.TQi.W(this.qp.user.clientId,!0),m.ULS.sendTraceTag(17954773,302,50,'{ "ClientID" : "'+this.qp.user.clientId+'" , "Event" : "RenderColoredPawn"}')));return ta||this.qp.v1a||2===this.lxa?(this.Sri(),this.rm.YDd(),this.qp.v1a=!1,this.qp.Vga=!0,this.lxa=2,yd.$Pm):this.qp.Vga&&1!==this.lxa?0:(this.Sri(),this.rm.JEc(),this.qp.Vga=!0,this.lxa=1,yd.ZPm)}kye(ta=null){this.Tsk();const jb=this.Kjb(!!ta);this.egb&&
ta&&ta.eventName===Pd.a.pointerOver||this.orm(jb)}lma(){this.rm&&this.lxa&&(this.Inm(),this.rm.hide(),this.lxa=0)}orm(ta){this.Pkc=new Na.a(2,1,ta,()=>{this.Pkc=null;this.lma()},56);$a.a.instance.Cb(this.Pkc)}updatePosition(ta){if(this.element&&this.element.parentNode){var jb=this.$0h(ta);if(jb){ta=Sys.UI.DomElement.getBounds(this.element.parentNode);jb=new Sys.UI.Bounds(jb.x-ta.x,jb.y-ta.y,yd.Mfi,jb.height);var Mb;({left:ta,top:jb,height:Mb}=this.H2k(jb,ta,this.element.parentNode,this.kf.instance));
this.element.style.height=2*yd.Dzc+Mb+"px";this.element.style.top=jb-yd.Dzc+"px";this.element.style.left=ta-yd.Dzc+"px";this.v5a.style.height=Math.max(yd.kvi,Mb)+"px";this.kye()}}}pE(ta){ta&&this.element&&ta===this.element.parentNode&&(Xd.a.qr(this.element),this.mve())}crf(ta,jb,Mb,xb){const Nc=new Cj;if(!Mb||!jb)return Nc;ta=this.$0h(ta);if(!ta)return Nc;Mb=new Sys.UI.Bounds(ta.x-jb.x,ta.y-jb.y,yd.Mfi,ta.height);jb=Mb.y;ta=Mb.x;Mb=Mb.height;const rc=this.kf.instance;xb&&rc&&(xb=rc.Eh,jb=Math.round(jb/
xb),ta=Math.round(ta/xb),Mb=Math.round(Mb/xb));Nc.top=jb-yd.Dzc;Nc.left=ta-yd.Dzc;Nc.height=2*yd.Dzc+Mb;Nc.Ifi=Math.max(yd.kvi,Mb);Nc.sDd=!0;return Nc}Fsg(ta,jb,Mb,xb){nh.zri();this.pUe=ta;xb&&((ta=!this.element)&&this.Itf(jb.ownerDocument),ta||!this.element.parentNode?jb.appendChild(this.element):this.element.parentNode!==jb&&(this.element.parentNode.removeChild(this.element),jb.appendChild(this.element)),jb=this.qp.user.color,this.v5a.style.borderColor=jb,this.egb||(this.D0c.style.borderColor=jb),
this.element.id=nh.kub(this.qp),Mb.sDd&&(this.element.style.height=Mb.height+"px",this.element.style.top=Mb.top+"px",this.element.style.left=Mb.left+"px",this.v5a.style.height=Mb.Ifi+"px",this.kye()));this.pqd=!xb;this.mve()}dispose(){this.element&&(this.pE(this.element.parentNode),this.yr.Gb(Pd.a.pointerOver,this.element,Object(c.a)(this,this.k0,"onPointerOver")),this.egb&&(this.yr.Gb(Pd.a.pointerOut,this.element,Object(c.a)(this,this.rR,"onPointerOut")),this.yr.Gb(Pd.a.pointerDown,this.element,
Object(c.a)(this,this.Mre,"onTooltipTouch"))),Gg.a.OB(this.rm),this.element=this.rm=null)}Caj(ta){const jb=this.qp.user.color;this.v5a.style.borderColor=jb;this.egb||(this.D0c.style.borderColor=jb);this.element.id=nh.kub(this.qp);this.updatePosition(ta)}H2k(ta,jb,Mb,xb){let Nc=ta.y,rc=ta.x;ta=ta.height;(1<Math.abs(jb.width-Mb.offsetWidth)||1<Math.abs(jb.height-Mb.offsetHeight))&&xb&&(Nc=Math.round(Nc/xb.Eh),rc=Math.round(rc/xb.Eh),ta=Math.round(ta/xb.Eh));return{left:rc,top:Nc,height:ta}}$0h(ta){const jb=
this.qp.ip;if(!jb)return null;let Mb;try{const xb=jb.Zha.cp;Mb=wf.a.eQ(xb,ta,0<xb,!1,!1,!1)}catch(xb){m.ULS.sendTraceTag(4301318,302,50,"Could not determine the bounds of IP: isYielding={0} message={1} stack={2}",$a.a.instance.Gy,xb.message,xb.stack),Mb=null}return Mb}}yd.Y2l="WacPawn";yd.Mfi=2;yd.ZPm=7E3;yd.$Pm=2E3;yd.Dzc=5;yd.t6l="presenceIp";yd.w6l="PresenceSmallBox";yd.kvi=10;yd.ork="0xcccccc";Object(f.a)(yd,"PresenceIpControl",nh,[]);class te{constructor(ta,jb,Mb,xb,Nc=null,rc=null,wd=null){this.tOc=
{};this.rOc={};this.FVg={};this.N1c=ta;this.yr=jb;this.ql=Mb;this.wpa=xb;this.kC=Nc;this.qa=rc;this.tD=wd}get zqk(){return this.tOc}get JJh(){return this.rOc}D2k(ta){const jb=!!this.qa&&this.qa.$("PeoplesWellExtraButtonInfoIsEnabled");return ta.ip.shapeId&&jb?this.I2k(ta):this.J2k(ta)}I2k(ta){const jb=ta.ip.shapeId.toString();this.FVg[ta.user.clientId]=jb;const Mb=this.rOc[jb];return Mb?(Mb.qp=ta,{returnValue:Mb,SFe:!0}):{returnValue:this.rOc[jb]=new Fh(ta,this.N1c,this.yr,this.ql,this.wpa,this.kC,
this.qa),SFe:!1}}J2k(ta){const jb=ta.user.clientId,Mb=this.tOc[jb];return Mb&&Mb.qp.user.equals(ta.user)?(Mb.qp=ta,{returnValue:Mb,SFe:!0}):{returnValue:this.tOc[jb]=new yd(ta,this.N1c,this.yr,this.ql,this.wpa,this.kC,this.qa,this.tD),SFe:!1}}a1h(ta){return this.tOc[ta]}xWk(ta){return(ta=this.rOc[this.FVg[ta]])&&!ta.TFe()?ta:null}Awk(){var ta=this.tOc;for(const jb in ta)ta[jb].dispose();ta=this.rOc;for(const jb in ta)ta[jb].dispose()}}Object(f.a)(te,"PresenceControlProvider",null,[]);var me=b(164);
class pk{constructor(){this.Rob=0}h2h(){this.Rob++;this.Rob===Number.MAX_VALUE&&(this.Rob=1);return this.Rob}static get instance(){return pk.VXc}}pk.VXc=new pk;Object(f.a)(pk,"PacketIdGenerator",null,[861]);var Bi=b(842);class td{constructor(ta,jb,Mb){this.wrm=ta;this.til=jb;this.Hni=Mb}}Object(f.a)(td,"SuccessfulInboundReplicationCallbackData",null,[]);class ci{constructor(ta,jb,Mb,xb,Nc,rc,wd){this.Np=ta;this.USe=jb;this.Se=Mb;this.hMj=Nc;this.Psj=rc;this.VGa=xb;this.Fp=wd;this.Mpm.n6(Object(c.a)(this,
this.Tpm,"rtcOnUpdateNotificationReceived"))}get Mpm(){return this.Np}Tpm(ta,jb){jb.type||(ta=this.Se.OAf>=this.Psj,this.hMj&&ta?(ta=this.USe())?ta.TBf():m.ULS.sendTraceTag(19682513,500,15,"ActivePage ContentReplicator was null, we are abandoning the inbound attempt."):this.dr())}dr(){const ta=this.USe();if(!ta)m.ULS.sendTraceTag(19682514,500,15,"ActivePage ContentReplicator was null, we are abandoning the inbound attempt.");else if(!this.VGa()&&ta.uba){let jb=-1;Object(he.a)(Bi.a,ta)&&(jb=ta.re.PU());
const Mb=this.Fp.le("Task","ShoulderTapInboundReplicationTimer");ta.dr(Object(c.a)(this,this.RYl,"onSuccessfulReplication"),null,new td(jb,Mb,ta.Vk))}}RYl(ta){if(ta=Object(z.a)(td,ta)){var jb=ta.til.Wf.toString(),Mb=this.USe(),xb=Mb.Vk,Nc="";xb!==ta.Hni&&(m.ULS.sendTraceTag(19964236,500,50,"Time saved due to force inbound on update notification message = {0} ms",ta.wrm.toString()),Nc=this.j_k(Mb,xb,ta.Hni));m.ULS.sendTraceTag(19964237,500,50,"Revisions: {0}, InboundDuration: {1}",Nc,jb)}else m.ULS.sendTraceTag(19964235,
500,10,"The callback data was null")}j_k(ta,jb,Mb){const xb=new Sys.StringBuilder;ta=ta.node.wc.store.getRevision(jb);if(!ta)return m.ULS.sendTraceTag(19964238,500,10,"The revision we got from the last replicator revisionId was null - {0}",{["lastRevisionId"]:jb}),"";for(xb.append(ta.id.guid);jb!==Mb;){xb.append(", ");xb.append(jb.guid);ta=ta.Ag;if(!ta)break;jb=ta.id}return xb.toString()}}Object(f.a)(ci,"ContentNotificationManager",null,[]);class Dg extends ci{constructor(ta,jb,Mb,xb,Nc,rc,wd){super(ta,
jb,Mb,xb,Nc,rc,wd)}static get S0a(){return Dg.Bpb||(Dg.Bpb=ka.a.instance.resolve("Box4.Presence.IRtcProxyProvider"))}static init(){if(mb.App.na){var ta=mb.App.na.Aa;ta&&(ta.Q$(Dg.Qtd),ta=ta.Nb)&&(Dg.Uv=ta.contentReplicator,Dg.Uv&&mb.App.ema().continueWith(Dg.$td))}}static $td(){Dg.aMd=mb.App.ema().result;Dg.aMd&&Dg.aMd.Sk&&Dg.S0a.mK().continueWith(Dg.Mud)}static Mud(){Dg.Ai=Dg.S0a.mK().result;if(Dg.Ai){var ta=v.AFrameworkApplication.K,jb=ta.$("Box4ThrottleInboundRequests");ta=ta.vb("Box4ThrottleInboundsAtUserCount",
20);Dg.Uv.evb=()=>Dg.Ai.$zb;Dg.YLd=Dg.YLd||new Dg(Dg.Ai,()=>Dg.Uv,Dg.aMd,()=>v.AFrameworkApplication.gi,jb,ta,mb.App.na.$o);Dg.YLd.dr()}}static Qtd(ta){Dg.YLd||(ta.A0a(Dg.Qtd),Dg.init())}}Dg.YLd=null;Dg.Bpb=null;Dg.Ai=null;Dg.Uv=null;Dg.aMd=null;Object(f.a)(Dg,"WordContentNotificationManager",ci,[]);class Qi{constructor(ta,jb,Mb,xb,Nc,rc){this.uja=null;this.vdh=ta;this.Bc=Mb;this.nUa=xb;this.Mt=Nc;this.Hf=rc;this.gOj=jb}clone(){return new Qi(this.vdh,this.Ydc.clone(),this.Bc,this.nUa,this.Mt,this.Hf)}get Ydc(){return this.gOj}get cp(){if(null!=
this.uja)return this.uja;var ta=this.vdh.paragraphId;if(ta.equals(kc.a.nil))return 0;var jb=this.nUa();if(!jb)return 0;ta=jb.Ua(ta);if(!ta)return m.ULS.sendTraceTag(7685326,302,15,"Paragraph Node is null so returning a CP with value 0"),0;jb=this.Bc.usb(this.Bc.oPa(ta.characterData,ta.ka),this.Ydc);if(this.Mt&&this.Hf&&ta.yz){const Mb=Qc.a.uc(ta,jb);Mb.gb=this.Hf.NMf(ta,jb,this.Ydc.r2);jb=this.Mt.AAa(Mb,!0)}return jb}dgg(){null==this.uja&&(this.uja=this.cp)}equals(ta){return ta?this.Ydc.isEqual(ta.Ydc,
!1):!1}}Object(f.a)(Qi,"WordPresenceCp",null,[873,146,874]);class ti{constructor(ta,jb){this.Mt=ta;this.Hf=jb}create(ta,jb,Mb,xb){return new Qi(ta,jb,Mb,xb,this.Mt,this.Hf)}}Object(f.a)(ti,"Factory",null,[860]);var Ke=b(597);class gi extends Sys.EventArgs{constructor(ta,jb,Mb){super();this.paragraphId=ta;this.presence=jb;this.YXf=Mb}}Object(f.a)(gi,"ParagraphChangedEventArg",Sys.EventArgs,[]);class nf{constructor(ta){this.uja=ta}get cp(){return this.uja}equals(ta){return ta?this.cp===ta.cp:!1}clone(){return new nf(this.uja)}}
Object(f.a)(nf,"PresenceCp",null,[873,146]);class Dh{constructor(ta,jb,Mb,xb,Nc){this.paragraphId=ta;this.cp=jb;this.length=Mb;this.shapeId=xb;this.dryDeletion=Nc}}Object(f.a)(Dh,"SerializablePresenceIpData",null,[]);class Rj{constructor(ta,jb,Mb,xb=0,Nc=0){this.WV=null;ta&&(this.WV=kc.a.Ad(ta));this.sVd=new nf(jb);this.qPa=Mb;this.QXd=xb;this.NNd=Nc}get paragraphId(){return this.WV}get Zha(){return this.sVd}get shapeId(){return this.QXd}get dryDeletion(){return this.NNd}Gc(){return 0<=this.Zha.cp&&
!!this.paragraphId&&!this.paragraphId.equals(kc.a.nil)}getData(){return new Dh(this.paragraphId.toString(),this.Zha.cp,this.qPa,this.shapeId,this.dryDeletion)}clone(){const ta=new Rj;ta.WV=this.paragraphId;ta.sVd=this.Zha?this.Zha.clone():null;ta.qPa=this.qPa;ta.QXd=this.shapeId;ta.NNd=this.dryDeletion;return ta}static eUb(ta){return ta.paragraphId&&void 0!==ta.cp&&null!==ta.cp&&void 0!==ta.length&&null!==ta.length?new Rj(ta.paragraphId,ta.cp,ta.length,void 0,ta.dryDeletion):null}}Object(f.a)(Rj,
"PresenceIp",null,[854,146]);class se{constructor(ta,jb){this.ip=ta;this.user=jb}}Object(f.a)(se,"SerializablePresenceData",null,[]);class qf{constructor(ta,jb){this.v1a=this.Vga=this.Oxc=!1;this.u5a=jb;this.user=ta}get ip(){return this.u5a}aPf(){return new se(this.ip?this.ip.getData():null,this.user.getData())}b0h(){return this.user.clientId+(this.u5a?this.u5a.paragraphId.toString():kc.a.nil.toString())}Gc(){const ta=!!this.user&&this.user.Gc(),jb=!this.ip||this.ip.Gc();return ta&&jb}clone(){const ta=
new qf;ta.user=this.user?this.user.clone():null;ta.u5a=this.u5a?this.u5a.clone():null;ta.Vga=this.Vga;ta.Oxc=this.Oxc;ta.v1a=this.v1a;return ta}static eUb(ta){return ta?new qf(ya.eUb(ta.user),ta.ip?Rj.eUb(ta.ip):null):null}}Object(f.a)(qf,"PresenceInfo",null,[856,146]);class rk extends Aa.a{constructor(){super();this.jYc={};this.l3a={};this.b0g=!1}get s1l(){return this.jYc}get Wji(){return!!v.AFrameworkApplication.K&&v.AFrameworkApplication.K.$("PeoplesWellExtraButtonInfoIsEnabled")}Pqh(ta){this.addHandler("PPC",
ta)}JOi(ta){this.removeHandler("PPC",ta)}Msc(ta){return ta.ip.paragraphId.toString()}eff(ta,jb=!1){this.b0g||(this.b0g=!0,m.ULS.sendTraceTag(4289312,302,50,"First presence added to data manager"));var Mb=({u6l:xb}=this.wzl(ta)).returnValue;if(xb&&!jb)(Mb=this.l3a[ta.user.clientId])&&0<=Mb.length&&(Mb[Mb.length-1].ip.qPa=ta.ip.qPa);else{Mb||this.aOi(ta.user.clientId);this.Wji&&Mb&&this.eYm(ta);jb=this.Msc(ta);var xb=ta.user.clientId;var Nc=this.jYc[jb]||[],rc=this.l3a[xb]||[];rc.length>=rk.bui&&(rc=
rc.splice(-rk.iQl,rk.bui));Mb||Nc.push(xb);rc.push(ta);this.jYc[jb]=Nc;this.l3a[xb]=rc;ta.ip.paragraphId.equals(kc.a.nil)||this.jog(ta.ip.paragraphId,ta,!0)}}wzl(ta){var jb=this.l3a[ta.user.clientId];const Mb=!jb||0>=jb.length?null:jb[jb.length-1],xb=!!Mb&&this.Msc(Mb)===this.Msc(ta);jb=xb&&Mb.ip.Zha.equals(ta.ip.Zha)&&Mb.user.equals(ta.user);this.Wji&&jb&&Mb.ip.shapeId&&ta.ip.shapeId&&Mb.ip.shapeId!==ta.ip.shapeId&&(jb=!1);return{returnValue:xb,u6l:jb}}eYm(ta){const jb=this.Eqk(ta);jb&&jb.ip.shapeId&&
(ta.ip.shapeId&&ta.ip.shapeId===jb.ip.shapeId||this.jog(jb.ip.paragraphId,jb,!1))}Eqk(ta){ta=this.l3a[ta.user.clientId];return!ta||0>=ta.length?null:ta[ta.length-1]}aOi(ta){const jb=this.l3a[ta];if(jb&&0<jb.length){const Mb=jb[0].ip.paragraphId,xb=this.Msc(jb[0]);delete this.l3a[ta];this.ijm(xb,ta);Mb.equals(kc.a.nil)||this.jog(Mb,jb[0],!1)}}IIf(ta){return this.jYc[ta]}Ted(ta,jb,Mb,xb=!1){const Nc=[],rc=this.IIf(ta);if(!rc)return Nc;for(let wd=0;wd<rc.length;wd++){const Fc=rc[wd],qe=this.l3a[Fc];
let Nf=!1;for(let mg=qe.length-1;0<=mg;mg--){const mi=qe[mg];if(xb){if(mi.Vga&&mi.ip.paragraphId.equals(kc.a.Ad(ta))){Nf=!0;Nc.push(mi);break}}else if(Object(he.a)(qf,mi)?mi.ip.qPa===jb:mi.ip.qPa===Mb){Nf=!0;mi.Oxc=!0;Nc.push(mi);this.l3a[Fc]=qe.splice(mg,qe.length);break}}!Nf&&0<qe.length&&qe[0].Oxc&&qe[0].ip.paragraphId.equals(kc.a.Ad(ta))&&Nc.push(qe[0])}return Nc}LMk(ta){if(!ta||!ta.xa||!ta.xa.node)return null;ta=this.Ted(ta.xa.node.id.toString(),0,0,!0);ta=this.f$k(ta);ta.sort((jb,Mb)=>{if(!(jb&&
jb.userName&&Mb&&Mb.userName))return m.ULS.sendTraceTag(542165082,302,15,"Missing presence user info for user in PresenceInfos"),0});return ta}f$k(ta){if(!ta||!ta.length)return[];const jb=[],Mb=new Ke.a(Ra.a.lf());for(let xb=0;xb<ta.length;xb++){const Nc=ta[xb].user;Nc.isAnonymous&&Mb.contains(Nc.clientId)||!Nc.isAnonymous&&Nc.email&&Mb.contains(Nc.email)||(jb.push(Nc),Mb.add(Nc.isAnonymous?Nc.clientId:Nc.email))}return jb}jog(ta,jb,Mb){this.raiseEvent("PPC",new gi(ta,jb,Mb))}ijm(ta,jb){Array.remove(this.jYc[ta],
jb)}}rk.bui=10;rk.iQl=2;Object(f.a)(rk,"PresenceDataManager",Aa.a,[1539]);class Ue extends rk{constructor(ta,jb){super();this.C4e=this.sah=!1;this.mx=ta;this.ua=jb}eff(ta,jb=!1){this.ua.isFeatureEnabled(202)&&this.ua.isFeatureEnabled(169)&&Object(he.a)(qf,ta)?this.sah||(this.sah=!0,m.ULS.sendTraceTag(7866380,302,15,"Presence packet received in old format")):(Object(he.a)(qf,ta)&&(this.C4e=!0),super.eff(ta,jb))}Msc(ta){return this.C4e?super.Msc(ta):ta.ip.yb.toString()}IIf(ta){if(this.C4e)return super.IIf(ta);
ta=this.mx.Ua(kc.a.Ad(ta));if(!ta)return null;ta=ta.ha(Cg.a.yb,0);return this.s1l[ta.toString()]}}Object(f.a)(Ue,"WordPresenceDataManager",rk,[]);var Tc=b(1095),Kj=b(1036),di=b(1546),rj=b(19);class Ag{constructor(ta,jb,Mb,xb,Nc,rc,wd,Fc,qe,Nf,mg,mi,Fg,Tj,lj,mj,bn,Ln,Jm,Re,tk,Cn,rl,pc){this.mVa=Array(5);this.ecf=this._started=this.q8e=!1;this.A4e=null;this.Sdh=new Ke.a(Ra.a.lf());this.RUd={};this.DXe=!1;this.Rv=ta;this.Ea=xb;this.tD=Nc;this.FNb=rc;this.vi=qe;this.Ksj=Nf;this.$ob=mg;this.pn=Mb;this.x1g=
mi;this.KSe=Fg;this.LSe=Tj;this.lmj=wd;this.Qsj=Fc;this.iUa=lj;this.Nh=mj;this.Ub=bn;this.Za=Ln;this.$jh=Cn;this.WGj=pc;this.B4e=Re;this.qa=tk;this.zUd=jb;Ag.uVd=new Pa.a;for(ta=0;ta<this.zUd.length;ta++)this.zUd[ta].Ogm(this);this.FNb.Pqh(Object(c.a)(this,this.EHi,"presenceOnParagraphChanged"));this.Rv.FVa(Object(c.a)(this,this.l0,"onPresenceUpdated"));rl&&this.vi.Rra(Object(c.a)(this,this.h1l,"pageViewScrolled"));this.Rv.Tve(this)}get ype(){return!!this.qa&&this.qa.$("PeoplesWellExtraButtonInfoIsEnabled")}h1l(){var ta;
this.ecf||this.vi.eR&&(null===(ta=this.vi.jKa)||void 0===ta?0:ta.Ooe)||(ta=new Na.a(0,1,20,()=>{const jb=new J.a;var Mb=this.$ob.zqk;for(var xb in Mb){const Nc=Mb[xb];Nc.pqd&&jb.add(Nc.qp.ip.paragraphId)}if(this.ype){Mb=this.$ob.JJh;for(const Nc in Mb)xb=Mb[Nc],xb.pqd&&!jb.contains(xb.qp.ip.paragraphId)&&jb.add(xb.qp.ip.paragraphId)}this.CWh(jb);this.ecf=!1},72),this.Za.Cb(ta),this.ecf=!0)}MAi(){this.q8e&&(this.yxg(),this.q8e=!1)}Bwe(ta=!1){this.$jh&&!ta||this.WOi()}WOi(){const ta=new J.a,jb=this.RUd;
for(const Mb in jb)ta.add(kc.a.Ad(Mb));this.CWh(ta);this.RUd={}}yxg(){this.Ea.Fa&&this.eVi(this.Ea.Fa.Pa,!0)}xna(ta,jb){this.eVi(jb.Ck.Pa)}eVi(ta,jb=!1){this.WGj||(this.pn.Hg.tX||jb?ta?(jb=this.dok(ta))?this.Rv.Fxg(jb):(this.Rv.Fxg(null),m.ULS.sendTraceTag(4281418,302,50,"Not supported selection context {0}",ta.xa.contextId)):this.Rv.Fxg(null):this.q8e=!0)}dok(ta){if(!this.ype||!ta.$Na)if(ta=rj.SelectionEditor.mk(ta,!0,!1),!rj.SelectionEditor.vm(ta))return null;return this.Glf(ta)}Glf(ta){const jb=
ta.xa.cpBegin,Mb=ta.xa.node.id;ta=this.KSe(ta.xa.node);return new Rj(Mb.toString(),jb,ta)}l0(ta,jb){ta=jb.yxa;for(var Mb in ta){const xb=ta[Mb];this.qa.$("CashTelemetryIsEnabled")&&this.ncd(xb,new Date,null);xb.ip?this.Zef(xb):this.Bzd(xb.user.clientId)}jb=jb.W8d;for(Mb=0;Mb<jb.length;++Mb)this.vtk(jb[Mb]);this.Bwe()}ncd(ta,jb,Mb){if(this.B4e)if(ta&&ta.user&&ta.user.clientId){var xb=ta.user.clientId;this.Sdh.contains(xb)||(this.A4e?(this.A4e.ncd(xb,jb,null,Ag.I4k(Mb||ta.user.client)),this.Sdh.add(xb)):
this.B4e.continueWith(()=>{this.A4e=this.B4e.result;this.ncd(ta,jb,Mb)}))}else m.ULS.sendTraceTag(42262876,302,15,"invalid presence")}F2k(ta){const jb=new J.a;for(let Mb=0;Mb<ta.length;Mb++)jb.add(this.X9k(ta[Mb]));return jb}Zef(ta){var jb=null;ta&&ta.user&&(jb=ta.user.client);ta=ta.clone();ta.user=this.tD.usi(ta.user.clientId)||ta.user;this.qa.$("CashTelemetryIsEnabled")&&this.ncd(ta,new Date,jb);ta.Gc()&&!ta.user.Ou()&&(jb=ta.user.clientId,Ag.uVd.La(jb)||this.y9h(jb),this.kZm(jb),ta.user.userName=
CommonUIStrings.l_AnonymousUserName);this.FNb.eff(ta,!1)}kZm(ta){let jb=!1;({value:jb}=Ag.uVd.tb(ta,jb,!1));jb||(Ag.uVd.W(ta,!0),m.ULS.sendTraceTag(17954774,302,50,'{ "ClientID" : "'+ta+'" , "Event" : "CreateAnonymousGrayPawn"}'))}y9h(){}Bzd(ta){this.FNb.aOi(ta)}vtk(ta){this.Bzd(ta);const jb=this.$ob.a1h(ta);jb&&(jb.pOi(Object(c.a)(this,this.egg,"onPresenceRendered")),jb.dispose());this.ype&&(ta=this.$ob.xWk(ta))&&(ta.pOi(Object(c.a)(this,this.egg,"onPresenceRendered")),ta.dispose())}Tcb(ta){if(12!==
ta.type)return new J.a;ta=this.FNb.Ted(ta.id.toString(),this.KSe(ta),this.LSe(ta));return 0>=ta.length?new J.a:this.F2k(ta)}egg(ta,jb){jb.paragraphId?this.tZm(jb.paragraphId.toString(),jb.JCl,this.RUd):m.ULS.shipAssertTag(8758481,302,!1,"null paraid")}tZm(ta,jb,Mb){!jb&&ta in Mb&&delete Mb[ta]}dispose(){this.stop();this.FNb.JOi(Object(c.a)(this,this.EHi,"presenceOnParagraphChanged"));this.Rv.E9b(Object(c.a)(this,this.l0,"onPresenceUpdated"));this.Rv.ILg(this);for(let ta=0;ta<this.zUd.length;ta++)this.zUd[ta].oVm(this);
Gg.a.bwg([this.lmj,this.Qsj,this.Rv]);this.$ob.Awk()}X9k(ta){let jb=!1;ta=({SFe:jb}=this.$ob.D2k(ta)).returnValue;jb||ta.NTj(Object(c.a)(this,this.egg,"onPresenceRendered"));return ta}T7h(ta){ta=this.pn.Ua(ta);if(!ta)return this.mVa[0]||(m.ULS.sendTraceTag(4281420,302,50,"Could not find the node in object space"),this.mVa[0]=!0),null;if(!zc.ParagraphReader.Hb(ta))return this.mVa[1]||(m.ULS.sendTraceTag(4281421,302,50,"Not a paragraph node"),this.mVa[1]=!0),null;if(!ta.zd(this.vi.eb))return this.mVa[2]||
(m.ULS.sendTraceTag(4281422,302,50,"No ViewElement found for this node"),this.mVa[2]=!0),null;if(!ta.anchor)return this.mVa[3]||(m.ULS.sendTraceTag(4281423,302,50,"node is not anchored"),this.mVa[3]=!0),null;this.mVa[4]||(m.ULS.sendTraceTag(4564931,302,50,"Valid paragraph node found for rendering ip"),this.mVa[4]=!0);return ta}INi(ta){ta=this.FNb.Ted(ta.toString(),-1,-1,!0);if(!Id.a.Wd(ta))for(const jb of ta)(ta=this.$ob.a1h(jb.user.clientId))&&ta.element&&ta.pE(ta.element.parentNode)}CWh(ta){if(ta.count){var jb=
new J.a;for(var Mb of ta)(ta=this.T7h(Mb))?jb.add(ta):this.INi(Mb);if(jb.count){Mb=this.Ub.tc(2);try{Mb.set(this.Nh);for(const xb of jb)this.kNh(xb)}finally{Mb&&Mb.dispose()}}}}kNh(ta){ta.dE(this.vi.eb,32,!0);ta.dE(this.Ksj,32,!0)}srm(ta){this.RUd[ta.toString()]=null;this.$jh&&!this.DXe&&(ta=new Na.a(0,1,200,()=>{this.DXe=!1;this.WOi()},70),this.Za.Cb(ta),this.DXe=!0)}EHi(ta,jb){jb.paragraphId&&(ta=this.pn.Ua(jb.paragraphId))&&((Object(he.a)(qf,jb.presence)?this.KSe(ta):this.LSe(ta))===jb.presence.ip.qPa&&
this.srm(jb.paragraphId),this.ype&&this.v6l(jb))}v6l(ta){if(ta.presence.ip.shapeId&&!ta.YXf){var jb=this.$ob.JJh[ta.presence.ip.shapeId.toString()];jb&&jb.cib(ta.presence.user.clientId)}}stop(){this._started&&(this._started=!1,this.Ea.yDa(Object(c.a)(this,this.xna,"onSetSelectionFinished")),this.x1g.xwe(Object(c.a)(this,this.MAi,"onGraphOutboundReplication")))}start(){if(!this._started){this._started=!0;this.Ea.pC(Object(c.a)(this,this.xna,"onSetSelectionFinished"));this.x1g.l1d(Object(c.a)(this,
this.MAi,"onGraphOutboundReplication"));var ta=this.Rv.GXb();delete ta[this.iUa.clientId];this.l0(null,new di.a(ta,[]));this.yxg()}}nBe(ta){if(ta&&ta.Gc()&&ta.ip){var jb=this.FNb.Ted(ta.ip.paragraphId.toString(),-1,-1),Mb=!1,xb=null;for(let Nc=0;Nc<jb.length;Nc++)if(xb=jb[Nc],xb.user.clientId===ta.user.clientId){Mb=xb.v1a=!0;break}if(Mb)if(jb=xb.ip.paragraphId,ta=this.T7h(jb)){jb=this.Ub.tc(2);try{jb.Va(ta),this.kNh(ta)}finally{jb&&jb.dispose()}}else this.INi(jb)}}static I4k(ta){return ta?ta?1===
ta?1:2===ta?2:0:2:0}}Ag.uVd=null;Object(f.a)(Ag,"PresenceManager",null,[1535,12,814,1536,1537,1538]);class Sj{constructor(ta,jb,Mb,xb){this.Lfc=null;this._started=this.gWe=!1;this.iQb=null;this.Ai=xb;this.Ea=jb;this.wOe=ta;this.Vj=Mb;this.Ai.Tve(this)}start(){this._started||(this._started=!0,this.iQb={},this.wOe.Pqh(Object(c.a)(this,this.ZBi,"onPresenceOnParagraphChanged")),this.Ea.pC(Object(c.a)(this,this.Kva,"onProcessSetSelectionFinished")),this.mbj(this.Ea.Fa))}stop(){this._started&&(this._started=
!1,this.iQb=null,this.wOe.JOi(Object(c.a)(this,this.ZBi,"onPresenceOnParagraphChanged")),this.Ea.yDa(Object(c.a)(this,this.Kva,"onProcessSetSelectionFinished")))}Kva(ta,jb){if(!v.AFrameworkApplication.gi&&(ta=this.mbj(jb.Ck),this.Lfc&&ta)){ta=this.wOe.Ted(this.Lfc.toString(),-1,-1,!0);for(jb=0;jb<ta.length;jb++)this.iQb[ta[jb].user.clientId]=ta[jb];0>=ta.length||(ta=this.ylk(ta),this.Vj.sendNotification(ta,!0))}}ylk(ta){if(1===ta.length)return String.format(Box4Intl.Box4Strings.l_OtherUsersEditingParagraphSingle,
ta[0].user.userName);const jb=[],Mb=ta.length;for(let xb=0;xb<Mb;xb++)jb.push(ta[xb].user.userName);return String.format(Box4Intl.Box4Strings.l_OtherUsersEditingParagraphMany,jb.join(Box4Intl.Box4Strings.l_DisplayNameSeparator))}ZBi(ta,jb){this.Ea.Fa&&!v.AFrameworkApplication.gi&&this.gWe&&this.Lfc&&this.Lfc.equals(jb.paragraphId)&&(ta=null,!jb.YXf||jb.presence.user.clientId in this.iQb?jb.YXf||(ta=this.JIh(jb.presence.user.userName,!1),delete this.iQb[jb.presence.user.clientId]):(ta=this.JIh(jb.presence.user.userName,
!0),this.iQb[jb.presence.user.clientId]=jb.presence),ta&&this.Vj.sendNotification(ta,!0))}JIh(ta,jb){return String.format(jb?Box4Intl.Box4Strings.l_UserJoiningParagraph:Box4Intl.Box4Strings.l_UserLeavingParagraph,ta)}dispose(){this.Ai.ILg(this);this.stop()}mbj(ta){if(!ta)return!1;ta=ta.Pa;if(!ta)return!1;ta=ta.xa;if(!ta)return!1;this.gWe=rj.SelectionEditor.He(ta);ta=ta.node.id;if(ta.equals(this.Lfc)||!this.gWe)return!1;this.Lfc=ta;this.iQb={};return!0}}Object(f.a)(Sj,"PresenceAccessibilityManager",
null,[12,814]);class fg{constructor(ta,jb){this._started=!1;this.JE=null;this.OQd=!1;this.Ai=ta;jb&&(this.JE=jb,this.JE.m6(Object(c.a)(this,this.jud,"onEditorsTableUpdated")));this.Ai.Tve(this)}start(){this._started||(this._started=!0,this.JE?this.QUi():this.Ai.GR(1,this.NHh()))}jud(){this._started&&this.QUi()}QUi(){const ta=this.OQd;(this.OQd=!!this.JE.Il)&&!ta&&this.Ai.GR(1,this.NHh())}NHh(){const ta={};ta.Id="{"+v.AFrameworkApplication.userSessionId.toUpperCase()+"}";ta.HQ=!1;ta.NT=1;ta.WEB=!0;
return ta}stop(){this._started&&(this._started=this.OQd=!1)}dispose(){this.Ai.ILg(this);this.JE&&this.JE.dsg(Object(c.a)(this,this.jud,"onEditorsTableUpdated"))}}Object(f.a)(fg,"EditorsTableNotifier",null,[12,814]);var Bl=b(352),fe=b(27);class ac extends Ag{constructor(ta,jb,Mb,xb,Nc,rc,wd,Fc,qe,Nf,mg,mi,Fg,Tj,lj,mj,bn,Ln,Jm,Re,tk,Cn,rl,pc,qh,Jf,kg,sj,Kl,tf){super(ta,jb,Mb,xb,Nc,rc,wd,Fc,qe,Nf,mg,Fg,Tj,lj,mj,Jm,Re,tk,Cn,rl,pc,qh,Jf,Kl);this.Se=null;mi.Ia(fe.a.v1i,pb.a.application,ac.XRj,64);mi.Ia(fe.a.kwe,
pb.a.application,ac.kwe,64);mi.Ia(fe.a.Fue,pb.a.application,ac.Fue,96);mi.Ia(ub.a.nBe,pb.a.application,ac.xHm,64);this.lG=bn;this.Bc=Ln;this.FQb=kg;this.iUa.nAc=sj;this.iUa.nAc.yVj(ac.$Bi);tf.continueWith(()=>{this.Se=tf.result});m.ULS.sendTraceTag(4006600,302,50,"WordPresenceManager Initialized")}get Qa(){return ka.a.instance.resolve("Box4.IFeatureHelper")}r7(ta){if(!ta||!ta.anchor)return null;for(ta=ta.anchor.ps;ta;ta=ta.xA)if(ta.cCa)return ta.Bs.node;return null}Glf(ta){var jb=null;jb=v.AFrameworkApplication.K.$("PeoplesWellExtraButtonInfoIsEnabled");
if(this.Qa.isFeatureEnabled(202)&&this.Qa.isFeatureEnabled(169)){var Mb=ta.xa.cpBegin,xb=ta.xa.node;jb&&fj.ImageReader.Qw(xb)&&(xb=this.r7(xb));if(!xb)return m.ULS.sendTraceTag(51242309,302,15,"selectedNode is null"),null;xb=this.LSe(xb);const rc=ta.xa.node.ha(Cg.a.yb,0);if(!this.lG)return m.ULS.sendTraceTag(35997152,302,15,"paragraphWordIdMapping is null"),null;var Nc=this.lG.value.hMa(rc);const wd=ac.mx.Ua(Nc);if(!wd)return m.ULS.sendTraceTag(16791249,302,15,"Can't find pid "+Nc),null;Mb=this.Bc.$Hc(this.Bc.oPa(wd.characterData,
wd.ka),Mb);Mb.r2=-1===ta.xa.gb?0:ta.xa.gb;Nc=0;jb&&ta.$Na&&(Nc=this.b6k(ta));jb=new uc(this.lG.value,rc,xb,Mb,this.Bc,()=>ac.mx,this.FQb,Nc)}else jb=super.Glf(ta);return jb}b6k(ta){const jb=fj.ImageReader.pBa(ta.xa);return jb?jb.properties.ha(Cg.a.mqc,0):ta.xa.node.properties.ha(Cg.a.mqc,0)}y9h(ta){this.Se&&this.Se.cK&&this.Se.cK.dr(Object(c.a)(this,this.bzk,"editorsReplicatorSucceededCallback"),Object(c.a)(this,this.azk,"editorsReplicatorFailedCallback"),ta)}bzk(ta){const jb=!!this.Se.Eo.HXa(ta);
m.ULS.sendTraceTag(579179741,302,50,"ClientId:{0} isPresentAfterPoll:{1}",ta,jb)}azk(ta,jb){m.ULS.sendTraceTag(579179742,302,15,"EditorsReplicator failed with {0} when looking for ClientId {1}",jb,ta)}static get wx(){return ka.a.instance.resolve("Common.Utils.IAriaNotifier")}static mK(){return ac.WSc.task}static get_instance(){return ac.tVd.task}static K2k(){return ac.wdh.task}static get S0a(){return ac.Bpb||(ac.Bpb=ka.a.instance.resolve("Box4.Presence.IRtcProxyProvider"))}static init(){ac.tVd||(ac.tVd=
new w.a);ac.k0g&&(m.ULS.sendTraceTag(4256585,302,50,"WordPresenceManager Init"),ac.k0g=!1);if(mb.App.na){var ta=mb.App.na.Aa;ta?(ta.Q$(ac.Qtd),ac.tNb=ta.hc,ac.tNb&&ac.tNb.vj?(ac.yP=ta.Nb.contentReplicator,ac.yP?(ac.mx=ta.Nb.wc,ac.mx?ac.S0a.mK().continueWith(ac.VXl):m.ULS.sendTraceTag(4006599,302,15,"Can't initialize the WordPresenceManager because we can't get a reference to content ObjectSpace of the app")):m.ULS.sendTraceTag(4252228,302,15,"Can't initialize the WordPresenceManager because we can't get a reference to the GraphSpaceReplicator object")):
m.ULS.sendTraceTag(4006598,302,50,"PageView doesn't seem to have been initialized yet. Will try again once we know it's initialized")):m.ULS.sendTraceTag(4006597,302,15,"Can't initialize the WordPresenceManager because workspace is not initialized")}else m.ULS.sendTraceTag(4006596,302,15,"Can't initialize the WordPresenceManager because active AppFrame is not initialized")}static VXl(){ac.Ai=ac.S0a.mK().result;if(ac.Ai){var ta=[ac.tNb.Czc,ac.tNb.editingView.Czc],jb=kb.a.instance,Mb=ka.a.instance.resolve("Box4.Presence.WordPresenceDataManager"),
xb=new Sj(Mb,jb,ac.wx,ac.Ai),Nc=v.AFrameworkApplication.K.$("DoNotAddToEditorsTableOnFrameIsEnabled")?mb.App.Lb.Eo:null;Nc=new fg(ac.Ai,Nc);var rc=ka.a.instance.Rd("WordEditor.IParagraphWordIdMapping"),wd=ka.a.instance.resolve("WordEditor.WordTextOffsetTranslator.IWordTextOffsetTranslator"),Fc=ka.a.instance.resolve("Common.IPeopleInfoProvider");ac.ra=new ac(ac.Ai,ta,ac.mx,jb,Fc,Mb,xb,Nc,ac.tNb,ac.tNb.editingView.eb,ka.a.instance.resolve("Box4.Presence.PresenceControlProvider"),v.AFrameworkApplication.pa,
ac.yP,zc.ParagraphReader.textLength,zc.ParagraphReader.hta,ka.a.instance.resolve("Box4.Presence.MyPresenceUser"),rc,wd,mb.App.Yh.Bj,new Bl.a,$a.a.instance,Tc.a.get_instance(),oa.a.Wp(ka.a.instance.Da("Common.App.CoauthTelemetry.IPresenceBootTelemetry")),v.AFrameworkApplication.K,v.AFrameworkApplication.K.$("Box4ThrottleAndBatchPresenceRendering"),v.AFrameworkApplication.K.$("Box4DoNotRenderPresenceOutOfView"),ka.a.instance.resolve("WordEditor.Presence.IWordPresenceCpFactory"),ka.a.instance.resolve("Common.IPresenceStatusProvider"),
!mb.App.Aq&&!mb.App.Uk,mb.App.ema());m.ULS.sendTraceTag(23196878,302,50,"WordPresenceManager instance created");ac.tVd.Ue(ac.ra);ac.WSc.Ue(ac.ra);ac.wdh.Ue(ac.ra);ta=ka.a.instance;ta.ia("WordEditor.Presence.WordPresenceManager",()=>ac.ra).as("Common.IPresenceRemover").as("Common.IPresenceSender").fa();ta.resolve("WordEditor.Presence.WordPresenceManager")}else m.ULS.sendTraceTag(4203468,302,15,"Can't initialize the WordPresenceManager because can't get a handle to RtcProxy")}static Qtd(ta){ac.ra||
(m.ULS.sendTraceTag(4006601,302,50,"WordPresenceManager.OnAppIsInteractive: Trying to initialize again"),(ta=Object(z.a)(17,ta))&&ta.A0a(ac.Qtd),ac.init())}static $Bi(){ac.ra.yxg()}static XRj(ta,jb,Mb,xb,Nc){Mb=Nc.split(",");if(!Mb||3!==Mb.length)return 8;ta=Mb[0].trim();jb=Mb[1].trim();Mb=Number.parseInvariant(Mb[2].trim());ta=new qf(new ya(ta),new Rj(jb,Mb,-1));if(!ac.WSc.task.isCompleted)return 8;jb=ac.mK().result;jb.Zef(ta);jb.Bwe();return 32}static kwe(ta,jb,Mb,xb,Nc){if(!ac.WSc.task.isCompleted)return 8;
ta=ac.mK().result;ta.Bzd(Nc);ta.Bwe();return 32}static xHm(ta,jb,Mb,xb,Nc){if(!ac.WSc.task.isCompleted)return 8;ta=ac.mK().result;if(!ta)return 8;ta.nBe(Nc);return 32}static Fue(ta,jb,Mb,xb,Nc){if(1===Mb)return 32;if(!ac.S0a.mK().isCompleted)return 8;ta=ac.S0a.mK().result;if(!ta)return m.ULS.sendTraceTag(4301136,302,10,"rtcProxy is null when trying to display RTC connection status"),8;Nc[Kj.a.Value]=2===ta.connectionState?WordEditorIntl.WordEditorStrings.L_RtcConnected:1===ta.connectionState?WordEditorIntl.WordEditorStrings.L_RtcConnecting:
"";return 32}}ac.ra=null;ac.k0g=!0;ac.tVd=new w.a;ac.WSc=new w.a;ac.wdh=new w.a;ac.mx=null;ac.tNb=null;ac.yP=null;ac.Ai=null;ac.Bpb=null;Object(f.a)(ac,"WordPresenceManager",Ag,[]);class bh{constructor(ta){this.la=new Aa.a;this.IY=ta;this.IY.CWR(()=>this.IY.result.PTj(()=>{this.la.raiseEvent("X")}))}yVj(ta){this.la.addHandler("X",ta)}Okm(ta){this.la.removeHandler("X",ta)}getStatus(){return this.IY.isCompleted&&this.IY.result?this.IY.result.GUb.toString():"0"}}Object(f.a)(bh,"WordPresenceStatusProvider",
null,[857]);class Ae{constructor(ta,jb,Mb,xb){this.Ai=null;this.f0g=this.E_e=!1;this.Se=ta;this.oS=jb;this.nka=Mb;Mb.continueWith(Object(c.a)(this,this.WXl,"onRtcReady"));this.fCj=xb;this.fCj.J5f=this.oS}WXl(){this.nka.isCompleted&&this.nka.result?(this.Ai=this.nka.result,this.Ai.FVa(Object(c.a)(this,this.l0,"onPresenceUpdated")),m.ULS.sendTraceTag(5604372,302,50,"Presence Update Monitor is ready.")):m.ULS.sendTraceTag(5604373,302,15,"RtcTask did not complete successfully. No monitoring")}l0(ta,jb){ta=
jb.yxa;for(const Mb in ta)if(jb=ta[Mb],!this.E_e&&jb.user.lR&&jb.user.lR!==this.oS.lR){m.ULS.sendTraceTag(5604375,302,15,"Presence received from different local cobalt session Mine:{0} Theirs:{1}",this.oS.lR,jb.user.lR);this.E_e=!0;break}this.E_e&&this.Ai.E9b(Object(c.a)(this,this.l0,"onPresenceUpdated"));this.f0g||(m.ULS.sendTraceTag(5604374,302,50,"First presence received"),this.f0g=!0)}}Object(f.a)(Ae,"WordPresenceUpdateMonitor",null,[]);var Bk=b(443),ze=b(1180),Nh=b(184),Eg=b(1548),Oh=b(1549);
class Dd{constructor(ta,jb,Mb,xb,Nc,rc,wd){this.la=new Aa.a;this.W4g=this.o6g=this.CYe=this.v8g=!1;this.hcf=this.p_d=0;this.Mlc=null;this.iUa=rc;this.iUa.clientId=ta.clientId;this.Np=ta;this.cda=jb;this.kS=xb;this.Nuj=Nc;this.Za=Mb;this.Dmb=new Nh.a;this.Dm=wd;this.cda&&this.cda.continueWith(()=>{this.cda.Rm||this.cda.Dg||this.cda.result.d1d(Object(c.a)(this,this.czi,"onAmIAloneChanged"))})}get connectionState(){return this.Np.connectionState}FVa(ta){this.la.addHandler("PU",ta)}E9b(ta){this.la.removeHandler("PU",
ta)}Zza(ta){this.la.addHandler("CSC",ta)}Fzd(ta){this.la.removeHandler("CSC",ta)}p1d(ta){this.la.addHandler("PSU",ta)}Awe(ta){this.la.removeHandler("PSU",ta)}o1d(ta){this.la.addHandler("PSC",ta)}zwe(ta){this.la.removeHandler("PSC",ta)}ZUi(){}get clientId(){return this.Np.clientId}n6(ta){this.la.addHandler("UN",ta)}kCc(ta){this.la.removeHandler("UN",ta)}Cjl(){this.Mlc=Array(12);for(let ta=0;12>ta;ta++)this.Mlc[ta]=0;this.o6g=this.Dm?this.Dm.$("UpdateNotificationTaskExperimentIsEnabled"):!0;v.AFrameworkApplication.cL(()=>
{this.kHl()})}init(){this.Np.Zza(Object(c.a)(this,this.sna,"onConnectionStateChanged"));this.Np.FVa(Object(c.a)(this,this.l0,"onPresenceUpdated"));this.Np.p1d(Object(c.a)(this,this.V6b,"onPersistentStateUpdated"));this.Np.o1d(Object(c.a)(this,this.czc,"onPersistentStateCleared"));this.Np.n6(Object(c.a)(this,this.C8,"onUpdateNotificationReceived"));this.bFh();this.Cjl()}Tve(ta){this.Dmb.contains(ta,(jb,Mb)=>jb===Mb)||(this.Dmb.add(ta),2===this.connectionState&&ta.start())}ILg(ta){for(let jb=0;jb<this.Dmb.length;jb++)if(this.Dmb.J(jb)===
ta){this.Dmb.hA(jb);break}}connect(){this.CYe||this.Np.connect()}disconnect(){this.Np.disconnect()}get Qxe(){return this.Np}GLh(ta){return qf.eUb(ta)}Xxg(ta,jb){return(new qf(ta,jb)).aPf()}Fxg(ta){ta&&ta.Gc()&&!this.kS()?this.Np.ZUi(this.Xxg(this.iUa.SZk(),ta)):S.Task.s_(null)}EBd(ta,jb){return this.Np.EBd(ta,jb)}GHf(ta){return this.Np.GHf(ta)}Ued(){return this.Np.Ued()}GR(ta,jb,Mb=!1){return this.Np.GR(ta,jb,Mb)}GXb(){return this.HHh(this.Np.GXb())}edc(){return S.Task.s_(null)}get $zb(){return this.Np.$zb}sna(ta,
jb){2===jb.newState&&this.Dmb.forEach(Mb=>{Mb.start();return!0});jb.newState||this.Dm.$("SendRTCMessagesWhileDisconnectedIsEnabled")&&!this.CYe||this.Dmb.forEach(Mb=>{Mb.stop();return!0});this.la.raiseEvent("CSC",jb)}nFf(ta){return ta.toLowerCase()}l0(ta,jb){if(!this.kS()){ta=this.HHh(jb.yxa);jb=this.KHh(jb.W8d);var Mb=new di.a(ta,jb);jb=new Na.a(0,1,0,()=>{this.la.raiseEvent("PU",Mb)},57);this.Za.Cb(jb)}}HHh(ta){const jb={};for(const xb in ta){var Mb=xb;const Nc=this.GLh(ta[xb]);Nc&&Nc.Gc()?jb[this.nFf(Mb)]=
Nc:m.ULS.sendTraceTag(562661590,302,50,"No Valid User {0}",Mb)}return jb}KHh(ta){const jb=Array(ta.length);for(let Mb=0;Mb<ta.length;Mb++)jb[Mb]=this.nFf(ta[Mb]);return jb}V6b(ta,jb){if(!this.kS()){var Mb={};ta=jb.yxa;for(var xb in ta)Mb[this.nFf(xb)]=ta[xb];xb=new Na.a(0,1,0,()=>{this.la.raiseEvent("PSU",new Eg.a(jb.type,Mb))},80);this.Za.Cb(xb)}}czc(ta,jb){if(!this.kS()){ta=this.KHh(jb.e5d);var Mb=new Oh.a(ta);ta=new Na.a(0,1,0,()=>{this.la.raiseEvent("PSC",Mb)},81);this.Za.Cb(ta)}}C8(ta,jb){this.o6g?
this.vDi(jb):(ta=new Na.a(0,1,0,()=>{this.vDi(jb)},58),this.Za.Cb(ta))}vDi(ta){var jb=Date.now();this.la.raiseEvent("UN",ta);jb=Date.now()-jb;500<=jb&&(this.p_d++,m.ULS.sendTraceTag(42563487,302,15,"Update Notification Heuristics: UpdateNotification Type {0} took {1} ms",ta.type,jb),this.JGk(ta));this.hcf++}JGk(ta){0>ta.type||21<=ta.type?m.ULS.sendTraceTag(42541602,302,15,"Update Notification Heuristics: UpdateNotification Type out of range {0}",ta.type):this.Mlc[ta.type]++}kHl(){if(!this.W4g){var ta=
{};ta.TC=this.hcf;ta.HRC=this.p_d;this.Mlc&&0<this.p_d&&(ta.TBC=this.Mlc);this.p_d=this.hcf=0;this.Mlc=null;m.ULS.sendTraceTag(42541603,302,50,"UpdateNotificationHeuristics: {0}",ta);this.W4g=!0}}dispose(){this.Dmb=new Nh.a;this.Np.Fzd(Object(c.a)(this,this.sna,"onConnectionStateChanged"));this.Np.E9b(Object(c.a)(this,this.l0,"onPresenceUpdated"));this.Np.Awe(Object(c.a)(this,this.V6b,"onPersistentStateUpdated"));this.Np.zwe(Object(c.a)(this,this.czc,"onPersistentStateCleared"));this.Np.kCc(Object(c.a)(this,
this.C8,"onUpdateNotificationReceived"));this.cda&&this.cda.continueWith(()=>{this.cda.Rm||this.cda.Dg||this.cda.result.oOi(Object(c.a)(this,this.czi,"onAmIAloneChanged"))});this.Np.disconnect();m.ULS.sendTraceTag(4564935,302,50,"Disposing of rtcProxyCompleted")}czi(){this.bFh()}bFh(){let ta=!1;this.cda?this.cda.continueWith(()=>{this.cda.Rm||this.cda.Dg||(ta=!this.cda.result.amIAlone);this.Np.connectionState||!ta&&!this.Nuj()?2!==this.Np.connectionState||ta||(this.disconnect(),m.ULS.sendTraceTag(4564937,
302,50,"Disconnecting because there are no other users in the doc")):(this.connect(),m.ULS.sendTraceTag(4564936,302,15,"Connecting because there are other authors in the doc"));!this.v8g&&ta&&(m.ULS.sendTraceTag(4203466,302,50,"There are other real-time authors in this session"),this.v8g=!0)}):(this.connect(),m.ULS.sendTraceTag(589321547,302,50,"Connecting to rtc because Rtc Always On is enabled"))}Vab(){this.CYe=!0;this.disconnect();m.ULS.sendTraceTag(4564938,302,50,"DisconnectForever")}}Object(f.a)(Dd,
"RtcProxy",null,[1521,12,987,1522]);class sg extends Dd{constructor(ta,jb,Mb,xb,Nc,rc,wd,Fc,qe,Nf,mg,mi,Fg){super(ta,jb,Mb,xb,Nc,rc,Fg);this.bI=null;this.lG=wd;this.Bc=Fc;this.nUa=qe;this.VXc=Nf;this.Z9e=mg;this.FQb=mi}get Oz(){return this.bI||(this.bI=this.Z9e())}sna(ta,jb){2===jb.newState&&m.ULS.sendTraceTag(4315102,302,50,"RTC Connected");this.GZm();super.sna(ta,jb)}GZm(){this.Oz&&this.Oz.uM("RtcConnectionStatusLabel")}GLh(ta){return yc.kuf(ce(ta),this.lG,this.Bc,this.nUa,this.FQb)}Xxg(ta,jb){return Object(he.a)(uc,
jb)?(ta=new yc(this.VXc.h2h(),ta,jb),Ec(ta.aPf())):super.Xxg(ta,jb)}}Object(f.a)(sg,"WordRtcProxy",Dd,[]);class hk{constructor(ta,jb,Mb,xb,Nc,rc,wd,Fc,qe,Nf,mg,mi,Fg){this.wq=new w.a;this.Lhh=!0;this.uUg=ta;this.Jc=jb;this.Za=Mb;this.kS=xb;this.iUa=Nc;this.lG=rc;this.Mea=wd;this.nUa=Fc;this.VXc=qe;this.Z9e=Nf;this.W5=mg;this.FQb=mi;this.qa=Fg}mK(){this.vSm();return this.wq.task}Ugd(){return Bk.a.then(this.mK(),ta=>ta)}vSm(){if(this.Lhh)if(this.Lhh=!1,mb.App.Qod()&&mb.App.U_f()){var ta=v.AFrameworkApplication.je;
if(ta){ta=ze.RealtimeChannel.createInstance("{"+v.AFrameworkApplication.userSessionId+"}",v.AFrameworkApplication.userSessionId,v.AFrameworkApplication.qSi,ta,this.W5,1,this.Jc,this.qa.Oa("RtcEndpointUrl"),void 0,void 0,null,this.qa.$("FindSessionOnBootIsEnabled")?ka.a.instance.resolve("Common.IFindSessionUtils"):null,this.qa.Oa("RtcBootToken"));var jb=this.qa.$("RtcAlwaysOnEnabled"),Mb=new sg(ta,jb?null:mb.App.ema(),this.Za,this.kS,hk.nJk,this.iUa,this.lG,this.Mea,this.nUa,this.VXc,this.Z9e,this.FQb,
v.AFrameworkApplication.K);mb.App.xzm(Mb);this.Hgm(Mb);Mb.init();me.App.S3=Mb;this.W5.execute(xb=>{xb.A9a(()=>{Mb.Vab()})});this.wq.Ue(Mb)}else m.ULS.sendTraceTag(8206365,302,15,"Can't initialize the RtcProxy because ClientRequestManager is null")}else m.ULS.sendTraceTag(8206362,302,10,"Can't initialize the RtcProxy because dependent scripts are not loaded")}Hgm(ta){const jb=ka.a.instance;jb.ia("WordEditor.Presence.WordRtcProxy",()=>ta).as("Box4.Presence.IRtcProxy").as("Common.IRealtimeChannelBasic").fa();
jb.resolve("Common.IRealtimeChannelBasic")}static nJk(){return!1}}Object(f.a)(hk,"WordRtcProxyProvider",null,[848,849]);class Af{constructor(){this.Z=null;this.Fi=!1}get name(){return"WordEditor.Presence"}init(){m.ULS.sendTraceTag(50995799,302,50,"PresencePackage Init");mb.App.Zej&&(this.Z.resolve("WordEditor.Presence.WordRtcProxyProvider").mK(),ac.init(),this.Z.resolve("WordEditor.Presence.WordPresenceUpdateMonitor"));mb.App.nsb&&Dg.init();this.Z.resolve("Common.App.Presence.AwayManager");this.Z.resolve("Common.IPeopleInfoProvider")}dispose(){if(!this.Fi){this.Fi=
!0;ac.mK().continueWith(()=>{Gg.a.OB(ac.mK().result)});var ta=this.Z.resolve("Box4.Presence.MyPresenceUser");ta&&ta.nAc&&ta.nAc.Okm(ac.$Bi)}}Mb(ta){this.Z=ta;this.Z.ia("Box4.Presence.MyPresenceUser",()=>new va).as("Box4.Presence.IMyPresenceUser").as("Common.IPresenceUser").as("Common.IPresenceConverter").fa();ta.ia("WordEditor.Presence.IWordPresenceCpFactory",()=>new ti(ta.resolve("Box4.CharacterPointConverter"),ta.resolve("Box4.IContentControlReader"))).fa();ta.ia("WordEditor.Presence.WordPresenceUpdateMonitor",
()=>new Ae(new M.a(()=>mb.App.Lb),Bj.a.instance,ta.resolve("WordEditor.Presence.WordRtcProxyProvider").Ugd(),ta.resolve("Box4.Presence.IMyPresenceUser"))).fa();ta.ia("WordEditor.Presence.WordRtcProxyProvider",()=>new hk(v.AFrameworkApplication.buildVersion,mb.App.na.$o,$a.a.instance,()=>v.AFrameworkApplication.gi,ka.a.instance.resolve("Box4.Presence.IMyPresenceUser"),ka.a.instance.sa("WordEditor.ParagraphWordIdMapping"),ka.a.instance.resolve("WordEditor.WordTextOffsetTranslator.IWordTextOffsetTranslator"),
()=>v.AFrameworkApplication.oa&&mb.App.na.Aa&&mb.App.na.Aa.Nb?mb.App.na.Aa.Nb.wc:null,pk.instance,()=>ka.a.instance.sa("WordEditor.IStatusBarUser"),ka.a.instance.Da("Common.ISessionExpirationManager"),ka.a.instance.resolve("WordEditor.Presence.IWordPresenceCpFactory"),v.AFrameworkApplication.K)).fa().as("Box4.Presence.IRtcProxyProvider").as("Common.Interface.IRtcBasicProvider");ta.ia("Box4.Presence.PresenceControlProvider",()=>new te(Af.Cpk(),Kg.a.instance,ka.a.instance.Da("Common.IZoomManager"),
ka.a.instance.resolve("Box4.ICoauthCashTelemetry"),oa.a.Wp(ka.a.instance.Da("Common.ISystemInitiatedFeedbackWithTimeLapse")),v.AFrameworkApplication.K,ta.resolve("Common.IPeopleInfoProvider"))).fa();ta.ia("Common.App.Presence.AwayManager",()=>new bf(ka.a.instance.resolve("Common.IPresenceUser"),ka.a.instance.resolve("WordEditor.Presence.WordRtcProxyProvider").Ugd(),ac.K2k(),ka.a.instance.resolve("Common.IPresenceConverter"),$a.a.instance,v.AFrameworkApplication.K.$("AwayStatusOneMinuteTimeoutIsEnabled")?
6E4:v.AFrameworkApplication.K.vb("AwayCoauthorThresholdMs",9E5),Object(c.a)(v.AFrameworkApplication.pa,v.AFrameworkApplication.pa.processAction,"processAction"),mb.App.na.notificationBar,v.AFrameworkApplication.K.$("PeoplesWellExtraButtonInfoIsEnabled"))).fa();ta.ia("WordEditor.Presence.WordPresenceStatusProvider",()=>new bh(oa.a.Wp(ka.a.instance.Da("Common.ICurrentPageCalculator")))).as("Common.IPresenceStatusProvider").fa();ta.ia("Common.App.Presence.PeopleInfoProvider",()=>new Rf(ta.resolve("WordEditor.Presence.WordRtcProxyProvider").Ugd(),
mb.App.ema().CWR(()=>mb.App.ema().result.Eo),ta.resolve("Common.App.People.IPeopleColorUtils"),ta.resolve("Common.IPresenceConverter"),oa.a.Wp(ta.Da("Common.App.Presence.AwayManager")))).as("Common.IPeopleInfoProvider").fa();ta.ia("Box4.Presence.WordPresenceDataManager",()=>new Ue(mb.App.na.Aa.Nb.wc,ka.a.instance.resolve("Box4.IFeatureHelper"))).as("Box4.IPresenceDataManager").fa()}static get gEi(){!Af.U2e&&mb.App.na&&mb.App.na.Gv&&(Af.U2e=me.App.tk.Gv.getElementsByClassName("OutlineContainerDisplayWrapper")[0]);
return Af.U2e}static Cpk(){const ta=v.AFrameworkApplication.K.$("PeoplesWellExtraButtonInfoIsEnabled"),jb=new yb;jb.add(0,Yf.getImageClassWithCluster(v.AFrameworkApplication.O_,"MoreUsersGlyph16"));jb.add(5,v.AFrameworkApplication.Sp);jb.add(1,Yf.getImageClassWithCluster(v.AFrameworkApplication.O_,ta?"DoughboyWhiteGlyph_20x20x32":"SingleCollabUserGlyph16"));jb.add(4,v.AFrameworkApplication.Sp);jb.add(12,1);jb.add(8,v.AFrameworkApplication.isRtl);jb.add(16,Af.C$k);return ta?new Zi(jb):new Uf(jb)}static C$k(){return Af.gEi?
mf.a.getElementBounds(Af.gEi):null}}Af.U2e=null;Object(f.a)(Af,"WordPresencePackage",null,[1,2]);var le=b(128);class Cl{constructor(ta,jb){this.bff=ta;this.paragraphId=jb}get opType(){return 2}get operation(){return this.bff}}Object(f.a)(Cl,"RttAppliedAddParagraphOp",null,[853]);class Ph{constructor(ta,jb){this.fmm=ta;this.paragraphId=jb}get opType(){return 6}get operation(){return this.fmm}}Object(f.a)(Ph,"RttAppliedReplaceSymbolRangeOp",null,[853]);class mn{constructor(ta,jb){this.imm=ta;this.paragraphId=
jb}get opType(){return 1}get operation(){return this.imm}}Object(f.a)(mn,"RttAppliedReplaceTextRangeOp",null,[853]);class Fi{constructor(ta,jb,Mb){this.a3i=ta;this.MBe=jb;this.t$c=Mb}get opType(){return 4}get operation(){return this.a3i}get xOj(){return this.a3i.Qoc()?this.t$c:this.MBe}}Object(f.a)(Fi,"RttAppliedSplitParagraphOp",null,[853]);class Kk{constructor(){this.Olb=new Pa.a}Y3f(ta){return ta.toString()}t3c(ta,jb){ta=this.Y3f(ta);this.Olb.La(ta)||this.Olb.W(ta,new J.a);this.Olb.J(ta).add(jb)}Mfg(ta){switch(ta.opType){case 1:var jb=
Object(z.a)(mn,ta);this.t3c(jb.paragraphId,ta);break;case 6:jb=Object(z.a)(Ph,ta);this.t3c(jb.paragraphId,ta);break;case 4:jb=Object(z.a)(Fi,ta);this.t3c(jb.MBe,ta);this.t3c(jb.t$c,ta);break;case 2:jb=Object(z.a)(Cl,ta),this.t3c(jb.paragraphId,ta)}}AUl(ta){return this.Pyc(ta)}Pyc(ta){ta=this.Y3f(ta);if(!this.Olb.La(ta))return new J.a;const jb=this.Olb.J(ta);this.Olb.remove(ta);for(let Mb of jb)Mb.operation&&(Mb.operation.Tea=null);return jb}n0k(ta){let jb;return({value:jb}=this.Olb.tb(this.Y3f(ta),
jb)).returnValue?jb:new J.a}hMk(ta){for(let jb of this.Olb.values){if(!jb.count)continue;if(2!==jb.J(0).opType)continue;const Mb=jb.J(0);if(Mb.bff.Ybg===ta)return Mb}return null}}Object(f.a)(Kk,"RttAppliedOpTracker",null,[822]);var Lj=b(167),il;(function(ta){ta[ta.expired=0]="expired";ta[ta.dried=1]="dried"})(il||(il={}));Object(f.b)("RemoveChangeReason",il);class xd{constructor(ta){this._changes=new Lj.a;this.oc=ta}SPj(ta){if(!ta)return m.ULS.sendTraceTag(7685333,355,15,"Cannot add a null change to RTTStore"),
!1;const jb=ta.yb,Mb=ta.Qg;this._changes.La(jb)||this._changes.add(jb,new Lj.a);this._changes.J(jb).W(Mb,ta);return this.Tqk(jb,Mb)?(m.ULS.sendTraceTag(7619921,355,15,"Detected an infinite loop in paragraph {0}, dropping the last packet!",jb),this._changes.J(jb).remove(Mb),!1):!0}RMf(ta,jb){if(!this._changes.La(ta))return null;ta=this._changes.J(ta);return ta.La(jb)?ta.J(jb):null}fee(ta){const jb=new J.a;for(let Mb of this._changes.keys){const xb=this._changes.J(Mb);for(let Nc of xb.keys){const rc=
xb.J(Nc);ta(rc)&&jb.add(rc)}}return jb}TNi(ta,jb){let Mb=null;({value:Mb}=this._changes.tb(ta.yb,Mb)).returnValue?(ta.activity.beg(il[jb]),Mb.remove(ta.Qg),Mb.count||this._changes.remove(ta.yb)):m.ULS.sendTraceTag(50938848,355,15,"Cannot remove an op that not exist in _changes. WordId: {0}; Reason: {1}",ta.yb,jb)}mrg(ta){this.TNi(ta,1)}prg(ta){this.TNi(ta,0)}Tqk(ta,jb){if(!this._changes.La(ta))return!1;ta=this._changes.J(ta);if(!ta.La(jb))return!1;for(var Mb=ta.J(jb);Mb;){Mb=Mb.Nia;if(Mb===jb)return!0;
if(!ta.La(Mb))break;Mb=ta.J(Mb)}return!1}}Object(f.a)(xd,"RttDataStore",null,[820,821]);var lg=b(62),cd=b(257),Pf=b(18);class sk{constructor(ta,jb){this.qm=ta;if(this.Nq=jb)ta=this.Nq.Nd(12),ta.wp(Object(c.a)(this,this.Bgb,"onGraphNodeConnected")),ta.Iw(Object(c.a)(this,this.Pyc,"onGraphNodeDisconnected")),ta.ro(Object(c.a)(this,this.NAi,"onGraphPropertyChanged"))}dispose(){if(this.Nq){const ta=this.Nq.Nd(12);ta.LO(Object(c.a)(this,this.Bgb,"onGraphNodeConnected"));ta.C0a(Object(c.a)(this,this.Pyc,
"onGraphNodeDisconnected"));ta.iwa(Object(c.a)(this,this.NAi,"onGraphPropertyChanged"))}}Bgb(ta,jb){4===this.qm.opType?m.ULS.shipAssertTag(9204866,355,12===jb.node.type||11===jb.node.type,"Unexpected graph modification detected during RTT edit"):m.ULS.shipAssertTag(9204867,355,!1,"Unexpected graph modification detected during RTT edit")}Pyc(){m.ULS.shipAssertTag(9204868,355,!1,"Unexpected graph modification detected during RTT edit")}NAi(){m.ULS.shipAssertTag(9204869,355,!1,"Unexpected graph modification detected during RTT edit")}}
Object(f.a)(sk,"GraphChangeValidator",null,[12]);class jl{constructor(ta,jb,Mb,xb){this._id=ta;this.AY=jb;this.Zi=Mb;this.Bpj=xb}get id(){return this._id}get cpBegin(){return this.AY}get cpEnd(){return this.Zi}get N$j(){return this.Bpj}g1m(ta){var jb=this.id===ta.id;jb&&(jb=this.N$j.replace("\u00a0"," "),ta=ta.characterData.substr(this.cpBegin,this.cpEnd-this.cpBegin).replace("\u00a0"," "),jb=jb===ta);return jb}}Object(f.a)(jl,"RttOpValidator",null,[872]);class Sb{constructor(ta,jb){this.Tea=this.D2a=
this.activity=null;this.tEj=ta;this.OBj=jb}get opType(){return this.tEj}get metadata(){return this.OBj}YPf(){return""}serialize(){return null}}Object(f.a)(Sb,"RttOp",null,[847]);class Th extends Sb{constructor(ta,jb,Mb,xb,Nc,rc,wd,Fc,qe){super(qe,Fc);this.mC=ta;this.iW=jb;this.VCj=Mb;this.UCj=xb;this.nlc=Nc;this.QLj=rc;this.IPe=wd}get yb(){return this.mC}get Qg(){return this.iW}get AU(){return this.VCj}get t8(){return this.UCj}get Nia(){return this.nlc}get UEb(){return this.QLj}get pI(){return this.IPe}ZIh(){return this.AU.isEqual(this.t8,
!0)?new nc.a(0,this.yb,this.Qg,this.AU,void 0,void 0,void 0,this.pI):new nc.a(1,this.yb,this.Qg,this.AU,this.yb,this.Qg,this.t8,this.pI)}static R8i(ta,jb,Mb,xb,Nc){ta=ta.pW;if(1===ta.tve&&(ta.H_a!==ta.jPa||ta.skb!==ta.gGc))return m.ULS.sendTraceTag(8914769,355,15,"We received a ReplaceRange operation spanning multiple paragraphs"),jb=Mb=null,xb=Nc=-1,{returnValue:!1,AU:jb,t8:Mb,yb:xb,Qg:Nc};if(ta.pI)return jb=Mb=null,xb=Nc=-1,{returnValue:!1,AU:jb,t8:Mb,yb:xb,Qg:Nc};Mb=jb=ta.AU;1===ta.tve&&(Mb=ta.t8);
xb=ta.H_a;Nc=ta.skb;return{returnValue:!0,AU:jb,t8:Mb,yb:xb,Qg:Nc}}}Object(f.a)(Th,"RttReplaceRangeOp",Sb,[]);class Gi{constructor(ta,jb,Mb,xb,Nc,rc){this.G_a=ta;this.clientId=jb;this.clientType=Mb;this.H6i=xb;this.H0l=Nc;this.F1a=rc}static create(ta){let jb=null;null!=ta.F1a&&(jb=ta.F1a);return new Gi(ta.G_a,ta.clientId,ta.client,Date.now(),ta.version,jb)}}Object(f.a)(Gi,"RttOpMetadata",null,[]);class Lk extends Sb{constructor(ta,jb,Mb,xb,Nc,rc,wd,Fc,qe){super(4,qe);this.nlc=0;this.mC=ta;this.iW=
jb;this.offset=Mb;this.pI=xb;this.jQg=Nc;this.zIg=rc;this.yGe=wd;this.AIg=Fc;this.jQg===this.yb?this.nlc=this.zIg:this.yGe===this.yb?this.nlc=this.AIg:(m.ULS.sendTraceTag(8397766,355,10,"Bad data passed to RttSplitParagraphOp"),this.nlc=0)}get yb(){return this.mC}get Qg(){return this.iW}get Nia(){return this.nlc}Qoc(){return this.yb===this.yGe}get aPm(){return this.Nia}get q3m(){return this.Qoc()?this.jQg:this.yGe}get j6i(){return this.Qoc()?this.zIg:this.AIg}serialize(){const ta=new nc.a(3,this.yb,
this.Qg,this.offset,null,null,null,this.pI),jb=new Bb(this.jQg,this.zIg,this.yGe,this.AIg);return new Yb(this.metadata.G_a,this.metadata.clientId,1,4,ta,null,void 0,void 0,void 0,void 0,jb,void 0,void 0,this.metadata.F1a)}static create(ta){const jb=ta.pW,Mb=ta.wbc;return new Lk(jb.H_a,jb.skb,jb.AU,jb.pI,Mb.zig,Mb.yIg,Mb.Aig,Mb.BIg,Gi.create(ta))}static Q4k(ta,jb,Mb){if(1!==ta.type)return null;const xb=Mb.oPa(ta.u8.characterData,ta.u8.ka);return new Lk(ta.u8.yb,ta.u8.Qg,Mb.$Hc(xb,ta.R2i),ta.pI,ta.KQb.yb,
ta.KQb.Qg,ta.o5c.yb,ta.o5c.Qg,jb)}}Object(f.a)(Lk,"RttSplitParagraphOp",Sb,[817,847]);class Dj{constructor(ta,jb,Mb,xb){this.ada=ta;this.ZWc=jb;this.wda=Mb;this.zPb=xb}UZj(ta,jb,Mb,xb=null){if(jb.isDirty)return xb&&xb.properties.W(Dj.oFi,"1"),!1;const Nc=new sk(ta,jb.Wg);try{if(1===ta.opType||6===ta.opType){const Fc=Object(z.a)(Th,ta),qe=this.Khk(Fc,jb);var rc=qe.node.characterData;const Nf=10<=qe.cpBegin?qe.cpBegin-10:0;let mg=qe.cpEnd+10<=rc.length?qe.cpEnd+10:rc.length;const mi=rc.substr(Nf,qe.cpBegin-
Nf),Fg=rc.substr(qe.cpEnd,mg-qe.cpEnd);mg=mg+Fc.UEb.length-(qe.cpEnd-qe.cpBegin);var wd=new jl(qe.node.id,Nf,mg,mi+Fc.UEb+Fg);const Tj=6===Fc.opType;rc="";Tj&&(rc=Fc.font);if(!this.Tlm(qe,Fc.UEb,Tj,rc,xb))return!1;let lj;lj=1===ta.opType?new mn(Fc,jb.id):new Ph(Fc,jb.id);jb.hta=ta.Nia;Fc.D2a=wd;ta.Tea=lj;Mb.Mfg(lj)}else return 4===ta.opType?this.TZj(ta,jb,Mb):!1}finally{Nc&&Nc.dispose()}return!0}TZj(ta,jb,Mb){const xb=Object(z.a)(Lk,ta);var Nc=this.zPb.oPa(jb.characterData,jb.ka);Nc=this.zPb.usb(Nc,
xb.offset);if(!this.lli(Qc.a.createTextRange(jb,0,zc.ParagraphReader.textLength(jb))))return!1;var rc=qk.GraphIterator.wa(jb);rc.Na(10);if(this.kwc(rc))return!1;let wd;rc=this.wda.tc(3);try{rc.Va(jb);const Fc=jb.ZU();try{const qe=qk.GraphIterator.wa(jb);qe.Na(10);qe.Cc(11);let Nf=qe.currentNode;xb.Qoc()&&(qe.Cje?Nf=null:(qe.MG(),Nf=qe.currentNode));qe.ob();const mg=this.ZWc.rUb();qe.KC(mg,Nf,89);qe.Cg(mg);wd=jb.clone();const mi=wd.ZU();try{wd.setValue(Cg.a.yb,xb.q3m);wd.setValue(Cg.a.Qg,xb.j6i);wd.isDirty=
!1;qe.Fd(wd,2);qe.Cg(wd);this.$ik(jb,wd);const Fg=xb.Qoc()?wd:jb,Tj=xb.Qoc()?jb:wd;Fg.oT=!0;Tj.oT=!0;this.ada.mtg(this.Gtf(Fg,Nc,zc.ParagraphReader.textLength(Fg)),"",!1,"");this.ada.mtg(this.Gtf(Tj,0,Nc),"",!1,"");jb.hta=xb.aPm;wd.hta=xb.j6i}finally{mi&&mi.dispose()}}finally{Fc&&Fc.dispose()}rc.Tib()}finally{rc&&rc.dispose()}jb=new Fi(xb,jb.id,wd.id);ta.Tea=jb;Mb.Mfg(jb);return!0}kwc(ta){const jb=new qk.GraphIterator;jb.Xb(ta);jb.Cc(11);return lg.ListReader.gg(jb)?(m.ULS.sendTraceTag(16868566,355,
50,"Blocked RTT para operation: in a list"),!0):!1}VFk(ta,jb,Mb){var xb=jb.hMa(ta.yb);if(xb.equals(kc.a.nil))return null;xb=Mb.Ua(xb);if(!xb||!zc.ParagraphReader.Hb(xb)||!xb.isConnected)return null;const Nc=qk.GraphIterator.wa(xb);if(!Nc.Na(23))return null;if(ta.iQg){ta=jb.hMa(ta.iQg);if(ta.equals(kc.a.nil))return null;Mb=Mb.Ua(ta);if(!Mb||!zc.ParagraphReader.Hb(Mb)||!Mb.isConnected)return null;Mb=qk.GraphIterator.wa(Mb);if(!Mb.Na(23))return null;Mb.Cc(11);Mb.MG();Mb.Vd();if(Mb.currentNode!==xb)return null}return this.kwc(Nc)?
null:Nc}sSm(ta,jb,Mb,xb){const Nc=jb.currentNode,rc=this.wda.tc(3);try{rc.Va(Nc);jb.Cc(11);const wd=jb.currentNode;jb.ob();const Fc=this.ZWc.rUb();jb.KC(Fc,wd,89);jb.Cg(Fc);const qe=cd.a.instance.createInstance(393230),Nf=qe.ZU();try{qe.setValue(Pf.a.Zk,""),qe.Hua=!0,xb.DCb(qe),xb=[0],qe.setValue(Cg.a.zm,xb),qe.setValue(Cg.a.Ao,xb),qe.Hua=!1,qe.setValue(Cg.a.yb,ta.Ybg),qe.setValue(Cg.a.Qg,ta.Xbg),qe.isDirty=!1,jb.Fd(qe,2),qe.oT=!0,qe.hta=ta.Xbg}finally{Nf&&Nf.dispose()}rc.Tib();ta.Tea=new Cl(ta,qe.id);
Mb.Mfg(ta.Tea)}finally{rc&&rc.dispose()}return!0}Gtf(ta,jb,Mb){return jb===Mb?Qc.a.uc(ta,jb):Qc.a.createTextRange(ta,jb,Mb)}Tlm(ta,jb,Mb,xb,Nc=null){const rc=ta.node;if(ta.cpBegin!==ta.cpEnd&&!this.lli(ta))return Nc&&Nc.properties.W(Dj.D$i,"1"),!1;Nc=this.wda.tc(3);try{Nc.Va(rc);const wd=rc.ZU();try{rc.oT=!0,this.ada.mtg(ta,jb,Mb,xb)}finally{wd&&wd.dispose()}Nc.Tib()}finally{Nc&&Nc.dispose()}return!0}$ik(ta,jb){jb.Hua=!0;jb.PO(ta.characterData);jb.hta=ta.hta;jb.ka.clear();for(var Mb=0;Mb<ta.ka.length;Mb++){const xb=
ta.ka.J(Mb).daa(jb);jb.ka.add(xb)}jb.Ei();if(jb.wordRunProperties.length)for(ta=0;ta<jb.ka.length;ta++){if((Mb=jb.ka.J(ta).formatting)&&-1!==Mb.Rc)for(;jb.wordRunProperties.length<=Mb.Rc;)jb.wordRunProperties.UQ(jb.wordRunProperties.length-1,256)}else m.ULS.sendTraceTag(9204881,355,15,"Cannot update WordRunProperties after splitting paragraph");jb.Hua=!1}x3f(ta){ta=qk.GraphIterator.wa(ta);ta.Na(23);ta.ob();return{returnValue:89===ta.role,iterator:ta}}bsg(ta){const jb=new qk.GraphIterator;jb.Xb(ta);
jb.ob();const Mb=this.wda.tc(3);try{Mb.Va(jb.currentNode),ta.ef()}finally{Mb&&Mb.dispose()}}gim(ta){if(ta.anchor)if(({iterator:jb}=this.x3f(ta)).returnValue)this.bsg(jb);else{var jb=ta.Kb.Hg;var Mb=this.wda.tc(3);try{Mb.Va(ta),ta.load(jb.Ua(ta.id)),ta.anchor.sA(4)}finally{Mb&&Mb.dispose()}}}ovg(ta,jb,Mb){for(let rc=jb.count-1;0<=rc;rc--){var xb=jb.J(rc);switch(xb.opType){case 4:xb=Object(z.a)(Fi,xb);if(!ta.id.equals(xb.MBe)){m.ULS.shipAssertTag(9204885,355,ta.id.equals(xb.t$c));continue}xb=Mb.Ua(xb.t$c);
if(!xb)break;if(!xb||!zc.ParagraphReader.Hb(xb)){m.ULS.shipAssertTag(9204886,355,!1);break}if(!xb.isConnected)continue;var Nc=({iterator:xb}=this.x3f(xb)).returnValue;m.ULS.shipAssertTag(9204887,355,Nc);Nc&&this.bsg(xb);break;case 2:(xb=Object(z.a)(Cl,xb),ta.id.equals(xb.paragraphId))?ta.isConnected&&(Nc=({iterator:xb}=this.x3f(ta)).returnValue,m.ULS.shipAssertTag(16820002,355,Nc),Nc&&this.bsg(xb)):m.ULS.shipAssertTag(16820001,355,!1)}}}Khk(ta,jb){const Mb=this.zPb.oPa(jb.characterData,jb.ka),xb=
this.zPb.usb(Mb,ta.AU);ta=this.zPb.usb(Mb,ta.t8);return xb===ta?Qc.a.uc(jb,xb):Qc.a.createTextRange(jb,xb,ta)}lli(ta){const jb=ta.node.ka,Mb=ta.cpBegin;ta=ta.cpEnd;for(let xb=0;xb<jb.length;xb++){const Nc=jb.J(xb);if(Nc.cp>=ta)break;if(Nc.cp>=Mb){if(Nc.De)return m.ULS.sendTraceTag(8242647,355,15,"Rejected unsafe wet change: range contains comment"),!1;if(Nc.blob)return m.ULS.sendTraceTag(8242648,355,15,"Rejected unsafe wet change: range contains blob"),!1;if(Nc.Mf||Nc.Fwc||Nc.vje)return m.ULS.sendTraceTag(8242649,
355,15,"Rejected unsafe wet change: range contains field"),!1}}return!0}}Dj.oFi="ParagraphAlreadyDirty";Dj.D$i="UnsafeWetChange";Object(f.a)(Dj,"RttEditor",null,[819]);var bl=b(1070),If=b(97),eo=b(220);class ql{constructor(){this.JKd=new J.a}add(ta){this.JKd.add(ta);return!0}fee(ta){const jb=new J.a;for(let Mb of this.JKd)ta(Mb)&&jb.add(Mb);return jb}mrg(ta){ta.activity.beg("dried");this.JKd.remove(ta)}prg(ta){ta.activity.beg("expired");this.JKd.remove(ta)}}Object(f.a)(ql,"RttAddParagraphDataStore",
null,[]);class Mk extends Sb{constructor(ta,jb,Mb,xb,Nc,rc,wd,Fc){super(2,Fc);this.yb=ta;this.Qg=jb;this.Nia=Mb;this.iQg=xb;this.Ybg=Nc;this.Xbg=rc;this.pI=wd}serialize(){const ta=new nc.a(2,this.yb,this.Qg,null,this.iQg,null,null,this.pI),jb=new Nb(this.Nia,this.Ybg,this.Xbg);return new Yb(this.metadata.G_a,this.metadata.clientId,1,3,ta,null,void 0,void 0,jb,void 0,void 0,void 0,void 0,this.metadata.F1a)}static create(ta){const jb=ta.pW,Mb=ta.lmc;let xb=null;null!=ta.pW.jPa&&(xb=ta.pW.jPa);return new Mk(jb.H_a,
jb.skb,Mb.CIg,xb,Mb.Dig,Mb.Nia,jb.pI,Gi.create(ta))}static M4k(ta,jb){return 3!==ta.type?null:new Mk(ta.Bva.yb,ta.Bva.Qg,ta.ZNl.Qg,ta.n_a?ta.n_a.yb:null,ta.SCa.yb,ta.SCa.Qg,ta.pI,jb)}}Object(f.a)(Mk,"RttAddParagraphOp",Sb,[]);class Gh{constructor(ta){this.pY=ta}ALi(){this.pY&&this.pY.properties.W(Gh.$Rh,"1")}Jcm(ta){this.pY&&(this.pY.properties.La(Gh.sbg)||this.pY.properties.W(Gh.sbg,(ta-this.pY.startTime).toString()))}beg(ta){this.pY&&(this.pY.properties.W(Gh.NOi,ta),this.pY.end())}zdm(ta){this.pY&&
this.pY.properties.W(Gh.xEi,ta.toString())}ydm(ta){this.pY&&this.pY.properties.W(Gh.WDi,ta)}static sVf(ta){ta.Y8(fe.a.WCb,Gh.$Rh,bl.a.TGg);ta.Y8(fe.a.WCb,Gh.RDk,bl.a.TGg);ta.Y8(fe.a.WCb,Gh.sbg,bl.a.Avh);ta.Y8(fe.a.WCb,Gh.NOi,bl.a.Gsa);ta.Y8(fe.a.WCb,Gh.xEi,bl.a.Gsa);ta.Y8(fe.a.WCb,Gh.WDi,bl.a.Gsa)}static create(ta){if(!ta)return null;ta=ta.nk(fe.a.WCb,Gh.F2m);return new Gh(ta)}}Gh.$Rh="FailedToFindInitialParaID";Gh.RDk="FailedToFindInitialTextID";Gh.sbg="MsecUntilApplied";Gh.NOi="RemovedBecause";
Gh.xEi="PacketVersions";Gh.WDi="OperationType";Gh.F2m=48E4;Object(f.a)(Gh,"RttOpActivity",null,[]);var Ck;(function(ta){ta[ta.unknown=0]="unknown";ta[ta.replaceTextRangeOp=1]="replaceTextRangeOp";ta[ta.addParagraphOp=2]="addParagraphOp";ta[ta.deleteParagraphOp=3]="deleteParagraphOp";ta[ta.splitParagraphOp=4]="splitParagraphOp";ta[ta.mergeParagraphOp=5]="mergeParagraphOp";ta[ta.replaceSymbolRangeOp=6]="replaceSymbolRangeOp"})(Ck||(Ck={}));Object(f.b)("RttOpType",Ck);var Um=b(137);class Ej extends Th{constructor(ta,
jb,Mb,xb,Nc,rc,wd,Fc,qe,Nf,mg){super(xb,Nc,rc,wd,Fc,qe,Nf,mg,6);this._font=ta;this.FAj=jb}get font(){return this._font}get legacy(){return this.FAj}YPf(){return"OffsetStart: "+this.AU+"OffsetEnd: "+this.t8}serialize(){const ta=this.ZIh();return new Yb(this.metadata.G_a,this.metadata.clientId,1,7,ta,null,this.Nia,this.UEb,void 0,void 0,void 0,void 0,void 0,this.metadata.F1a)}static create(ta){let jb,Mb,xb,Nc;if(!({AU:jb,t8:Mb,yb:xb,Qg:Nc}=Th.R8i(ta,jb,Mb,xb,Nc)).returnValue)return null;let rc,wd;if(1===
ta.text.length)rc=!1,wd=Um.AParagraphNode.pF;else if(2===ta.text.length)if(Ha.a.n_f(ta.text,0)&&Ha.a.gu(ta.text,1))rc=!0,wd=ta.text;else return m.ULS.sendTraceTag(8914772,355,15,"RTT symbol packet has text length 2 but is not a valid surrogate pair",ta.RC),null;else return m.ULS.sendTraceTag(8914773,355,15,"RTT symbol packet text is of unsupported length (length must be 1 or 2)",ta.RC),null;const Fc=ta.jFd,qe=Gi.create(ta);return new Ej(Fc.Ubc,Fc.kHg,rc,xb,Nc,jb,Mb,ta.qcc,wd,ta.pW.pI,qe)}}Object(f.a)(Ej,
"RttReplaceSymbolRangeOp",Th,[817,847]);class Xi extends Th{constructor(ta,jb,Mb,xb,Nc,rc,wd,Fc){super(ta,jb,Mb,xb,Nc,rc,wd,Fc,1)}YPf(){return"OffsetStart: "+this.AU+"OffsetEnd: "+this.t8+"TextAddedLength: "+this.UEb.length}serialize(){const ta=this.ZIh();return new Yb(this.metadata.G_a,this.metadata.clientId,1,2,ta,null,this.Nia,this.UEb,void 0,void 0,void 0,void 0,void 0,this.metadata.F1a)}static create(ta){let jb,Mb,xb,Nc;if(!({AU:jb,t8:Mb,yb:xb,Qg:Nc}=Th.R8i(ta,jb,Mb,xb,Nc)).returnValue)return null;
let rc="";ta.text&&(rc=ta.text);const wd=Gi.create(ta);return new Xi(xb,Nc,jb,Mb,ta.qcc,rc,ta.pW.pI,wd)}static W3k(ta,jb,Mb){if(ta.type)return null;const xb=Mb.oPa(ta.u8.characterData,ta.u8.ka);return new Xi(ta.u8.yb,ta.u8.Qg,Mb.$Hc(xb,ta.cpBegin),Mb.$Hc(xb,ta.cpEnd),ta.SCa.Qg,ta.i_a,ta.pI,jb)}}Object(f.a)(Xi,"RttReplaceTextRangeOp",Th,[817,847]);class Hi{constructor(ta,jb,Mb,xb,Nc,rc,wd,Fc,qe,Nf,mg,mi,Fg,Tj,lj,mj,bn,Ln){this.Np=null;this.Ngh=this.r8e=this.Pgh=this.Mgh=this.Ogh=this.EXe=this.omh=
!1;this.xOb=ta;this.rIb=jb;this.zVc=Mb;this.qob=xb;this.ua=Nc;this.lG=rc;this.nka=wd;this.ui=Fc;this.Za=qe;this.Aw=Nf;this.zPb=mg;this.oc=mi;this.F4e=Tj;this.Ub=lj;this.akh=mj;this.OGb=bn;this.ldf=Ln;this.kYc=new Ke.a(Ra.a.lf());this.GLc=new ql;Fg.execute(Hi.sVf)}Fjl(){const ta=new Na.a(3,2,Hi.Njm,Object(c.a)(this,this.cDk,"expireWetChangesAndRender"));this.Za.Cb(ta);this.omh=!0}init(){return this.nka?this.nka.continueWith(Object(c.a)(this,this.ygg,"onRtcConnected")):S.Task.s_(!1)}R1f(){return this.ua.isFeatureEnabled(202)&&
this.ua.isFeatureEnabled(157)}Wki(){return this.R1f()&&this.ua.isFeatureEnabled(147)}ygg(){m.ULS.sendTraceTag(7685328,355,50,"All prerequisite ready for RttManager");this.Np=this.nka.result;m.ULS.sendTraceTag(7685330,355,50,"Subscribing to presence updates");this.Np.n6(Object(c.a)(this,this.C8,"onUpdateNotificationReceived"))}Ltk(ta){ta=ce(ta);if(!ta)return null;switch(ta.RC){case 2:return Xi.create(ta);case 7:return Ej.create(ta);case 4:return this.Wki()?Lk.create(ta):null;case 3:return this.Wki()?
Mk.create(ta):null;default:return m.ULS.sendTraceTag(8459668,355,50,"RTT packet is of unexpected operationType {0}",ta.RC),null}}C8(ta,jb){if(3===jb.type&&this.R1f())if(this.qob.value&&!this.qob.value.Awb)m.ULS.sendTraceTag(8454939,355,15,"RTT channel did not get disconnected on lock release");else if(jb.z9){if(this.Idm(),(ta=this.Ltk(jb.z9))&&1!==ta.metadata.clientType)switch(this.Hdm(),this.omh||this.Fjl(),ta.opType){case 1:case 6:case 4:if(!({We:ta}=this.TPj(ta)).returnValue)break;this.akh?this.ATi(ta):
this.O9i(ta);break;case 2:this.GLc.add(ta),this.ndi(ta),this.akh?this.ATi(kc.a.nil):this.N9i(ta)}}else m.ULS.sendTraceTag(7685331,355,15,"RTT packet was empty")}TPj(ta){let jb=kc.a.nil;if(!this.rIb.SPj(ta))return{returnValue:!1,We:jb};this.ndi(ta);if(!this.lG)return{returnValue:!1,We:jb};const Mb=this.lG.hMa(ta.yb);if(Mb.equals(kc.a.nil)||!this.ui.value.Ua(Mb))return ta.activity.ALi(),{returnValue:!1,We:jb};this.OLi();return{returnValue:!0,We:Mb}}ATi(ta){ta.equals(kc.a.nil)||this.kYc.add(ta.toString());
this.EXe||(ta=new Na.a(0,1,200,()=>{this.LTm();this.EXe=!1},71),this.Za.Cb(ta),this.EXe=!0)}krm(ta){ta=new Na.a(0,1,0,ta,71);this.Za.Cb(ta)}ndi(ta){ta.activity=Gh.create(this.oc);ta.activity.zdm(ta.metadata.H0l);ta.activity.ydm(Ck[ta.opType])}LTm(){var ta=this.GLc.fee(Mb=>!Mb.Tea);for(let Mb of ta)this.N9i(Mb);if(this.kYc.count){ta=null;for(var jb of this.kYc){jb=kc.a.Ad(jb);ta=this.ui.value.Ua(jb);break}jb=this.Ub.tc(3);try{jb.Va(ta);for(let Mb of this.kYc)this.O9i(kc.a.Ad(Mb))}finally{jb&&jb.dispose()}this.kYc.clear()}}O9i(ta){ta=
this.ui.value.Ua(ta);let jb;const Mb=this.Ub.tc(3);try{Mb.Va(ta);jb=this.oc.nk(fe.a.Aif);const xb=this.zth(ta,jb);jb.end();xb&&this.WRj(xb)}finally{Mb&&Mb.dispose()}}N9i(ta){var jb=this.xOb.VFk(ta,this.lG,this.ui.value);jb&&(this.OLi(),this.xOb.sSm(ta,jb,this.OGb,ka.a.instance.resolve("Box4.IParagraphEditor"))&&(jb=this.ui.value.Ua(ta.Tea.paragraphId),this.Nth(jb,ta)))}WRj(ta){this.F4e.continueWith(()=>{if(1===ta.opType){var jb=this.G2k(ta);jb&&(this.F4e.result.Zef(jb),this.F4e.result.Bwe(!0))}})}G2k(ta){const jb=
ta.serialize();if(2!==jb.RC||jb.pW.jPa&&jb.pW.H_a!==jb.pW.jPa)return null;const Mb=ta.AU.clone();0<ta.UEb.length&&(Mb.epf(),Mb.cp+=ta.UEb.length);jb.RC=0;jb.text=null;jb.pW.tve=0;jb.pW.AU=Mb;jb.pW.skb=jb.qcc;jb.pW.jPa=null;jb.pW.gGc=null;jb.pW.t8=null;jb.qcc=null;return yc.kuf(jb,this.lG,this.zPb,()=>this.ui.value,this.ldf.instance)}cDk(){const ta=this.ui.value;if(ta){var jb=this.Aw()-Hi.rim,Mb=this.rIb.fee(Nc=>Nc.metadata.H6i<jb);0<Mb.count&&this.Kcm();var xb=new eo.a;for(let Nc of Mb)if(this.rIb.prg(Nc),
Nc.Tea)switch(Nc.Tea.opType){case 1:xb.add(Nc.Tea.paragraphId.toString());break;case 6:xb.add(Nc.Tea.paragraphId.toString());break;case 4:xb.add(Nc.Tea.MBe.toString()),xb.add(Nc.Tea.t$c.toString())}Mb=this.GLc.fee(Nc=>Nc.metadata.H6i<jb);for(let Nc of Mb)this.GLc.prg(Nc),Nc.Tea&&xb.add(Nc.Tea.paragraphId.toString());for(let Nc of xb)(xb=ta.Ua(kc.a.Ad(Nc)))?xb.oT?(this.xOb.gim(xb),xb.oT||(this.zVc.value.asg(xb),xb.ha(If.a.D4,0))):m.ULS.sendTraceTag(8765829,355,15,"Expiring wet change from paragraph with no applied changes"):
m.ULS.sendTraceTag(8765828,355,15,"Expiring wet change with invalid object ID")}else this.ui.pTf&&m.ULS.sendTraceTag(7685332,355,10,"Failed to find the IObjectSpace! Wet changes will never expire")}Nth(ta,jb){return this.zVc.value?this.zVc.value.Zmh(ta,jb.metadata.clientId).returnValue?!0:(m.ULS.sendTraceTag(7866379,355,15,"Unable to apply a wet change lock"),!1):(m.ULS.shipAssertTag(7866378,355,!!this.zVc.value,"Unable to apply wet changes as LockManager unavailable"),!1)}Fif(ta,jb){this.zth(ta,
jb)}zth(ta,jb){if(!ta)return null;if(!ta.anchor)return jb&&jb.properties.W(Hi.wxi,"1"),null;if(!ta.hasProperty(Cg.a.yb))return m.ULS.sendTraceTag(7619922,355,15,"Paragraph is missing the WordId property"),null;if(!ta.hasProperty(Cg.a.Qg))return m.ULS.sendTraceTag(8197722,355,15,"Paragraph is missing the TextId property"),null;if(ta.hasProperty(Cg.a.sMh)&&ta.getValue(Cg.a.sMh))return m.ULS.sendTraceTag(16815506,355,50,"RTT edit disabled in paragraph"),null;const Mb=ta.getValue(Cg.a.yb);var xb=ta.hta;
jb&&(jb.properties.W(Hi.POl,xb.toString()),jb.properties.W(Hi.ROl,Mb.toString()));xb=this.rIb.RMf(Mb,xb);if(!xb)return jb&&jb.properties.W(Hi.pxi,"1"),null;if(!this.Nth(ta,xb))return jb&&jb.properties.W(Hi.cHh,"1"),null;let Nc=0,rc=null;for(;xb;){if(!this.xOb.UZj(xb,ta,this.OGb,jb)){jb&&jb.properties.W(Hi.wej,"1");break}Nc++;xb.activity.Jcm(this.Aw());rc=xb;xb=ta.hta;xb=this.rIb.RMf(Mb,xb)}0<Nc&&this.iLi();jb&&jb.properties.add(Hi.xej,Nc.toString());return rc}cCc(ta){if(this.R1f()&&ta.hasProperty(Cg.a.yb)&&
ta.hasProperty(Cg.a.Qg)){var jb=ta.getValue(Cg.a.yb),Mb=ta.ha(Cg.a.Qg,0),xb=this.oc.nk(fe.a.Tqg),Nc=this.OGb.AUl(ta.id);0<Nc.count&&(this.xOb.ovg(ta,Nc,this.ui.value),this.Jim(ta,Nc,Mb));var rc=this.OGb.hMk(jb);if(rc&&!ta.id.equals(rc.paragraphId)){const wd=this.ui.value;this.krm(()=>{const Fc=this.OGb.Pyc(rc.paragraphId),qe=wd.Ua(rc.paragraphId);m.ULS.shipAssertTag(16820032,355,!!qe,"Could not find added graph node");qe&&(this.xOb.ovg(qe,Fc,wd),this.GLc.mrg(rc.bff))})}this.rIb.RMf(jb,Mb)||this.zVc.value.asg(ta);
this.Fif(ta,xb);xb.end()}}Jim(ta,jb,Mb){let xb=!1;for(let rc=jb.count-1;0<=rc;rc--){var Nc=jb.J(rc);switch(Nc.opType){case 1:case 6:case 4:Nc=Object(z.a)(817,Nc.operation);break;default:continue}Nc.Nia===Mb&&(xb=!0,Nc.D2a&&!Nc.D2a.g1m(ta)&&m.ULS.sendTraceTag(8765831,355,15,"Validating wet change location failed. Type {0} OffsetInfo {1} NodeId {2} ValidatorNodeId {3} ValidatorNodeCpBegin {4} ValidatorNodeCpEnd {5}",Nc.opType,Nc.YPf(),ta.id,Nc.D2a.id,Nc.D2a.cpBegin,Nc.D2a.cpEnd));xb&&this.rIb.mrg(Nc)}xb&&
this.iLi()}fBb(ta){const jb=this.OGb.Pyc(ta.id);0<jb.count&&(2===jb.J(0).opType&&jb.removeAt(0),this.xOb.ovg(ta,jb,this.ui.value))}qEc(ta){var jb=this.OGb.n0k(ta.id);for(let Mb of jb)if(4===Mb.opType&&(jb=Object(z.a)(Fi,Mb),ta.id.equals(jb.xOj)))return!0;return!1}Idm(){this.Ogh||(m.ULS.sendTraceTag(8704354,355,50,"Received a wet change"),this.Ogh=!0)}Hdm(){this.Mgh||(m.ULS.sendTraceTag(8185606,355,50,"Received a wet change that we could deserialize"),this.Mgh=!0)}OLi(){this.Pgh||(m.ULS.sendTraceTag(17147533,
355,50,"Received a usable wet change"),this.Pgh=!0)}iLi(){this.r8e||(m.ULS.sendTraceTag(8185607,355,50,"Successfully applied a wet change"),this.r8e=!0)}Kcm(){this.r8e||this.Ngh||(m.ULS.sendTraceTag(8185608,355,15,"Failed to apply any wet changes so far"),this.Ngh=!0)}static sVf(ta){const jb=[fe.a.Aif,fe.a.Tqg];for(let Mb of jb)ta.Y8(Mb,Hi.xej,bl.a.Gsa),ta.Y8(Mb,Hi.pxi,bl.a.Gsa),ta.Y8(Mb,Hi.wxi,bl.a.Gsa),ta.Y8(Mb,Hi.cHh,bl.a.Gsa),ta.Y8(Mb,Hi.wej,bl.a.Gsa),ta.Y8(Mb,Dj.oFi,bl.a.Gsa),ta.Y8(Mb,Dj.D$i,
bl.a.Gsa);Gh.sVf(ta)}}Hi.Njm=6E4;Hi.rim=18E4;Hi.xej="WetChangeCount";Hi.pxi="NoChangesToApply";Hi.wxi="NodeNotConnected";Hi.cHh="CouldNotGetLock";Hi.wej="WetChangeBlocked";Hi.ROl="NodeWordId";Hi.POl="NodeTextId";Object(f.a)(Hi,"RttManager",null,[818]);var ib=b(1594);class Ab{constructor(){this.p_c=new ib.a}uSj(ta,jb){this.p_c.back()&&jb&&this.p_c.back().I$a(ta)||this.p_c.enqueue(ta)}l_k(){return this.p_c.isEmpty?null:this.p_c.dequeue()}}Object(f.a)(Ab,"RttSendDataStore",null,[816]);class Tb extends Sb{constructor(ta,
jb,Mb,xb){super(3,xb);this.mC=ta;this.iW=jb;this.pI=Mb}get yb(){return this.mC}get Qg(){return this.iW}get Nia(){return 0}serialize(){const ta=new nc.a(4,this.yb,this.Qg,null,null,null,null,this.pI);return new Yb(this.metadata.G_a,this.metadata.clientId,1,5,ta,null,void 0,void 0,void 0,void 0,void 0,void 0,void 0,this.metadata.F1a)}static create(ta){const jb=ta.pW;return new Tb(jb.H_a,jb.skb,jb.pI,Gi.create(ta))}static N4k(ta,jb){return 4!==ta.type?null:new Tb(ta.Jpc.yb,ta.Jpc.Qg,ta.pI,jb)}}Object(f.a)(Tb,
"RttDeleteParagraphOp",Sb,[817,847]);class lc extends Sb{constructor(ta,jb,Mb,xb,Nc,rc,wd,Fc){super(5,Fc);this.hQg=ta;this.i6i=jb;this.p3m=Mb;this.bPm=xb;this.pI=Nc;this.$ej=rc;this.hGc=wd}get yb(){return this.hQg}get Qg(){return this.i6i}get Nia(){return this.hQg===this.$ej?this.hGc:0}serialize(){const ta=new nc.a(5,this.hQg,this.i6i,null,this.p3m,this.bPm,null,this.pI),jb=new Kb(this.$ej,this.hGc);return new Yb(this.metadata.G_a,this.metadata.clientId,1,6,ta,null,void 0,void 0,void 0,jb,void 0,
void 0,void 0,this.metadata.F1a)}static create(ta){const jb=ta.pW,Mb=ta.nsd;return new lc(jb.H_a,jb.skb,jb.jPa,jb.gGc,jb.pI,Mb.Cig,Mb.hGc,Gi.create(ta))}static O4k(ta,jb){return 2!==ta.type?null:new lc(ta.Bva.yb,ta.Bva.Qg,ta.n_a.yb,ta.n_a.Qg,ta.pI,ta.boe.yb,ta.boe.Qg,jb)}}Object(f.a)(lc,"RttMergeParagraphOp",Sb,[817,847]);class Hc{constructor(ta,jb,Mb,xb,Nc,rc){this.T_c=this.Ai=null;this.pqa=!1;this.$af=this.tkh=0;this.GYd=this.Alh=!1;this.w7e=0;this.nka=ta;this.Vfh=jb;this.Tja=Mb;this.Cr=xb;this.Mea=
Nc;this.ua=rc}get Uq(){return this.Tja.value}init(){return this.nka?this.nka.continueWith(Object(c.a)(this,this.ygg,"onRtcConnected")):S.Task.s_(!1)}ygg(){m.ULS.sendTraceTag(8245954,355,50,"All prerequisites ready for RttSendManager");this.Ai=this.nka.result;this.Ai.Tve(this)}start(){this.pqa||(this.o2f()&&this.Cr.Nb.EB.Oqh(Object(c.a)(this,this.QBi,"onPersistenceTransactionCompleted")),this.pqa=!0)}stop(){this.pqa=!1;this.o2f()&&this.Cr.Nb.EB.IOi(Object(c.a)(this,this.QBi,"onPersistenceTransactionCompleted"))}o2f(){return this.ua.isFeatureEnabled(202)&&
this.ua.isFeatureEnabled(168)}zxl(){return this.o2f()?this.ua.isFeatureEnabled(148):!1}QBi(ta,jb){if(this.Ai&&2===this.Ai.connectionState&&(ta=jb.EB,ta.length))if(jb.c2)100>this.$af&&(this.$af++,m.ULS.sendTraceTag(8270467,355,50,"Blocking send. Reason: {0} OverallSends: {1} OverallBlocked: {2}",jb.pwh,this.tkh,this.$af));else{for(jb=0;jb<ta.length;jb++)if(!this.Jzl(ta[jb]))return;for(jb=0;jb<ta.length;jb++){let Mb=ta[jb];this.Vfh.uSj(Mb,!Mb.type&&!jb)}this.T_c||this.zBi(this.T_c,this.Ai)}}Jzl(ta){return ta&&
-1!==ta.pI?!ta.type||this.zxl()&&(3===ta.type||1===ta.type)?!0:!1:!1}PGl(){this.GYd||(this.Alh||(m.ULS.sendTraceTag(8270468,355,50,"Preparing to send RTT change"),this.Alh=!0),!this.GYd&&5>=this.w7e&&this.w7e++)}XGl(){!this.GYd&&5>=this.w7e&&(m.ULS.sendTraceTag(8270469,355,50,"Sent Rtt Message"),this.GYd=!0)}zBi(ta,jb){this.PGl();ta&&(ta.Dg||ta.Rm)&&m.ULS.sendTraceTag(8245956,355,15,"Task is faulted or cancelled with exception {0}",ta.exception);(ta=this.P4k(this.Vfh.l_k()))?(this.tkh++,this.T_c=
jb.GR(3,Ec(ta.serialize())),this.XGl(),this.T_c.continueWith(Mb=>{this.zBi(Mb,jb)})):this.T_c=null}P4k(ta){if(!ta)return null;if(!this.Uq)return m.ULS.sendTraceTag(8245957,355,15,"GetParagraphAnchoredOpFromGraphTransactionOperation: CoAuth manager is null"),null;const jb=new Gi(pk.instance.h2h(),this.Uq.$g,1,0,0,Gd.instance.x_k());let Mb=null;switch(ta.type){case 0:Mb=Xi.W3k(ta,jb,this.Mea);break;case 4:Mb=Tb.N4k(ta,jb);break;case 3:Mb=Mk.M4k(ta,jb);break;case 2:Mb=lc.O4k(ta,jb);break;case 1:Mb=Lk.Q4k(ta,
jb,this.Mea)}return Mb}}Object(f.a)(Hc,"RttSendManager",null,[814]);class hd{constructor(){this.Z=null}get name(){return"WordEditor.RealTimeTyping"}OYk(){return mb.App.Lb&&mb.App.Lb.Am?mb.App.Lb.Am:(m.ULS.sendTraceTag(7866377,304,15,"Unable to get the lock manager"),null)}Mb(ta){const jb=oa.a.Wp(ta.Da("Box4.IOutlineElementEditor")),Mb=oa.a.Wp(ta.Da("Box4.IFeatureHelper")),xb=oa.a.Wp(ta.Da("Common.IActivityAggregationInfo")),Nc=oa.a.Wp(ta.Da("WordEditor.WordTextOffsetTranslator.IWordTextOffsetTranslator"));
this.Z=ta;const rc=new Bl.a;S.Task.WAA.call(null,jb,Mb,xb,Nc).continueWith(()=>{ta.ia("WordEditor.RealTimeTyping.IRttEditor",()=>new Dj(ta.resolve("Box4.ICharacterPropertiesEditor"),ta.resolve("Box4.IOutlineElementEditor"),rc,ta.resolve("WordEditor.WordTextOffsetTranslator.IWordTextOffsetTranslator"))).fa();ta.ia("WordEditor.RealTimeTyping.RttManager",()=>new Hi(ta.resolve("WordEditor.RealTimeTyping.IRttEditor"),new xd(le.a.instance),new M.a(Object(c.a)(this,this.OYk,"getLockManager")),new M.a(()=>
mb.App.FA),ta.resolve("Box4.IFeatureHelper"),ta.resolve("WordEditor.ParagraphWordIdMapping"),ta.resolve("Box4.Presence.IRtcProxyProvider").mK(),new M.a(()=>mb.App.na.Aa.Nb.wc),$a.a.instance,()=>Date.now(),ta.resolve("WordEditor.WordTextOffsetTranslator.IWordTextOffsetTranslator"),le.a.instance,ta.Da("Common.IActivityAggregationInfo"),ac.mK(),rc,v.AFrameworkApplication.K.$("WordEditorThrottleAndBatchRTTRendering"),new Kk,ta.Da("WordEditor.Presence.IWordPresenceCpFactory"))).as("WordEditor.RealTimeTyping.IRttManager").fa();
ta.ia("WordEditor.RealTimeTyping.RttSendManager",()=>new Hc(ta.resolve("Box4.Presence.IRtcProxyProvider").mK(),new Ab,new M.a(()=>mb.App.Lb),mb.App.na.Aa,ta.resolve("WordEditor.WordTextOffsetTranslator.IWordTextOffsetTranslator"),ta.resolve("Box4.IFeatureHelper"))).fa();this.tVf()})}tVf(){this.Z.resolve("WordEditor.RealTimeTyping.RttManager").init();this.Z.resolve("WordEditor.RealTimeTyping.RttSendManager").init()}init(){}dispose(){}static main(){U.a.instance.kc(new hd)}}Object(f.a)(hd,"WordEditorRealTimeTypingPackage",
null,[1,2]);Type.registerNamespace("BPr");Type.registerNamespace("Box4.Presence");Type.registerNamespace("RealtimePresenceUI");Type.registerNamespace("WERTT");Type.registerNamespace("WordEditor.PeoplesWellControl");Type.registerNamespace("WordEditor.Presence");Type.registerNamespace("AppRealtimeChannel");Type.registerNamespace("Common.App.CoauthTelemetry");za.main();Type.registerNamespace("Common.App.CollabControls");ya.prototype.toString=ha.prototype.toString;va.prototype.toString=ha.prototype.toString;
U.a.instance.kc(new Af);hd.main();Type.registerNamespace("RealtimePresenceUI");U.a.instance.kc(new Qe);Type.registerNamespace("Common.App.RtcHostNotificationSubscription");L.main()},513:function(D,P,b){b.d(P,"a",function(){return f});D=b(0);class f{}f.clientId="ClientId";f.uOg="UserApp";f.userSessionId="usid";f.userType="UserType";f.GOg="UserVersion";f.j0a="qs";f.wpf="clientProtocol";f.hcg="NoAuth";Object(D.a)(f,"RtcFindSessionInputQueryParamConstants",null,[])}}]);

//# sourceMappingURL=https://wordwebclientbuilds.blob.core.windows.net/ooui/d7544f9f92a4288740dc16921be5508a3fcb21f4/WordEditorDS.collab.js.map